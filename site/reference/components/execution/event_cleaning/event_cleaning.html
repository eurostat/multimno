
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="index.html">
      
      
        <link rel="next" href="../template/index.html">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>event_cleaning - MultiMNO</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.50c56a3b.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#components.execution.event_cleaning.event_cleaning" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../index.html" title="MultiMNO" class="md-header__button md-logo" aria-label="MultiMNO" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MultiMNO
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              event_cleaning
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../index.html" title="MultiMNO" class="md-nav__button md-logo" aria-label="MultiMNO" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    MultiMNO
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    components
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    execution
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            execution
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    event_cleaning
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_1_1" id="__nav_2_1_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_1_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1_1_1">
            <span class="md-nav__icon md-icon"></span>
            event_cleaning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    event_cleaning
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="event_cleaning.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    event_cleaning
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning" class="md-nav__link">
    <span class="md-ellipsis">
      event_cleaning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning" class="md-nav__link">
    <span class="md-ellipsis">
      EventCleaning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EventCleaning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.bounding_box_filtering_and_update_qa" class="md-nav__link">
    <span class="md-ellipsis">
      bounding_box_filtering_and_update_qa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.convert_time_column_to_timestamp_and_update_qa" class="md-nav__link">
    <span class="md-ellipsis">
      convert_time_column_to_timestamp_and_update_qa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.data_period_filter_and_update_qa" class="md-nav__link">
    <span class="md-ellipsis">
      data_period_filter_and_update_qa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.filter_invalid_cell_id_and_update_qa" class="md-nav__link">
    <span class="md-ellipsis">
      filter_invalid_cell_id_and_update_qa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.filter_invalid_mcc_and_update_qa" class="md-nav__link">
    <span class="md-ellipsis">
      filter_invalid_mcc_and_update_qa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.filter_null_locations_and_update_qa" class="md-nav__link">
    <span class="md-ellipsis">
      filter_null_locations_and_update_qa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.filter_nulls_and_update_qa" class="md-nav__link">
    <span class="md-ellipsis">
      filter_nulls_and_update_qa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.save_syntactic_quality_metrics_by_column" class="md-nav__link">
    <span class="md-ellipsis">
      save_syntactic_quality_metrics_by_column
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.save_syntactic_quality_metrics_frequency_distribution" class="md-nav__link">
    <span class="md-ellipsis">
      save_syntactic_quality_metrics_frequency_distribution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../template/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    template
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_1_2" id="__nav_2_1_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1_2">
            <span class="md-nav__icon md-icon"></span>
            template
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../template/template_component.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    template_component
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../ingestion/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    ingestion
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2">
            <span class="md-nav__icon md-icon"></span>
            ingestion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../ingestion/synthetic/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    synthetic
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_2_1" id="__nav_2_1_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2_1">
            <span class="md-nav__icon md-icon"></span>
            synthetic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ingestion/synthetic/synthetic_events.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    synthetic_events
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quality/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quality
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    core
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/component.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    component
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/configuration.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/constants/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    constants
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2_3" id="__nav_2_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_3">
            <span class="md-nav__icon md-icon"></span>
            constants
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/constants/columns.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    columns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/constants/error_types.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    error_types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/constants/transformations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    transformations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/data_objects/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    data_objects
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2_4" id="__nav_2_2_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_4">
            <span class="md-nav__icon md-icon"></span>
            data_objects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_4_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/data_objects/bronze/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    bronze
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2_4_1" id="__nav_2_2_4_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_4_1">
            <span class="md-nav__icon md-icon"></span>
            bronze
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/data_objects/bronze/bronze_event_data_object.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bronze_event_data_object
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/data_objects/data_object.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/data_objects/landing/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    landing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_4_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/data_objects/silver/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    silver
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2_4_4" id="__nav_2_2_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_4_4">
            <span class="md-nav__icon md-icon"></span>
            silver
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/data_objects/silver/silver_event_data_object.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_event_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/data_objects/silver/silver_event_data_syntactic_quality_metrics_by_column.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_event_data_syntactic_quality_metrics_by_column
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/data_objects/silver/silver_event_data_syntactic_quality_metrics_frequency_distribution.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_event_data_syntactic_quality_metrics_frequency_distribution
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/io_interface.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    io_interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/log.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    log
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/settings.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/spark_session.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    spark_session
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../hello_world.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hello_world
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../main.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    main
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../orchestrator.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    orchestrator
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../readme.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Readme
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_guide.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dev-Guide
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning" class="md-nav__link">
    <span class="md-ellipsis">
      event_cleaning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning" class="md-nav__link">
    <span class="md-ellipsis">
      EventCleaning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EventCleaning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.bounding_box_filtering_and_update_qa" class="md-nav__link">
    <span class="md-ellipsis">
      bounding_box_filtering_and_update_qa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.convert_time_column_to_timestamp_and_update_qa" class="md-nav__link">
    <span class="md-ellipsis">
      convert_time_column_to_timestamp_and_update_qa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.data_period_filter_and_update_qa" class="md-nav__link">
    <span class="md-ellipsis">
      data_period_filter_and_update_qa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.filter_invalid_cell_id_and_update_qa" class="md-nav__link">
    <span class="md-ellipsis">
      filter_invalid_cell_id_and_update_qa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.filter_invalid_mcc_and_update_qa" class="md-nav__link">
    <span class="md-ellipsis">
      filter_invalid_mcc_and_update_qa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.filter_null_locations_and_update_qa" class="md-nav__link">
    <span class="md-ellipsis">
      filter_null_locations_and_update_qa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.filter_nulls_and_update_qa" class="md-nav__link">
    <span class="md-ellipsis">
      filter_nulls_and_update_qa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.save_syntactic_quality_metrics_by_column" class="md-nav__link">
    <span class="md-ellipsis">
      save_syntactic_quality_metrics_by_column
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.event_cleaning.event_cleaning.EventCleaning.save_syntactic_quality_metrics_frequency_distribution" class="md-nav__link">
    <span class="md-ellipsis">
      save_syntactic_quality_metrics_frequency_distribution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>event_cleaning</h1>

<div class="doc doc-object doc-module">



<a id="components.execution.event_cleaning.event_cleaning"></a>
  <div class="doc doc-contents first">
  
      <p>Module that cleans RAW MNO Event data.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="components.execution.event_cleaning.event_cleaning.EventCleaning" class="doc doc-heading">
          <code>EventCleaning</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="multimno.core.component.Component">Component</span></code></p>

  
      <p>Class that cleans MNO Event data</p>

            <details class="quote">
              <summary>Source code in <code>multimno/components/execution/event_cleaning/event_cleaning.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EventCleaning</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class that cleans MNO Event data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">COMPONENT_ID</span> <span class="o">=</span> <span class="s2">&quot;EventCleaning&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">general_config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">component_config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">general_config_path</span><span class="p">,</span> <span class="n">component_config_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">EventCleaning</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;timestamp_format&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_timezone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">EventCleaning</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;input_timezone&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">do_bounding_box_filtering</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span>
            <span class="n">EventCleaning</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;do_bounding_box_filtering&quot;</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bounding_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">geteval</span><span class="p">(</span><span class="n">EventCleaning</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;bounding_box&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spark_data_folder_date_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">EventCleaning</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;spark_data_folder_date_format&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">initalize_data_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bronze_event_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONFIG_BRONZE_PATHS_KEY</span><span class="p">,</span> <span class="s2">&quot;event_data_bronze&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_period_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">EventCleaning</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;data_period_start&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_period_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">EventCleaning</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;data_period_end&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_folder_date_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">EventCleaning</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;data_folder_date_format&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_destination_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">EventCleaning</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;clear_destination_directory&quot;</span><span class="p">)</span>

        <span class="c1"># Create all possible dates between start and end</span>
        <span class="c1"># It is suggested that data is already separated in date folders</span>
        <span class="c1"># with names following self.data_folder_date_format (e.g. 20230101)</span>
        <span class="n">sdate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_period_start</span><span class="p">)</span>
        <span class="n">edate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_period_end</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_process_dates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">sdate</span><span class="p">,</span> <span class="n">edate</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">))</span>

        <span class="c1"># Create all input data objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_event_data_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dates_to_process</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_process_dates</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bronze_event_path</span><span class="si">}</span><span class="s2">/year=</span><span class="si">{</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">/month=</span><span class="si">{</span><span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s2">/day=</span><span class="si">{</span><span class="n">date</span><span class="o">.</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">check_if_data_path_exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dates_to_process</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input_event_data_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BronzeEventDataObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected path </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> to exist but it does not&quot;</span><span class="p">)</span>
        <span class="c1"># Output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">silver_event_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONFIG_SILVER_PATHS_KEY</span><span class="p">,</span> <span class="s2">&quot;event_data_silver&quot;</span><span class="p">)</span>
        <span class="n">silver_event_do</span> <span class="o">=</span> <span class="n">SilverEventDataObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="n">silver_event_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverEventDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">silver_event_do</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_destination_directory</span><span class="p">:</span>
            <span class="n">delete_file_or_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="n">silver_event_do</span><span class="o">.</span><span class="n">default_path</span><span class="p">)</span>

        <span class="n">event_syntactic_quality_metrics_by_column_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">CONFIG_SILVER_PATHS_KEY</span><span class="p">,</span> <span class="s2">&quot;event_syntactic_quality_metrics_by_column&quot;</span>
        <span class="p">)</span>
        <span class="n">event_syntactic_quality_metrics_by_column</span> <span class="o">=</span> <span class="n">SilverEventDataSyntacticQualityMetricsByColumn</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="n">event_syntactic_quality_metrics_by_column_path</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span>
            <span class="n">SilverEventDataSyntacticQualityMetricsByColumn</span><span class="o">.</span><span class="n">ID</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">event_syntactic_quality_metrics_by_column</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_destination_directory</span><span class="p">:</span>
            <span class="n">delete_file_or_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="n">event_syntactic_quality_metrics_by_column</span><span class="o">.</span><span class="n">default_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span> <span class="o">=</span> <span class="n">event_syntactic_quality_metrics_by_column</span>

        <span class="n">event_syntactic_quality_metrics_frequency_distribution_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">CONFIG_SILVER_PATHS_KEY</span><span class="p">,</span> <span class="s2">&quot;event_syntactic_quality_metrics_frequency_distribution&quot;</span>
        <span class="p">)</span>
        <span class="n">event_syntactic_quality_metrics_frequency_distribution</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">SilverEventDataSyntacticQualityMetricsFrequencyDistribution</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="n">event_syntactic_quality_metrics_frequency_distribution_path</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear_destination_directory</span><span class="p">:</span>
            <span class="n">delete_file_or_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="n">event_syntactic_quality_metrics_frequency_distribution</span><span class="o">.</span><span class="n">default_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span>
            <span class="n">SilverEventDataSyntacticQualityMetricsFrequencyDistribution</span><span class="o">.</span><span class="n">ID</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">event_syntactic_quality_metrics_frequency_distribution</span>
        <span class="c1"># this instance of SilverEventDataSyntacticQualityMetricsFrequencyDistribution class</span>
        <span class="c1"># will be used to write frequency distrobution of each preprocessing date (chunk)</span>
        <span class="c1"># the path argument will be changed dynamically</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span> <span class="o">=</span> <span class="n">event_syntactic_quality_metrics_frequency_distribution</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_input_do</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverEventDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_syntactic_quality_metrics_frequency_distribution</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">input_do</span><span class="p">,</span> <span class="n">current_date</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_event_data_objects</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dates_to_process</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="o">=</span> <span class="n">current_date</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading from path </span><span class="si">{</span><span class="n">input_do</span><span class="o">.</span><span class="n">default_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_input_do</span> <span class="o">=</span> <span class="n">input_do</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>  <span class="c1"># Transforms the input_df</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_syntactic_quality_metrics_by_column</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finished </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transform method </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">df_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_input_do</span><span class="o">.</span><span class="n">df</span>
        <span class="c1"># cache before each filter function because we appply action count()</span>
        <span class="n">df_events</span> <span class="o">=</span> <span class="n">df_events</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">quality_metrics_distribution_before</span> <span class="o">=</span> <span class="n">df_events</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
            <span class="n">psf</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">initial_frequency</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">df_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_nulls_and_update_qa</span><span class="p">(</span>
            <span class="n">df_events</span><span class="p">,</span>
            <span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">mcc</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">error_and_transformation_counts</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># MCC correct format verification: 3 digit value</span>
        <span class="n">df_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_invalid_mcc_and_update_qa</span><span class="p">(</span>
            <span class="n">df_events</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">error_and_transformation_counts</span>
        <span class="p">)</span>

        <span class="c1"># already cached in previous function</span>
        <span class="n">df_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_null_locations_and_update_qa</span><span class="p">(</span>
            <span class="n">df_events</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">error_and_transformation_counts</span>
        <span class="p">)</span>

        <span class="n">df_events</span> <span class="o">=</span> <span class="n">df_events</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

        <span class="c1"># Remove rows with invalid cell_ids</span>
        <span class="n">df_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_invalid_cell_id_and_update_qa</span><span class="p">(</span>
            <span class="n">df_events</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">error_and_transformation_counts</span>
        <span class="p">)</span>

        <span class="n">df_events</span> <span class="o">=</span> <span class="n">df_events</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

        <span class="n">df_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_time_column_to_timestamp_and_update_qa</span><span class="p">(</span>
            <span class="n">df_events</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_format</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_timezone</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">error_and_transformation_counts</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">df_events</span> <span class="o">=</span> <span class="n">df_events</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
        <span class="c1"># TODO: discuss is this step even needed (did since it was in Method description)</span>
        <span class="n">df_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_period_filter_and_update_qa</span><span class="p">(</span>
            <span class="n">df_events</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_period_start</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_period_end</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">error_and_transformation_counts</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_bounding_box_filtering</span><span class="p">:</span>
            <span class="n">df_events</span> <span class="o">=</span> <span class="n">df_events</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
            <span class="n">df_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounding_box_filtering_and_update_qa</span><span class="p">(</span>
                <span class="n">df_events</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">error_and_transformation_counts</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">quality_metrics_distribution_after</span> <span class="o">=</span> <span class="n">df_events</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
            <span class="n">psf</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">final_frequency</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># TODO: discuss</span>
        <span class="c1"># if we impose the rule on input data that data in a folder</span>
        <span class="c1"># is of date specified in folder name - maybe better to use F.lit()</span>
        <span class="n">df_events</span> <span class="o">=</span> <span class="n">df_events</span><span class="o">.</span><span class="n">withColumns</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">:</span> <span class="n">psf</span><span class="o">.</span><span class="n">year</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;smallint&quot;</span><span class="p">),</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">:</span> <span class="n">psf</span><span class="o">.</span><span class="n">month</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;tinyint&quot;</span><span class="p">),</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">:</span> <span class="n">psf</span><span class="o">.</span><span class="n">dayofmonth</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;tinyint&quot;</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">df_events</span> <span class="o">=</span> <span class="n">df_events</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverEventDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
            <span class="n">df_events</span><span class="o">.</span><span class="n">rdd</span><span class="p">,</span> <span class="n">SilverEventDataObject</span><span class="o">.</span><span class="n">SCHEMA</span>
        <span class="p">)</span>
        <span class="c1"># after each chunk processing clear all Cache to free memory and disk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">clearCache</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">save_syntactic_quality_metrics_frequency_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Join frequency distribution tables before and after,</span>
<span class="sd">        from after table take only final_frequency and replace nulls with 0.</span>
<span class="sd">        Create additional column date in DateType(),</span>
<span class="sd">        match the schema of SilverEventDataSyntacticQualityMetricsByColumn class</span>
<span class="sd">        Write chunk results in separate folders named by processing date</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality_metrics_distribution_before</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quality_metrics_distribution_after</span><span class="p">,</span> <span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">],</span> <span class="s2">&quot;left&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quality_metrics_distribution_before</span><span class="o">.</span><span class="n">columns</span> <span class="o">+</span> <span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">final_frequency</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">final_frequency</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">psf</span><span class="o">.</span><span class="n">to_date</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark_data_folder_date_format</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">rdd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">SCHEMA</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">save_syntactic_quality_metrics_by_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert output_qa_by_column.error_and_transformation_counts dictionary into spark df.</span>
<span class="sd">        Add additional columns, match schema of SilverEventDataSyntacticQualityMetricsByColumn class.</span>
<span class="sd">        Write results in default path of this class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.output_qa_by_column( variable, type_of_error, type_of_transformation) : value</span>
        <span class="c1"># 3 Nones to match the expected schema</span>
        <span class="n">df_tuples</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">type_of_error</span><span class="p">,</span> <span class="n">type_of_transformation</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span>
                <span class="n">variable</span><span class="p">,</span>
                <span class="n">type_of_error</span><span class="p">,</span>
                <span class="n">type_of_transformation</span><span class="p">,</span>
            <span class="p">),</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">error_and_transformation_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="n">temp_schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">StructField</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">variable</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">type_of_error</span><span class="p">,</span> <span class="n">ShortType</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">type_of_transformation</span><span class="p">,</span> <span class="n">ShortType</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">df_tuples</span><span class="p">,</span> <span class="n">temp_schema</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">withColumns</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">result_timestamp</span><span class="p">:</span> <span class="n">psf</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">current_timestamp</span><span class="p">()),</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">data_period_start</span><span class="p">:</span> <span class="n">psf</span><span class="o">.</span><span class="n">to_date</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_period_start</span><span class="p">)),</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">data_period_end</span><span class="p">:</span> <span class="n">psf</span><span class="o">.</span><span class="n">to_date</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_period_end</span><span class="p">)),</span>
            <span class="p">}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">SCHEMA</span><span class="o">.</span><span class="n">fieldNames</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">rdd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">SCHEMA</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">filter_nulls_and_update_qa</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">filter_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">error_and_transformation_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">:</span><span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loop throuh filter columns (user_id, timestamp)</span>
<span class="sd">        delete rows that have null in the corresponfing column.</span>
<span class="sd">        Counts the number of filtered records for quality metrics,</span>
<span class="sd">        for user_id also calculates the overall correct values,</span>
<span class="sd">        since null check is the one and only filter for this column</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pyspark.sql.dataframe.DataFrame): df events with possible nulls values</span>
<span class="sd">            filter_columns (list[str], optional): columns to check for nulls</span>
<span class="sd">            error_and_transformation_counts (dict[tuple:int]): dictionary to track qa</span>
<span class="sd">        Returns:</span>
<span class="sd">            pyspark.sql.dataframe.DataFrame: df without null values in specified columns</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">filter_column</span> <span class="ow">in</span> <span class="n">filter_columns</span><span class="p">:</span>
            <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">na</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">filter_column</span><span class="p">)</span>
            <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">filter_column</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">missing_value</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="c1"># because timestamp column is then also used in another filters, and no error count should be done in the last filter</span>
            <span class="k">if</span> <span class="n">filter_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">mcc</span><span class="p">]:</span>
                <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">filter_column</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">no_error</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">filter_invalid_mcc_and_update_qa</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">error_and_transformation_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">:</span><span class="nb">int</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove any rows where the value for mcc is not a 3 digit number (between 100 and 999)</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pyspark.sql.dataframe.DataFrame): dataframe of events</span>
<span class="sd">            error_and_transformation_counts (dict[tuple:int]): dictionary to track qa</span>

<span class="sd">        Returns:</span>
<span class="sd">            pyspark.sql.dataframe.DataFrame: Dataframe with erroneous values of mcc filtered out</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">mcc</span><span class="p">)</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">999</span><span class="p">))</span>
        <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">mcc</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">out_of_admissible_values</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># because timestamp column is then also used in another filters,</span>
        <span class="c1"># and no error count should be done in the last filter</span>
        <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">mcc</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">no_error</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">filter_invalid_cell_id_and_update_qa</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">error_and_transformation_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">:</span><span class="nb">int</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove any rows where the value for cell_id is not a 15 digit number</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pyspark.sql.dataframe.DataFrame): dataframe of events</span>
<span class="sd">            error_and_transformation_counts (dict[tuple:int]): dictionary to track qa</span>

<span class="sd">        Returns:</span>
<span class="sd">            pyspark.sql.dataframe.DataFrame: Dataframe with erroneous values of cell_id filtered out</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">length</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">))</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;long&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>
                <span class="o">|</span> <span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">out_of_admissible_values</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># because timestamp column is then also used in another filters,</span>
        <span class="c1"># and no error count should be done in the last filter</span>
        <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">no_error</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">filter_null_locations_and_update_qa</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">error_and_transformation_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">:</span><span class="nb">int</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter rows with inappropriate location: neither cell_id</span>
<span class="sd">        nor latitude&amp;longitude are specified. Count the number of errors,</span>
<span class="sd">        since this filter depends on several columns &quot;variable&quot; in quality metrics table will be None</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pyspark.sql.dataframe.DataFrame): df with possible null location columns</span>
<span class="sd">            error_and_transformation_counts (dict[tuple:int]): dictionary to track qa</span>

<span class="sd">        Returns:</span>
<span class="sd">            pyspark.sql.dataframe.DataFrame: filtered df with correctly specified location</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>
        <span class="p">)</span>

        <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="kc">None</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">no_location</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">filtered_df</span>

    <span class="k">def</span> <span class="nf">convert_time_column_to_timestamp_and_update_qa</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">timestampt_format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">input_timezone</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">error_and_transformation_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">:</span><span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Based on config params timestampt format and input timezone</span>
<span class="sd">        convert timestampt column from string to timestampt type, if</span>
<span class="sd">        filter rows with failed conversion.</span>
<span class="sd">        Count number of succesful timestampt transformations and number of</span>
<span class="sd">        errors</span>
<span class="sd">        Args:</span>
<span class="sd">            df (pyspark.sql.dataframe.DataFrame): df with timestampt column</span>
<span class="sd">            timestampt_format (str): expected string format to use in time conversion</span>
<span class="sd">            input_timezone (str): _description_</span>
<span class="sd">            error_and_transformation_counts (dict[tuple:int]): dictionary to track qa</span>

<span class="sd">        Returns:</span>
<span class="sd">            pyspark.sql.dataframe.DataFrame: _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO: Check timestamp validation</span>
        <span class="c1"># Validating timestamp of format &#39;2023-01-03T03:12:00+00:00&#39; raises Exception</span>
        <span class="c1"># Error: Fail to parse &#39;2023-01-03T03:12:00+00:00&#39; in the new parser</span>
        <span class="c1"># Can we use a conditional(psf.when) to check if column can be casted?</span>
        <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
            <span class="n">psf</span><span class="o">.</span><span class="n">to_utc_timestamp</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">timestampt_format</span><span class="p">),</span> <span class="n">input_timezone</span><span class="p">),</span>
        <span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>

        <span class="n">error_and_transformation_counts</span><span class="p">[</span>
            <span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Transformations</span><span class="o">.</span><span class="n">converted_timestamp</span><span class="p">)</span>
        <span class="p">]</span> <span class="o">+=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">not_right_syntactic_format</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">filtered_df</span>

    <span class="k">def</span> <span class="nf">data_period_filter_and_update_qa</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">data_period_start</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">data_period_end</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">error_and_transformation_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">:</span><span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter rows which timestampt is not in specified date range.</span>
<span class="sd">        Count the number of error rows for quality metrics,</span>
<span class="sd">        and the number of complitely correct timestampt (that pass all corresponding filters)</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pyspark.sql.dataframe.DataFrame): df with timestamp column</span>
<span class="sd">            data_period_start (str): start of date period</span>
<span class="sd">            data_period_end (str): end of date period</span>
<span class="sd">            error_and_transformation_counts (dict[tuple:int]): dictionary to track qa</span>
<span class="sd">        Returns:</span>
<span class="sd">            pyspark.sql.dataframe.DataFrame: df with records in specified date period</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_period_start</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data_period_start</span><span class="p">)</span>
        <span class="c1"># timedelta is needed to include records happened in data_period_end</span>
        <span class="n">data_period_end</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data_period_end</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">data_period_start</span><span class="p">,</span> <span class="n">data_period_end</span><span class="p">))</span>

        <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">out_of_admissible_values</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># TODO: if we decide not to use data_period_filtering don&#39;t forget to put this in convert_time_column_to_timestamp</span>
        <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">no_error</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">filtered_df</span>

    <span class="k">def</span> <span class="nf">bounding_box_filtering_and_update_qa</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">bounding_box</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">error_and_transformation_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">:</span><span class="nb">int</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter rows which not null longitude &amp; latitude values are</span>
<span class="sd">        within coordinates of bounding box. Count the number of errors,</span>
<span class="sd">        since this filter depends on several columns &quot;variable&quot; in quality metrics table will be None</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pyspark.sql.dataframe.DataFrame): df with longitude &amp; latitude columns</span>
<span class="sd">            bounding_box (dict): coordinates of bounding box in df_events crs</span>
<span class="sd">            error_and_transformation_counts (dict[tuple:int]): dictionary to track qa</span>

<span class="sd">        Returns:</span>
<span class="sd">            pyspark.sql.dataframe.DataFrame: filtered df with records within bbox</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># coordinates of bounding box should be of the same crs of mno data</span>
        <span class="n">lat_condition</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">bounding_box</span><span class="p">[</span><span class="s2">&quot;min_lat&quot;</span><span class="p">],</span> <span class="n">bounding_box</span><span class="p">[</span><span class="s2">&quot;max_lat&quot;</span><span class="p">])</span>
            <span class="o">|</span> <span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">lon_condition</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">bounding_box</span><span class="p">[</span><span class="s2">&quot;min_lon&quot;</span><span class="p">],</span> <span class="n">bounding_box</span><span class="p">[</span><span class="s2">&quot;max_lon&quot;</span><span class="p">])</span>
            <span class="o">|</span> <span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">lat_condition</span> <span class="o">&amp;</span> <span class="n">lon_condition</span><span class="p">)</span>
        <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="kc">None</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">out_of_bounding_box</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">filtered_df</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="components.execution.event_cleaning.event_cleaning.EventCleaning.bounding_box_filtering_and_update_qa" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">bounding_box_filtering_and_update_qa</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">bounding_box</span><span class="p">,</span> <span class="n">error_and_transformation_counts</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Filter rows which not null longitude &amp; latitude values are
within coordinates of bounding box. Count the number of errors,
since this filter depends on several columns "variable" in quality metrics table will be None</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><span title="pyspark.sql.dataframe.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>df with longitude &amp; latitude columns</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bounding_box</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>coordinates of bounding box in df_events crs</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>error_and_transformation_counts</code></td>
          <td>
                <code>dict[tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>int]): dictionary to track qa</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pyspark.sql.dataframe.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pyspark.sql.dataframe.DataFrame: filtered df with records within bbox</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>multimno/components/execution/event_cleaning/event_cleaning.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bounding_box_filtering_and_update_qa</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">bounding_box</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">error_and_transformation_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">:</span><span class="nb">int</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter rows which not null longitude &amp; latitude values are</span>
<span class="sd">    within coordinates of bounding box. Count the number of errors,</span>
<span class="sd">    since this filter depends on several columns &quot;variable&quot; in quality metrics table will be None</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pyspark.sql.dataframe.DataFrame): df with longitude &amp; latitude columns</span>
<span class="sd">        bounding_box (dict): coordinates of bounding box in df_events crs</span>
<span class="sd">        error_and_transformation_counts (dict[tuple:int]): dictionary to track qa</span>

<span class="sd">    Returns:</span>
<span class="sd">        pyspark.sql.dataframe.DataFrame: filtered df with records within bbox</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># coordinates of bounding box should be of the same crs of mno data</span>
    <span class="n">lat_condition</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">bounding_box</span><span class="p">[</span><span class="s2">&quot;min_lat&quot;</span><span class="p">],</span> <span class="n">bounding_box</span><span class="p">[</span><span class="s2">&quot;max_lat&quot;</span><span class="p">])</span>
        <span class="o">|</span> <span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">lon_condition</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">bounding_box</span><span class="p">[</span><span class="s2">&quot;min_lon&quot;</span><span class="p">],</span> <span class="n">bounding_box</span><span class="p">[</span><span class="s2">&quot;max_lon&quot;</span><span class="p">])</span>
        <span class="o">|</span> <span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">lat_condition</span> <span class="o">&amp;</span> <span class="n">lon_condition</span><span class="p">)</span>
    <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="kc">None</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">out_of_bounding_box</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">filtered_df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="components.execution.event_cleaning.event_cleaning.EventCleaning.convert_time_column_to_timestamp_and_update_qa" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">convert_time_column_to_timestamp_and_update_qa</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">timestampt_format</span><span class="p">,</span> <span class="n">input_timezone</span><span class="p">,</span> <span class="n">error_and_transformation_counts</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Based on config params timestampt format and input timezone
convert timestampt column from string to timestampt type, if
filter rows with failed conversion.
Count number of succesful timestampt transformations and number of
errors
Args:
    df (pyspark.sql.dataframe.DataFrame): df with timestampt column
    timestampt_format (str): expected string format to use in time conversion
    input_timezone (str): <em>description</em>
    error_and_transformation_counts (dict[tuple:int]): dictionary to track qa</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pyspark.sql.dataframe.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pyspark.sql.dataframe.DataFrame: <em>description</em></p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>multimno/components/execution/event_cleaning/event_cleaning.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_time_column_to_timestamp_and_update_qa</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">timestampt_format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">input_timezone</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">error_and_transformation_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">:</span><span class="nb">int</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Based on config params timestampt format and input timezone</span>
<span class="sd">    convert timestampt column from string to timestampt type, if</span>
<span class="sd">    filter rows with failed conversion.</span>
<span class="sd">    Count number of succesful timestampt transformations and number of</span>
<span class="sd">    errors</span>
<span class="sd">    Args:</span>
<span class="sd">        df (pyspark.sql.dataframe.DataFrame): df with timestampt column</span>
<span class="sd">        timestampt_format (str): expected string format to use in time conversion</span>
<span class="sd">        input_timezone (str): _description_</span>
<span class="sd">        error_and_transformation_counts (dict[tuple:int]): dictionary to track qa</span>

<span class="sd">    Returns:</span>
<span class="sd">        pyspark.sql.dataframe.DataFrame: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: Check timestamp validation</span>
    <span class="c1"># Validating timestamp of format &#39;2023-01-03T03:12:00+00:00&#39; raises Exception</span>
    <span class="c1"># Error: Fail to parse &#39;2023-01-03T03:12:00+00:00&#39; in the new parser</span>
    <span class="c1"># Can we use a conditional(psf.when) to check if column can be casted?</span>
    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
        <span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
        <span class="n">psf</span><span class="o">.</span><span class="n">to_utc_timestamp</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">timestampt_format</span><span class="p">),</span> <span class="n">input_timezone</span><span class="p">),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>

    <span class="n">error_and_transformation_counts</span><span class="p">[</span>
        <span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Transformations</span><span class="o">.</span><span class="n">converted_timestamp</span><span class="p">)</span>
    <span class="p">]</span> <span class="o">+=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">not_right_syntactic_format</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">filtered_df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="components.execution.event_cleaning.event_cleaning.EventCleaning.data_period_filter_and_update_qa" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">data_period_filter_and_update_qa</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">data_period_start</span><span class="p">,</span> <span class="n">data_period_end</span><span class="p">,</span> <span class="n">error_and_transformation_counts</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Filter rows which timestampt is not in specified date range.
Count the number of error rows for quality metrics,
and the number of complitely correct timestampt (that pass all corresponding filters)</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><span title="pyspark.sql.dataframe.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>df with timestamp column</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>data_period_start</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>start of date period</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>data_period_end</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>end of date period</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>error_and_transformation_counts</code></td>
          <td>
                <code>dict[tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>int]): dictionary to track qa</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns:
    pyspark.sql.dataframe.DataFrame: df with records in specified date period</p>

          <details class="quote">
            <summary>Source code in <code>multimno/components/execution/event_cleaning/event_cleaning.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">data_period_filter_and_update_qa</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">data_period_start</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">data_period_end</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">error_and_transformation_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">:</span><span class="nb">int</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter rows which timestampt is not in specified date range.</span>
<span class="sd">    Count the number of error rows for quality metrics,</span>
<span class="sd">    and the number of complitely correct timestampt (that pass all corresponding filters)</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pyspark.sql.dataframe.DataFrame): df with timestamp column</span>
<span class="sd">        data_period_start (str): start of date period</span>
<span class="sd">        data_period_end (str): end of date period</span>
<span class="sd">        error_and_transformation_counts (dict[tuple:int]): dictionary to track qa</span>
<span class="sd">    Returns:</span>
<span class="sd">        pyspark.sql.dataframe.DataFrame: df with records in specified date period</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_period_start</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data_period_start</span><span class="p">)</span>
    <span class="c1"># timedelta is needed to include records happened in data_period_end</span>
    <span class="n">data_period_end</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data_period_end</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">data_period_start</span><span class="p">,</span> <span class="n">data_period_end</span><span class="p">))</span>

    <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">out_of_admissible_values</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="c1"># TODO: if we decide not to use data_period_filtering don&#39;t forget to put this in convert_time_column_to_timestamp</span>
    <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">no_error</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">filtered_df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="components.execution.event_cleaning.event_cleaning.EventCleaning.filter_invalid_cell_id_and_update_qa" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">filter_invalid_cell_id_and_update_qa</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">error_and_transformation_counts</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Remove any rows where the value for cell_id is not a 15 digit number</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><span title="pyspark.sql.dataframe.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dataframe of events</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>error_and_transformation_counts</code></td>
          <td>
                <code>dict[tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>int]): dictionary to track qa</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pyspark.sql.dataframe.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pyspark.sql.dataframe.DataFrame: Dataframe with erroneous values of cell_id filtered out</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>multimno/components/execution/event_cleaning/event_cleaning.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_invalid_cell_id_and_update_qa</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">error_and_transformation_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">:</span><span class="nb">int</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove any rows where the value for cell_id is not a 15 digit number</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pyspark.sql.dataframe.DataFrame): dataframe of events</span>
<span class="sd">        error_and_transformation_counts (dict[tuple:int]): dictionary to track qa</span>

<span class="sd">    Returns:</span>
<span class="sd">        pyspark.sql.dataframe.DataFrame: Dataframe with erroneous values of cell_id filtered out</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">length</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">))</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;long&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>
            <span class="o">|</span> <span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">out_of_admissible_values</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="c1"># because timestamp column is then also used in another filters,</span>
    <span class="c1"># and no error count should be done in the last filter</span>
    <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">no_error</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="components.execution.event_cleaning.event_cleaning.EventCleaning.filter_invalid_mcc_and_update_qa" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">filter_invalid_mcc_and_update_qa</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">error_and_transformation_counts</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Remove any rows where the value for mcc is not a 3 digit number (between 100 and 999)</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><span title="pyspark.sql.dataframe.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>dataframe of events</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>error_and_transformation_counts</code></td>
          <td>
                <code>dict[tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>int]): dictionary to track qa</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pyspark.sql.dataframe.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pyspark.sql.dataframe.DataFrame: Dataframe with erroneous values of mcc filtered out</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>multimno/components/execution/event_cleaning/event_cleaning.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_invalid_mcc_and_update_qa</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">error_and_transformation_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">:</span><span class="nb">int</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove any rows where the value for mcc is not a 3 digit number (between 100 and 999)</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pyspark.sql.dataframe.DataFrame): dataframe of events</span>
<span class="sd">        error_and_transformation_counts (dict[tuple:int]): dictionary to track qa</span>

<span class="sd">    Returns:</span>
<span class="sd">        pyspark.sql.dataframe.DataFrame: Dataframe with erroneous values of mcc filtered out</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">mcc</span><span class="p">)</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">999</span><span class="p">))</span>
    <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">mcc</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">out_of_admissible_values</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="c1"># because timestamp column is then also used in another filters,</span>
    <span class="c1"># and no error count should be done in the last filter</span>
    <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">mcc</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">no_error</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="components.execution.event_cleaning.event_cleaning.EventCleaning.filter_null_locations_and_update_qa" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">filter_null_locations_and_update_qa</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">error_and_transformation_counts</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Filter rows with inappropriate location: neither cell_id
nor latitude&amp;longitude are specified. Count the number of errors,
since this filter depends on several columns "variable" in quality metrics table will be None</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><span title="pyspark.sql.dataframe.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>df with possible null location columns</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>error_and_transformation_counts</code></td>
          <td>
                <code>dict[tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>int]): dictionary to track qa</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pyspark.sql.dataframe.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pyspark.sql.dataframe.DataFrame: filtered df with correctly specified location</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>multimno/components/execution/event_cleaning/event_cleaning.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_null_locations_and_update_qa</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">error_and_transformation_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">:</span><span class="nb">int</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter rows with inappropriate location: neither cell_id</span>
<span class="sd">    nor latitude&amp;longitude are specified. Count the number of errors,</span>
<span class="sd">    since this filter depends on several columns &quot;variable&quot; in quality metrics table will be None</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pyspark.sql.dataframe.DataFrame): df with possible null location columns</span>
<span class="sd">        error_and_transformation_counts (dict[tuple:int]): dictionary to track qa</span>

<span class="sd">    Returns:</span>
<span class="sd">        pyspark.sql.dataframe.DataFrame: filtered df with correctly specified location</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>
        <span class="o">|</span> <span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">psf</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>
    <span class="p">)</span>

    <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="kc">None</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">no_location</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">filtered_df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="components.execution.event_cleaning.event_cleaning.EventCleaning.filter_nulls_and_update_qa" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">filter_nulls_and_update_qa</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">filter_columns</span><span class="p">,</span> <span class="n">error_and_transformation_counts</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Loop throuh filter columns (user_id, timestamp)
delete rows that have null in the corresponfing column.
Counts the number of filtered records for quality metrics,
for user_id also calculates the overall correct values,
since null check is the one and only filter for this column</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><span title="pyspark.sql.dataframe.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>df events with possible nulls values</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>filter_columns</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>columns to check for nulls</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>error_and_transformation_counts</code></td>
          <td>
                <code>dict[tuple</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>int]): dictionary to track qa</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns:
    pyspark.sql.dataframe.DataFrame: df without null values in specified columns</p>

          <details class="quote">
            <summary>Source code in <code>multimno/components/execution/event_cleaning/event_cleaning.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_nulls_and_update_qa</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">filter_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">error_and_transformation_counts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">:</span><span class="nb">int</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loop throuh filter columns (user_id, timestamp)</span>
<span class="sd">    delete rows that have null in the corresponfing column.</span>
<span class="sd">    Counts the number of filtered records for quality metrics,</span>
<span class="sd">    for user_id also calculates the overall correct values,</span>
<span class="sd">    since null check is the one and only filter for this column</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pyspark.sql.dataframe.DataFrame): df events with possible nulls values</span>
<span class="sd">        filter_columns (list[str], optional): columns to check for nulls</span>
<span class="sd">        error_and_transformation_counts (dict[tuple:int]): dictionary to track qa</span>
<span class="sd">    Returns:</span>
<span class="sd">        pyspark.sql.dataframe.DataFrame: df without null values in specified columns</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">filter_column</span> <span class="ow">in</span> <span class="n">filter_columns</span><span class="p">:</span>
        <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">na</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">filter_column</span><span class="p">)</span>
        <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">filter_column</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">missing_value</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># because timestamp column is then also used in another filters, and no error count should be done in the last filter</span>
        <span class="k">if</span> <span class="n">filter_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">mcc</span><span class="p">]:</span>
            <span class="n">error_and_transformation_counts</span><span class="p">[(</span><span class="n">filter_column</span><span class="p">,</span> <span class="n">ErrorTypes</span><span class="o">.</span><span class="n">no_error</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="components.execution.event_cleaning.event_cleaning.EventCleaning.save_syntactic_quality_metrics_by_column" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save_syntactic_quality_metrics_by_column</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convert output_qa_by_column.error_and_transformation_counts dictionary into spark df.
Add additional columns, match schema of SilverEventDataSyntacticQualityMetricsByColumn class.
Write results in default path of this class</p>

          <details class="quote">
            <summary>Source code in <code>multimno/components/execution/event_cleaning/event_cleaning.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_syntactic_quality_metrics_by_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert output_qa_by_column.error_and_transformation_counts dictionary into spark df.</span>
<span class="sd">    Add additional columns, match schema of SilverEventDataSyntacticQualityMetricsByColumn class.</span>
<span class="sd">    Write results in default path of this class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># self.output_qa_by_column( variable, type_of_error, type_of_transformation) : value</span>
    <span class="c1"># 3 Nones to match the expected schema</span>
    <span class="n">df_tuples</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">type_of_error</span><span class="p">,</span> <span class="n">type_of_transformation</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span>
            <span class="n">variable</span><span class="p">,</span>
            <span class="n">type_of_error</span><span class="p">,</span>
            <span class="n">type_of_transformation</span><span class="p">,</span>
        <span class="p">),</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">error_and_transformation_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">]</span>

    <span class="n">temp_schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">StructField</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">variable</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">StructField</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">type_of_error</span><span class="p">,</span> <span class="n">ShortType</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">StructField</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">type_of_transformation</span><span class="p">,</span> <span class="n">ShortType</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">StructField</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">df_tuples</span><span class="p">,</span> <span class="n">temp_schema</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">withColumns</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">result_timestamp</span><span class="p">:</span> <span class="n">psf</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">current_timestamp</span><span class="p">()),</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">data_period_start</span><span class="p">:</span> <span class="n">psf</span><span class="o">.</span><span class="n">to_date</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_period_start</span><span class="p">)),</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">data_period_end</span><span class="p">:</span> <span class="n">psf</span><span class="o">.</span><span class="n">to_date</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_period_end</span><span class="p">)),</span>
        <span class="p">}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">SCHEMA</span><span class="o">.</span><span class="n">fieldNames</span><span class="p">())</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">rdd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">SCHEMA</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_by_column</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="components.execution.event_cleaning.event_cleaning.EventCleaning.save_syntactic_quality_metrics_frequency_distribution" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save_syntactic_quality_metrics_frequency_distribution</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Join frequency distribution tables before and after,
from after table take only final_frequency and replace nulls with 0.
Create additional column date in DateType(),
match the schema of SilverEventDataSyntacticQualityMetricsByColumn class
Write chunk results in separate folders named by processing date</p>

          <details class="quote">
            <summary>Source code in <code>multimno/components/execution/event_cleaning/event_cleaning.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_syntactic_quality_metrics_frequency_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Join frequency distribution tables before and after,</span>
<span class="sd">    from after table take only final_frequency and replace nulls with 0.</span>
<span class="sd">    Create additional column date in DateType(),</span>
<span class="sd">    match the schema of SilverEventDataSyntacticQualityMetricsByColumn class</span>
<span class="sd">    Write chunk results in separate folders named by processing date</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality_metrics_distribution_before</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quality_metrics_distribution_after</span><span class="p">,</span> <span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">],</span> <span class="s2">&quot;left&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quality_metrics_distribution_before</span><span class="o">.</span><span class="n">columns</span> <span class="o">+</span> <span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">final_frequency</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">final_frequency</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
        <span class="n">ColNames</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">psf</span><span class="o">.</span><span class="n">to_date</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark_data_folder_date_format</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">rdd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">SCHEMA</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output_qa_freq_distribution</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>