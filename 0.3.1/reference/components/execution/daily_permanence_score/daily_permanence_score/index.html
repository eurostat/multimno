
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../../device_activity_statistics/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>daily_permanence_score - MultiMNO</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#components.execution.daily_permanence_score.daily_permanence_score" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="MultiMNO" class="md-header__button md-logo" aria-label="MultiMNO" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MultiMNO
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              daily_permanence_score
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/eurostat/multimno" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    MultiMNO
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../UserManual/" class="md-tabs__link">
        
  
    
  
  User Manual

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../DevGuide/" class="md-tabs__link">
        
  
    
  
  Dev Guide

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../pipeline/" class="md-tabs__link">
        
  
    
  
  Pipeline

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../" class="md-tabs__link">
          
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../system_requirements/" class="md-tabs__link">
        
  
    
  
  System Requirements

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../LICENSE/" class="md-tabs__link">
        
  
    
  
  License

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../autodoc/test_report/" class="md-tabs__link">
        
  
    
  
  Test Report

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="MultiMNO" class="md-nav__button md-logo" aria-label="MultiMNO" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    MultiMNO
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/eurostat/multimno" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    MultiMNO
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../UserManual/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    User Manual
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Manual
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../UserManual/configuration/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../UserManual/configuration/1_Pipeline/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    1 Pipeline
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            1 Pipeline
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/0_general_configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/1_inspire_grid_generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    InspireGridGeneration Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/2_event_data_cleaning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EventCleaning Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/3_network_cleaning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetworkCleaning Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/4_signal_strength_modeling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SignalStrengthModeling Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/5_cell_footprint_estimation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CellFootprintEstimation Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/6_cell_connection_probability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CellConnectionProbabilityEstimation Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/8_event_semantic_cleaning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SemanticCleaning Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/9_device_activity_statistics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DeviceActivityStatistics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/10_continuous_time_segmentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ContinuousTimeSegmentation Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/11_present_population_estimation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PresentPopulationEstimation Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/12_daily_permanence_score/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DailyPermanenceScore Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/13_midterm_permanence_score/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MidtermPermanenceScore Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/14_longterm_permanence_score/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LongtermPermanenceScore Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/15_usual_environment_labeling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UsualEnvironmentLabeling Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/1_Pipeline/16_usual_environment_aggregation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UsualEnvironmentAggregation Configuration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../UserManual/configuration/2_Optional/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    2 Optional
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2">
            <span class="md-nav__icon md-icon"></span>
            2 Optional
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/2_Optional/1_grid_enrichment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GridEnrichment Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/2_Optional/2_geozones_to_grid_mapping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GeozonesGridMapping Configuration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../UserManual/configuration/3_QualityWarnings/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    3 QualityWarnings
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_3" id="__nav_2_1_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3">
            <span class="md-nav__icon md-icon"></span>
            3 QualityWarnings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/3_QualityWarnings/1_network_quality_warnings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NetworkQualityWarnings Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/3_QualityWarnings/2_event_quality_warnings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EventQualityWarnings Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/3_QualityWarnings/3_semantic_quality_warnings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SemanticQualityWarnings Configuration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../UserManual/configuration/4_SyntheticMnoData/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    4 SyntheticMnoData
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_4" id="__nav_2_1_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_4">
            <span class="md-nav__icon md-icon"></span>
            4 SyntheticMnoData
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/4_SyntheticMnoData/1_synthetic_diaries/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SyntheticDiaries Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/4_SyntheticMnoData/2_synthetic_network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SyntheticNetwork Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/configuration/4_SyntheticMnoData/3_synthetic_events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SyntheticEvents Configuration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/setup_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../UserManual/execution/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Execution
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../DevGuide/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Dev Guide
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Dev Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DevGuide/1_contribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contribute
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DevGuide/2_dev_guidelines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developer Guidelines
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../pipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pipeline
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    components
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    execution
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1" id="__nav_5_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1_1">
            <span class="md-nav__icon md-icon"></span>
            execution
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../cell_connection_probability/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    cell_connection_probability
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_1" id="__nav_5_1_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_1">
            <span class="md-nav__icon md-icon"></span>
            cell_connection_probability
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cell_connection_probability/cell_connection_probability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cell_connection_probability
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../cell_footprint/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    cell_footprint
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_2" id="__nav_5_1_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_2">
            <span class="md-nav__icon md-icon"></span>
            cell_footprint
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cell_footprint/cell_footprint_estimation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cell_footprint_estimation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    daily_permanence_score
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_3" id="__nav_5_1_1_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1_1_3">
            <span class="md-nav__icon md-icon"></span>
            daily_permanence_score
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    daily_permanence_score
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    daily_permanence_score
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score" class="md-nav__link">
    <span class="md-ellipsis">
      daily_permanence_score
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore" class="md-nav__link">
    <span class="md-ellipsis">
      DailyPermanenceScore
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DailyPermanenceScore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.assert_needed_dates_data_object" class="md-nav__link">
    <span class="md-ellipsis">
      assert_needed_dates_data_object
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.build_cell_footprint_table" class="md-nav__link">
    <span class="md-ellipsis">
      build_cell_footprint_table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.build_events_table" class="md-nav__link">
    <span class="md-ellipsis">
      build_events_table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.build_time_slots_table" class="md-nav__link">
    <span class="md-ellipsis">
      build_time_slots_table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.calculate_dps" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_dps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.calculate_min_distance_between_point_lists" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_min_distance_between_point_lists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.check_needed_dates" class="md-nav__link">
    <span class="md-ellipsis">
      check_needed_dates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.detect_move_events" class="md-nav__link">
    <span class="md-ellipsis">
      detect_move_events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.determine_stay_durations" class="md-nav__link">
    <span class="md-ellipsis">
      determine_stay_durations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.filter_cell_footprint" class="md-nav__link">
    <span class="md-ellipsis">
      filter_cell_footprint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.filter_events" class="md-nav__link">
    <span class="md-ellipsis">
      filter_events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.get_grid_id_size_meters" class="md-nav__link">
    <span class="md-ellipsis">
      get_grid_id_size_meters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.get_grid_id_vertices" class="md-nav__link">
    <span class="md-ellipsis">
      get_grid_id_vertices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.grid_footprint_distance" class="md-nav__link">
    <span class="md-ellipsis">
      grid_footprint_distance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../device_activity_statistics/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    device_activity_statistics
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_4" id="__nav_5_1_1_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_4">
            <span class="md-nav__icon md-icon"></span>
            device_activity_statistics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../device_activity_statistics/device_activity_statistics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    device_activity_statistics
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../event_cleaning/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    event_cleaning
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_5" id="__nav_5_1_1_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_5">
            <span class="md-nav__icon md-icon"></span>
            event_cleaning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../event_cleaning/event_cleaning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    event_cleaning
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../event_semantic_cleaning/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    event_semantic_cleaning
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_6" id="__nav_5_1_1_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_6">
            <span class="md-nav__icon md-icon"></span>
            event_semantic_cleaning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../event_semantic_cleaning/event_semantic_cleaning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    event_semantic_cleaning
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../geozones_grid_mapping/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    geozones_grid_mapping
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_7" id="__nav_5_1_1_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_7">
            <span class="md-nav__icon md-icon"></span>
            geozones_grid_mapping
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../geozones_grid_mapping/geozones_grid_mapping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    geozones_grid_mapping
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../grid_enrichment/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    grid_enrichment
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_8" id="__nav_5_1_1_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_8">
            <span class="md-nav__icon md-icon"></span>
            grid_enrichment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../grid_enrichment/grid_enrichment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    grid_enrichment
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../longterm_permanence_score/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    longterm_permanence_score
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_9" id="__nav_5_1_1_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_9">
            <span class="md-nav__icon md-icon"></span>
            longterm_permanence_score
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../longterm_permanence_score/longterm_permanence_score/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    longterm_permanence_score
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../midterm_permanence_score/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    midterm_permanence_score
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_10" id="__nav_5_1_1_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_10">
            <span class="md-nav__icon md-icon"></span>
            midterm_permanence_score
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../midterm_permanence_score/midterm_permanence_score/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    midterm_permanence_score
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../network_cleaning/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    network_cleaning
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_11" id="__nav_5_1_1_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_11">
            <span class="md-nav__icon md-icon"></span>
            network_cleaning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network_cleaning/network_cleaning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    network_cleaning
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_12" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../present_population/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    present_population
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_12" id="__nav_5_1_1_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_12">
            <span class="md-nav__icon md-icon"></span>
            present_population
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../present_population/present_population_estimation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    present_population_estimation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_13" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../signal_strength/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    signal_strength
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_13" id="__nav_5_1_1_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_13">
            <span class="md-nav__icon md-icon"></span>
            signal_strength
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../signal_strength/signal_stength_modeling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    signal_stength_modeling
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_14" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../time_segments/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    time_segments
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_14" id="__nav_5_1_1_14_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_14">
            <span class="md-nav__icon md-icon"></span>
            time_segments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../time_segments/continuous_time_segmentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    continuous_time_segmentation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_15" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../usual_environment_aggregation/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    usual_environment_aggregation
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_15" id="__nav_5_1_1_15_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_15">
            <span class="md-nav__icon md-icon"></span>
            usual_environment_aggregation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usual_environment_aggregation/usual_environment_aggregation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    usual_environment_aggregation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_16" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../usual_environment_labeling/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    usual_environment_labeling
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_16" id="__nav_5_1_1_16_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_16">
            <span class="md-nav__icon md-icon"></span>
            usual_environment_labeling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usual_environment_labeling/usual_environment_labeling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    usual_environment_labeling
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../ingestion/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    ingestion
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2">
            <span class="md-nav__icon md-icon"></span>
            ingestion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../ingestion/grid_generation/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    grid_generation
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_2_1" id="__nav_5_1_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2_1">
            <span class="md-nav__icon md-icon"></span>
            grid_generation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ingestion/grid_generation/inspire_grid_generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    inspire_grid_generation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../ingestion/spatial_data_ingestion/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    spatial_data_ingestion
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_2_2" id="__nav_5_1_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2_2">
            <span class="md-nav__icon md-icon"></span>
            spatial_data_ingestion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ingestion/spatial_data_ingestion/gisco_data_ingestion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gisco_data_ingestion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ingestion/spatial_data_ingestion/overture_data_ingestion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    overture_data_ingestion
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../ingestion/synthetic/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    synthetic
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_2_3" id="__nav_5_1_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2_3">
            <span class="md-nav__icon md-icon"></span>
            synthetic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ingestion/synthetic/synthetic_diaries/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    synthetic_diaries
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ingestion/synthetic/synthetic_events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    synthetic_events
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ingestion/synthetic/synthetic_network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    synthetic_network
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../quality/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    quality
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3" id="__nav_5_1_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3">
            <span class="md-nav__icon md-icon"></span>
            quality
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../quality/event_quality_warnings/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    event_quality_warnings
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_1" id="__nav_5_1_3_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_1">
            <span class="md-nav__icon md-icon"></span>
            event_quality_warnings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quality/event_quality_warnings/event_quality_warnings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    event_quality_warnings
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../quality/network_quality_warnings/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    network_quality_warnings
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_2" id="__nav_5_1_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_2">
            <span class="md-nav__icon md-icon"></span>
            network_quality_warnings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quality/network_quality_warnings/network_quality_warnings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    network_quality_warnings
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../quality/semantic_quality_warnings/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    semantic_quality_warnings
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_3" id="__nav_5_1_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_3">
            <span class="md-nav__icon md-icon"></span>
            semantic_quality_warnings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quality/semantic_quality_warnings/semantic_quality_warnings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    semantic_quality_warnings
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../core/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    core
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../core/constants/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    constants
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2_1" id="__nav_5_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_1">
            <span class="md-nav__icon md-icon"></span>
            constants
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/constants/columns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    columns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/constants/conditions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    conditions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/constants/error_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    error_types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/constants/measure_definitions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    measure_definitions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/constants/network_default_thresholds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    network_default_thresholds
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/constants/period_names/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    period_names
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/constants/semantic_qw_default_thresholds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    semantic_qw_default_thresholds
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/constants/transformations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    transformations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/constants/warnings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    warnings
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../core/data_objects/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    data_objects
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2_2" id="__nav_5_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_2">
            <span class="md-nav__icon md-icon"></span>
            data_objects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_2_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../core/data_objects/bronze/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    bronze
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2_2_1" id="__nav_5_2_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_2_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            bronze
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/bronze/bronze_admin_units_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bronze_admin_units_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/bronze/bronze_countries_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bronze_countries_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/bronze/bronze_event_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bronze_event_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/bronze/bronze_geographic_zones_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bronze_geographic_zones_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/bronze/bronze_holiday_calendar_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bronze_holiday_calendar_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/bronze/bronze_landuse_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bronze_landuse_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/bronze/bronze_network_physical_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bronze_network_physical_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/bronze/bronze_synthetic_diaries_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bronze_synthetic_diaries_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/bronze/bronze_transportation_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bronze_transportation_data_object
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_2_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../core/data_objects/landing/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    landing
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2_2_2" id="__nav_5_2_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            landing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/landing/landing_geoparquet_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    landing_geoparquet_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/landing/landing_http_geojson_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    landing_http_geojson_data_object
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_2_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../core/data_objects/silver/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    silver
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2_2_3" id="__nav_5_2_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_2_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_2_3">
            <span class="md-nav__icon md-icon"></span>
            silver
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_aggregated_usual_environments_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_aggregated_usual_environments_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_cell_connection_probabilities_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_cell_connection_probabilities_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_cell_footprint_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_cell_footprint_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_cell_intersection_groups_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_cell_intersection_groups_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_daily_permanence_score_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_daily_permanence_score_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_device_activity_statistics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_device_activity_statistics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_enriched_grid_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_enriched_grid_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_event_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_event_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_event_data_syntactic_quality_metrics_by_column/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_event_data_syntactic_quality_metrics_by_column
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_event_data_syntactic_quality_metrics_frequency_distribution/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_event_data_syntactic_quality_metrics_frequency_distribution
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_event_data_syntactic_quality_warnings_for_plots/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_event_data_syntactic_quality_warnings_for_plots
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_event_data_syntactic_quality_warnings_log_table/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_event_data_syntactic_quality_warnings_log_table
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_event_flagged_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_event_flagged_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_geozones_grid_map_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_geozones_grid_map_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_grid_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_grid_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_longterm_permanence_score_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_longterm_permanence_score_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_midterm_permanence_score_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_midterm_permanence_score_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_network_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_network_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_network_data_syntactic_quality_metrics_by_column/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_network_data_syntactic_quality_metrics_by_column
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_network_data_top_frequent_errors_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_network_data_top_frequent_errors_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_network_row_error_metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_network_row_error_metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_network_syntactic_quality_warnings_log_table/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_network_syntactic_quality_warnings_log_table
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_network_syntactic_quality_warnings_plot_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_network_syntactic_quality_warnings_plot_data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_present_population_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_present_population_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_present_population_zone_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_present_population_zone_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_semantic_quality_metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_semantic_quality_metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_semantic_quality_warnings_log_table/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_semantic_quality_warnings_log_table
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_semantic_quality_warnings_plot_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_semantic_quality_warnings_plot_data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_signal_strength_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_signal_strength_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_time_segments_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_time_segments_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_usual_environment_labeling_quality_metrics_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_usual_environment_labeling_quality_metrics_data_object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/silver/silver_usual_environment_labels_data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    silver_usual_environment_labels_data_object
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/data_objects/data_object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    data_object
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/component/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    component
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/grid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    grid
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/io_interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    io_interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/log/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    log
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/spark_session/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    spark_session
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../core/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../main_multimno/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    main_multimno
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../orchestrator_multimno/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    orchestrator_multimno
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../system_requirements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System Requirements
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../LICENSE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../autodoc/test_report/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Report
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>daily_permanence_score</h1>

<div class="doc doc-object doc-module">



<a id="components.execution.daily_permanence_score.daily_permanence_score"></a>
    <div class="doc doc-contents first">

      <p>Module that implements the Daily Permanence Score functionality</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore" class="doc doc-heading">
            <code>DailyPermanenceScore</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="multimno.core.component.Component">Component</span></code></p>


      <p>A class to calculate the daily permanence score of each user per interval and grid tile.</p>

              <details class="quote">
                <summary>Source code in <code>multimno/components/execution/daily_permanence_score/daily_permanence_score.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DailyPermanenceScore</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to calculate the daily permanence score of each user per interval and grid tile.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">COMPONENT_ID</span> <span class="o">=</span> <span class="s2">&quot;DailyPermanenceScore&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">general_config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">component_config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">general_config_path</span><span class="p">,</span> <span class="n">component_config_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_period_start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;data_period_start&quot;</span><span class="p">),</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_period_end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;data_period_end&quot;</span><span class="p">),</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">time_slot_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;time_slot_number&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;max_time_thresh&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh_day</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;max_time_thresh_day&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh_night</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;max_time_thresh_night&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_speed_thresh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;max_speed_thresh&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">score_interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;score_interval&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_interval</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Only allowed value of score_interval in current version is `2`&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">event_error_flags_to_include</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">geteval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">&quot;event_error_flags_to_include&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_period_dates</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_period_start</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_period_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_period_start</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_gen</span> <span class="o">=</span> <span class="n">InspireGridGenerator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_date</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_events</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_events</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_events</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_cell_footprint</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_cell_footprint</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_cell_footprint</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">initalize_data_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">input_events_silver_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONFIG_SILVER_PATHS_KEY</span><span class="p">,</span> <span class="s2">&quot;event_data_silver_flagged&quot;</span><span class="p">)</span>
        <span class="n">input_cell_footprint_silver_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONFIG_SILVER_PATHS_KEY</span><span class="p">,</span> <span class="s2">&quot;cell_footprint_data_silver&quot;</span><span class="p">)</span>
        <span class="n">output_dps_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONFIG_SILVER_PATHS_KEY</span><span class="p">,</span> <span class="s2">&quot;daily_permanence_score_data_silver&quot;</span><span class="p">)</span>

        <span class="n">silver_events</span> <span class="o">=</span> <span class="n">SilverEventFlaggedDataObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="n">input_events_silver_path</span><span class="p">)</span>

        <span class="n">silver_cell_footprint</span> <span class="o">=</span> <span class="n">SilverCellFootprintDataObject</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span>
            <span class="n">input_cell_footprint_silver_path</span><span class="p">,</span>
            <span class="n">partition_columns</span><span class="o">=</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">silver_dps</span> <span class="o">=</span> <span class="n">SilverDailyPermanenceScoreDataObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="n">output_dps_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">input_data_objects</span> <span class="o">=</span> <span class="p">{</span><span class="n">silver_events</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span> <span class="n">silver_events</span><span class="p">,</span> <span class="n">silver_cell_footprint</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span> <span class="n">silver_cell_footprint</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span> <span class="o">=</span> <span class="p">{</span><span class="n">silver_dps</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span> <span class="n">silver_dps</span><span class="p">}</span>

    <span class="nd">@get_execution_stats</span>
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_needed_dates</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">current_date</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_period_dates</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">current_date</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing events for </span><span class="si">{</span><span class="n">current_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="o">=</span> <span class="n">current_date</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_date</span> <span class="o">=</span> <span class="n">current_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_date</span> <span class="o">=</span> <span class="n">current_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">current_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_events</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_events</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">previous_date</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_events</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_date</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">current_cell_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_cell_footprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_cell_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_cell_footprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">previous_date</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_cell_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_cell_footprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_date</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finished </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_needed_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that checks if both the dates of study and the dates necessary to generate</span>
<span class="sd">        the daily permanence scores are present in the input data (events + cell footprint).</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If there is no data for one or more of the needed dates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># needed dates: for each date D, we also need D-1 and D+1</span>
        <span class="c1"># this is built this way so it would also support definition of study</span>
        <span class="c1"># dates that are not consecutive</span>
        <span class="n">needed_dates</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="n">d</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_period_dates</span><span class="p">}</span>
            <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_period_dates</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">{</span><span class="n">d</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_period_dates</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">needed_dates</span><span class="p">)</span>
        <span class="c1"># Assert needed dates in event data:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_needed_dates_data_object</span><span class="p">(</span><span class="n">SilverEventFlaggedDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">needed_dates</span><span class="p">)</span>

        <span class="c1"># Assert needed dates in cell footprint data:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_needed_dates_data_object</span><span class="p">(</span><span class="n">SilverCellFootprintDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">needed_dates</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">assert_needed_dates_data_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_object_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">needed_dates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">datetime</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that checks if data for a set of dates exists for a data object.</span>

<span class="sd">        Args:</span>
<span class="sd">            data_object_id (str): name of the data object to check.</span>
<span class="sd">            needed_dates (List[datetime]): list of the dates for which data shall be available.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If there is no data for one or more of the needed dates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Load data</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data_objects</span><span class="p">[</span><span class="n">data_object_id</span><span class="p">]</span><span class="o">.</span><span class="n">df</span>

        <span class="c1"># Find dates that match the needed dates:</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">make_date</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">date</span><span class="p">))</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">needed_dates</span><span class="p">))</span>
            <span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
            <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">available_dates</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">date</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">}</span>

        <span class="c1"># If missing needed dates, raise error:</span>
        <span class="n">missing_dates</span> <span class="o">=</span> <span class="n">needed_dates</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">available_dates</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">missing_dates</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Missing </span><span class="si">{</span><span class="n">data_object_id</span><span class="si">}</span><span class="s2"> data for dates </span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">missing_dates</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">filter_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_date</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load events with no errors for a specific date.</span>

<span class="sd">        Args:</span>
<span class="sd">            current_date (date): current date.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: filtered events dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data_objects</span><span class="p">[</span><span class="n">SilverEventFlaggedDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">make_date</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">))</span> <span class="o">==</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">current_date</span><span class="p">))</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">error_flag</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_error_flags_to_include</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">filter_cell_footprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_date</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load cell footprints for a specific date.</span>

<span class="sd">        Args:</span>
<span class="sd">            current_date (date): current date.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: filtered cell footprint dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data_objects</span><span class="p">[</span><span class="n">SilverCellFootprintDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">make_date</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">))</span> <span class="o">==</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">current_date</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transform method </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># load users events (dates D-1, D, D+1):</span>
        <span class="n">events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_events_table</span><span class="p">()</span>

        <span class="c1"># load cell footprint (dates D-1, D, D+1):</span>
        <span class="n">cell_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_cell_footprint_table</span><span class="p">()</span>

        <span class="c1"># build time slots dataframe (date D):</span>
        <span class="n">time_slots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_time_slots_table</span><span class="p">()</span>

        <span class="c1"># differentiate &#39;move&#39; events:</span>
        <span class="n">events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_move_events</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">cell_footprint</span><span class="p">)</span>

        <span class="c1"># Determine stay durations:</span>
        <span class="n">stays</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_stay_durations</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>

        <span class="c1"># Assign stay time slot, assign duration to time slots and map to calculate DPS:</span>
        <span class="n">dps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_dps</span><span class="p">(</span><span class="n">stays</span><span class="p">,</span> <span class="n">time_slots</span><span class="p">,</span> <span class="n">cell_footprint</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverDailyPermanenceScoreDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">dps</span>

    <span class="k">def</span> <span class="nf">build_events_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load events data for date D, also adding last event of each</span>
<span class="sd">        user from date D-1 and first event of each user from D+1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: events dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># reach last event from previous day:</span>
        <span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">desc</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_events</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_events</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;row_number&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;row_number&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;row_number&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># reach first event from next day:</span>
        <span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_events</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_events</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;row_number&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;row_number&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;row_number&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># concat all events together (last of D-1 + all D + first of D+1):</span>
        <span class="n">events</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_events</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_events</span><span class="p">)</span>
            <span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_events</span><span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">loc_error</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">error_flag</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">events</span>

    <span class="k">def</span> <span class="nf">build_cell_footprint_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load cell footprint data for dates D-1, D and D+1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: cell footprint dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cell_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_cell_footprint</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_cell_footprint</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_cell_footprint</span><span class="p">)</span>

        <span class="n">cell_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_gen</span><span class="o">.</span><span class="n">grid_ids_to_centroids</span><span class="p">(</span><span class="n">cell_footprint</span><span class="p">)</span>

        <span class="n">cell_footprint</span> <span class="o">=</span> <span class="n">cell_footprint</span><span class="o">.</span><span class="n">groupBy</span><span class="p">([</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
            <span class="n">F</span><span class="o">.</span><span class="n">collect_list</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">),</span>
            <span class="n">F</span><span class="o">.</span><span class="n">collect_list</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;grid_ids&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">cell_footprint</span> <span class="o">=</span> <span class="n">cell_footprint</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
            <span class="n">STF</span><span class="o">.</span><span class="n">ST_ConcaveHull</span><span class="p">(</span><span class="n">STF</span><span class="o">.</span><span class="n">ST_Collect</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">)),</span> <span class="mf">0.5</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">cell_footprint</span>

    <span class="k">def</span> <span class="nf">build_time_slots_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build a dataframe with the specified time slots for the current date.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: time slots dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_slot_length</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_slot_number</span>

        <span class="n">time_slots_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">previous_end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span>
            <span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
            <span class="n">month</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
            <span class="n">day</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
            <span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">while</span> <span class="n">previous_end_time</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="p">:</span>
            <span class="n">init_time</span> <span class="o">=</span> <span class="n">previous_end_time</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">init_time</span> <span class="o">+</span> <span class="n">time_slot_length</span>
            <span class="n">time_slot</span> <span class="o">=</span> <span class="p">(</span><span class="n">init_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">)</span>
            <span class="n">time_slots_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_slot</span><span class="p">)</span>
            <span class="n">previous_end_time</span> <span class="o">=</span> <span class="n">end_time</span>

        <span class="n">schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">StructField</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_initial_time</span><span class="p">,</span> <span class="n">TimestampType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;time_slot_end_time&quot;</span><span class="p">,</span> <span class="n">TimestampType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">time_slots_list</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">detect_move_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">cell_footprint</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detect which of the events are associated to moves according to the</span>
<span class="sd">        distances/times from previous to posterior event and a speed threshold.</span>

<span class="sd">        Args:</span>
<span class="sd">            events (DataFrame): events dataframe.</span>
<span class="sd">            cell_footprint (DataFrame): cells footprint dataframe.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: events dataframe, with an additional &#39;is_move&#39; boolean column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># left join -&gt; bring cell footprints to events data:</span>
        <span class="n">events</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">cell_footprint</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">),</span>
            <span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">]),</span>
            <span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
            <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">],</span>
            <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">],</span>
            <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">],</span>
            <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># Add lags of timestamp, cell_id and grid_ids:</span>
        <span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
        <span class="n">lag_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="n">lag_fields</span><span class="p">:</span>
            <span class="n">events</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lf</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lag</span><span class="p">(</span><span class="n">lf</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lf</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lag</span><span class="p">(</span><span class="n">lf</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Calculate distance between grid tiles associated to events -1, 0 and +1:</span>
        <span class="c1"># Calculate speeds and determine which rows are moves:</span>
        <span class="n">events</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">events</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;dist_0_+1&quot;</span><span class="p">,</span>
                <span class="n">STF</span><span class="o">.</span><span class="n">ST_Distance</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">)),</span>
            <span class="p">)</span>
            <span class="c1"># .withColumn( </span>
            <span class="c1">#     &quot;dist_-1_0&quot;,</span>
            <span class="c1">#     STF.ST_Distance(F.col(f&quot;{ColNames.geometry}_-1&quot;), F.col(ColNames.geometry)),</span>
            <span class="c1"># )</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>    <span class="c1"># repeating the distance calculation is not necessary, a lagged column works:</span>
                <span class="s2">&quot;dist_-1_0&quot;</span><span class="p">,</span>
                <span class="n">F</span><span class="o">.</span><span class="n">lag</span><span class="p">(</span><span class="s2">&quot;dist_0_+1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;dist_-1_+1&quot;</span><span class="p">,</span>
                <span class="n">STF</span><span class="o">.</span><span class="n">ST_Distance</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">)),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;time_difference&quot;</span><span class="p">,</span>
                <span class="n">F</span><span class="o">.</span><span class="n">unix_timestamp</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">])</span>
                <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">unix_timestamp</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">]),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;max_dist&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">greatest</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;dist_-1_0&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;dist_0_+1&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;dist_-1_+1&quot;</span><span class="p">)))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;speed&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;max_dist&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;time_difference&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;is_move&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;speed&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_speed_thresh</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span>
                <span class="s2">&quot;dist_0_+1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dist_-1_0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dist_-1_+1&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
                <span class="s2">&quot;time_difference&quot;</span><span class="p">,</span>
                <span class="s2">&quot;max_dist&quot;</span><span class="p">,</span>
                <span class="s2">&quot;speed&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">events</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_grid_id_size_meters</span><span class="p">(</span><span class="n">grid_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reach the size of a grid tile from its identifier.</span>

<span class="sd">        Args:</span>
<span class="sd">            grid_id (str): ID of the corresponding grid tile.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: grid tile size, in meters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">size_txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^.*m&quot;</span><span class="p">,</span> <span class="n">grid_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">size_txt</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;km&quot;</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">size_txt</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">size_txt</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">size</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_grid_id_vertices</span><span class="p">(</span><span class="n">grid_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain the coordinates of the vertices of a given grid tile.</span>

<span class="sd">        Args:</span>
<span class="sd">            grid_id (str): ID of the corresponding grid tile.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[Tuple[float]]: list of tuples. Each tuple contains the x, y</span>
<span class="sd">                coordinates of a vertex of the corresponding grid tile.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">DailyPermanenceScore</span><span class="o">.</span><span class="n">get_grid_id_size_meters</span><span class="p">(</span><span class="n">grid_id</span><span class="p">)</span>
        <span class="n">xleft</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;E\s*(\d+)&quot;</span><span class="p">,</span> <span class="n">grid_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">ybottom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;N\s*(\d+)&quot;</span><span class="p">,</span> <span class="n">grid_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">xright</span> <span class="o">=</span> <span class="n">xleft</span> <span class="o">+</span> <span class="n">size</span>
        <span class="n">ytop</span> <span class="o">=</span> <span class="n">ybottom</span> <span class="o">+</span> <span class="n">size</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="p">(</span><span class="n">xleft</span><span class="p">,</span> <span class="n">xright</span><span class="p">)</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="p">(</span><span class="n">ybottom</span><span class="p">,</span> <span class="n">ytop</span><span class="p">)</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">vertices</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">calculate_min_distance_between_point_lists</span><span class="p">(</span><span class="n">points_i</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="n">points_j</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate minimum distance between the points in one list and the points</span>
<span class="sd">        in another list.</span>

<span class="sd">        Args:</span>
<span class="sd">            points_i (Set[Tuple[float]]): set of tuples. Each tuple contains</span>
<span class="sd">                the x, y coordinates of a point.</span>
<span class="sd">            points_j (Set[Tuple[float]]): set of tuples. Each tuple contains</span>
<span class="sd">                the x, y coordinates of a point.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: minimum distance between points in both lists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">points_i</span> <span class="o">&amp;</span> <span class="n">points_j</span><span class="p">:</span>  <span class="c1"># same point is included in both sets</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="n">min_distance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pi</span> <span class="ow">in</span> <span class="n">points_i</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pj</span> <span class="ow">in</span> <span class="n">points_j</span><span class="p">:</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="p">(</span><span class="n">pi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pj</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">pi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pj</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">min_distance</span><span class="p">:</span>
                    <span class="n">min_distance</span> <span class="o">=</span> <span class="n">distance</span>
        <span class="k">return</span> <span class="n">min_distance</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">returnType</span><span class="o">=</span><span class="n">FloatType</span><span class="p">())</span>
    <span class="k">def</span> <span class="nf">grid_footprint_distance</span><span class="p">(</span><span class="n">grid_ids_i</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">grid_ids_j</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate minimum distance between the grid tiles in one list and the</span>
<span class="sd">        grid tiles in another list, provided as grid tile IDs.</span>

<span class="sd">        Args:</span>
<span class="sd">            grid_ids_i (List[str]): IDs of the corresponding grid tiles.</span>
<span class="sd">            grid_ids_j (List[str]): IDs of the corresponding grid tiles.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: minimum distance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: optimise</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">grid_ids_i</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">grid_ids_j</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">grid_ids_i</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">grid_ids_j</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">0.0</span>

        <span class="n">gi_vertices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">gi</span> <span class="ow">in</span> <span class="n">grid_ids_i</span><span class="p">:</span>
            <span class="n">gi_vertices</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DailyPermanenceScore</span><span class="o">.</span><span class="n">get_grid_id_vertices</span><span class="p">(</span><span class="n">gi</span><span class="p">))</span>
        <span class="n">gj_vertices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">gj</span> <span class="ow">in</span> <span class="n">grid_ids_j</span><span class="p">:</span>
            <span class="n">gj_vertices</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DailyPermanenceScore</span><span class="o">.</span><span class="n">get_grid_id_vertices</span><span class="p">(</span><span class="n">gj</span><span class="p">))</span>

        <span class="n">min_distance</span> <span class="o">=</span> <span class="n">DailyPermanenceScore</span><span class="o">.</span><span class="n">calculate_min_distance_between_point_lists</span><span class="p">(</span><span class="n">gi_vertices</span><span class="p">,</span> <span class="n">gj_vertices</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">min_distance</span>

    <span class="k">def</span> <span class="nf">determine_stay_durations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the start time and end time for each stay event.</span>

<span class="sd">        Args:</span>
<span class="sd">            events (DataFrame): events dataframe.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: stays dataframe (filtering out moves).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
        <span class="n">night_start_time</span> <span class="o">=</span> <span class="n">current_datetime</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">night_end_time</span> <span class="o">=</span> <span class="n">current_datetime</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

        <span class="n">stays</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">events</span>
            <span class="c1"># Set applicable time thresholds:</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;threshold_-1&quot;</span><span class="p">,</span>
                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id_-1&quot;</span><span class="p">))</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;timestamp_-1&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">night_start_time</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">night_end_time</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh_night</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id_-1&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh_day</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh</span>
                    <span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;threshold_+1&quot;</span><span class="p">,</span>
                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id_+1&quot;</span><span class="p">))</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">night_start_time</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;timestamp_+1&quot;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">night_end_time</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh_night</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id_+1&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh_day</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh</span>
                    <span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="c1"># Calculate init_time and end_time according to thresholds and time differences between events:</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;init_time&quot;</span><span class="p">,</span>
                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;threshold_-1&quot;</span><span class="p">),</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;end_time&quot;</span><span class="p">,</span>
                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;threshold_+1&quot;</span><span class="p">),</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">)</span>
                    <span class="o">-</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="c1"># Filter out &#39;move&#39; events (keep only stays), and also drop unneeded columns:</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;is_move&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">mcc</span><span class="p">,</span>
                <span class="s2">&quot;is_move&quot;</span><span class="p">,</span>
                <span class="s2">&quot;threshold_-1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;threshold_+1&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">stays</span>

    <span class="k">def</span> <span class="nf">calculate_dps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stays</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">time_slots</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">cell_footprints</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Temporally intersect each stay interval with the specified time slots. Then</span>
<span class="sd">        calculate the number of seconds that each user stays at each grid tile within</span>
<span class="sd">        each of these time slots according to the stay intervals and the grid tiles</span>
<span class="sd">        associated to each stay.</span>

<span class="sd">        Args:</span>
<span class="sd">            stays (DataFrame): stays dataframe.</span>
<span class="sd">            time_slots (DataFrame): time slots dataframe.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: daily permanence score dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dps</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">stays</span><span class="o">.</span><span class="n">crossJoin</span><span class="p">(</span><span class="n">time_slots</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;int_init_time&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">greatest</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;init_time&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_initial_time</span><span class="p">)))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;int_end_time&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">least</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;time_slot_end_time&quot;</span><span class="p">)))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;int_duration&quot;</span><span class="p">,</span>
                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;int_init_time&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;int_end_time&quot;</span><span class="p">),</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">unix_timestamp</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;int_end_time&quot;</span><span class="p">))</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">unix_timestamp</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;int_init_time&quot;</span><span class="p">)),</span>
                <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;int_init_time&quot;</span><span class="p">,</span> <span class="s2">&quot;int_end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;init_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">unknown_dps</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">dps</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_initial_time</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_end_time</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">((</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_slot_number</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">())</span>
                    <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">)</span>
                <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span>
                <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;grid_id&quot;</span><span class="p">),</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_initial_time</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_end_time</span><span class="p">,</span>
                <span class="s2">&quot;int_duration&quot;</span><span class="p">,</span>
                <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">known_dps</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">dps</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cell_footprints</span><span class="p">,</span> <span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">],</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;grid_id&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;grid_ids&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;grid_ids&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_initial_time</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_end_time</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;grid&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">dps</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">known_dps</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">unknown_dps</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;time_slot_duration&quot;</span><span class="p">,</span>
                <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">((</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_slot_number</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">&quot;dps&quot;</span><span class="p">,</span>
                <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">F</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score_interval</span><span class="p">)</span> <span class="o">*</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;time_slot_duration&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                    <span class="n">ByteType</span><span class="p">()</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">,</span> <span class="s2">&quot;time_slot_duration&quot;</span><span class="p">)</span>
            <span class="c1"># since some stays may be from events in previous date, fix and always set current date:</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">ShortType</span><span class="p">()))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">ByteType</span><span class="p">()))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">ByteType</span><span class="p">()))</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">dps</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.assert_needed_dates_data_object" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assert_needed_dates_data_object</span><span class="p">(</span><span class="n">data_object_id</span><span class="p">,</span> <span class="n">needed_dates</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Method that checks if data for a set of dates exists for a data object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data_object_id</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the data object to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>needed_dates</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="datetime.datetime" href="https://docs.python.org/3/library/datetime.html#datetime.datetime">datetime</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of the dates for which data shall be available.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If there is no data for one or more of the needed dates.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>multimno/components/execution/daily_permanence_score/daily_permanence_score.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assert_needed_dates_data_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_object_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">needed_dates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">datetime</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method that checks if data for a set of dates exists for a data object.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_object_id (str): name of the data object to check.</span>
<span class="sd">        needed_dates (List[datetime]): list of the dates for which data shall be available.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If there is no data for one or more of the needed dates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Load data</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data_objects</span><span class="p">[</span><span class="n">data_object_id</span><span class="p">]</span><span class="o">.</span><span class="n">df</span>

    <span class="c1"># Find dates that match the needed dates:</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">make_date</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">date</span><span class="p">))</span>
        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">needed_dates</span><span class="p">))</span>
        <span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
        <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">available_dates</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">date</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">}</span>

    <span class="c1"># If missing needed dates, raise error:</span>
    <span class="n">missing_dates</span> <span class="o">=</span> <span class="n">needed_dates</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">available_dates</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">missing_dates</span><span class="p">:</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Missing </span><span class="si">{</span><span class="n">data_object_id</span><span class="si">}</span><span class="s2"> data for dates </span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">missing_dates</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.build_cell_footprint_table" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_cell_footprint_table</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load cell footprint data for dates D-1, D and D+1.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>cell footprint dataframe.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>multimno/components/execution/daily_permanence_score/daily_permanence_score.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_cell_footprint_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load cell footprint data for dates D-1, D and D+1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: cell footprint dataframe.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cell_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_cell_footprint</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_cell_footprint</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_cell_footprint</span><span class="p">)</span>

    <span class="n">cell_footprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_gen</span><span class="o">.</span><span class="n">grid_ids_to_centroids</span><span class="p">(</span><span class="n">cell_footprint</span><span class="p">)</span>

    <span class="n">cell_footprint</span> <span class="o">=</span> <span class="n">cell_footprint</span><span class="o">.</span><span class="n">groupBy</span><span class="p">([</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
        <span class="n">F</span><span class="o">.</span><span class="n">collect_list</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">),</span>
        <span class="n">F</span><span class="o">.</span><span class="n">collect_list</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;grid_ids&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">cell_footprint</span> <span class="o">=</span> <span class="n">cell_footprint</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
        <span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
        <span class="n">STF</span><span class="o">.</span><span class="n">ST_ConcaveHull</span><span class="p">(</span><span class="n">STF</span><span class="o">.</span><span class="n">ST_Collect</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">)),</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">cell_footprint</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.build_events_table" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_events_table</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load events data for date D, also adding last event of each
user from date D-1 and first event of each user from D+1.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>events dataframe.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>multimno/components/execution/daily_permanence_score/daily_permanence_score.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_events_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load events data for date D, also adding last event of each</span>
<span class="sd">    user from date D-1 and first event of each user from D+1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: events dataframe.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># reach last event from previous day:</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">desc</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">previous_events</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_events</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;row_number&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;row_number&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;row_number&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># reach first event from next day:</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">next_events</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_events</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;row_number&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;row_number&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;row_number&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># concat all events together (last of D-1 + all D + first of D+1):</span>
    <span class="n">events</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_events</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_events</span><span class="p">)</span>
        <span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_events</span><span class="p">)</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">loc_error</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">error_flag</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">events</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.build_time_slots_table" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_time_slots_table</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Build a dataframe with the specified time slots for the current date.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time slots dataframe.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>multimno/components/execution/daily_permanence_score/daily_permanence_score.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_time_slots_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build a dataframe with the specified time slots for the current date.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: time slots dataframe.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time_slot_length</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_slot_number</span>

    <span class="n">time_slots_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">previous_end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span>
        <span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
        <span class="n">month</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
        <span class="n">day</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
        <span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">while</span> <span class="n">previous_end_time</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="p">:</span>
        <span class="n">init_time</span> <span class="o">=</span> <span class="n">previous_end_time</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">init_time</span> <span class="o">+</span> <span class="n">time_slot_length</span>
        <span class="n">time_slot</span> <span class="o">=</span> <span class="p">(</span><span class="n">init_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">)</span>
        <span class="n">time_slots_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_slot</span><span class="p">)</span>
        <span class="n">previous_end_time</span> <span class="o">=</span> <span class="n">end_time</span>

    <span class="n">schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">StructField</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_initial_time</span><span class="p">,</span> <span class="n">TimestampType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
            <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;time_slot_end_time&quot;</span><span class="p">,</span> <span class="n">TimestampType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">time_slots_list</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.calculate_dps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_dps</span><span class="p">(</span><span class="n">stays</span><span class="p">,</span> <span class="n">time_slots</span><span class="p">,</span> <span class="n">cell_footprints</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Temporally intersect each stay interval with the specified time slots. Then
calculate the number of seconds that each user stays at each grid tile within
each of these time slots according to the stay intervals and the grid tiles
associated to each stay.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>stays</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>stays dataframe.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>time_slots</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time slots dataframe.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>daily permanence score dataframe.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>multimno/components/execution/daily_permanence_score/daily_permanence_score.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_dps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stays</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">time_slots</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">cell_footprints</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Temporally intersect each stay interval with the specified time slots. Then</span>
<span class="sd">    calculate the number of seconds that each user stays at each grid tile within</span>
<span class="sd">    each of these time slots according to the stay intervals and the grid tiles</span>
<span class="sd">    associated to each stay.</span>

<span class="sd">    Args:</span>
<span class="sd">        stays (DataFrame): stays dataframe.</span>
<span class="sd">        time_slots (DataFrame): time slots dataframe.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: daily permanence score dataframe.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dps</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">stays</span><span class="o">.</span><span class="n">crossJoin</span><span class="p">(</span><span class="n">time_slots</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;int_init_time&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">greatest</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;init_time&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_initial_time</span><span class="p">)))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;int_end_time&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">least</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;time_slot_end_time&quot;</span><span class="p">)))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;int_duration&quot;</span><span class="p">,</span>
            <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;int_init_time&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;int_end_time&quot;</span><span class="p">),</span>
                <span class="n">F</span><span class="o">.</span><span class="n">unix_timestamp</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;int_end_time&quot;</span><span class="p">))</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">unix_timestamp</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;int_init_time&quot;</span><span class="p">)),</span>
            <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;int_init_time&quot;</span><span class="p">,</span> <span class="s2">&quot;int_end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;init_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">unknown_dps</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dps</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_initial_time</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_end_time</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">((</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_slot_number</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">())</span>
                <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span>
            <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;grid_id&quot;</span><span class="p">),</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_initial_time</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_end_time</span><span class="p">,</span>
            <span class="s2">&quot;int_duration&quot;</span><span class="p">,</span>
            <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">known_dps</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dps</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cell_footprints</span><span class="p">,</span> <span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">],</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;grid_id&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;grid_ids&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;grid_ids&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_initial_time</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">time_slot_end_time</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;grid&quot;</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="n">dps</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">known_dps</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">unknown_dps</span><span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;time_slot_duration&quot;</span><span class="p">,</span>
            <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">((</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_slot_number</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">IntegerType</span><span class="p">()),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;dps&quot;</span><span class="p">,</span>
            <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">F</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score_interval</span><span class="p">)</span> <span class="o">*</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;time_slot_duration&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                <span class="n">ByteType</span><span class="p">()</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;int_duration&quot;</span><span class="p">,</span> <span class="s2">&quot;time_slot_duration&quot;</span><span class="p">)</span>
        <span class="c1"># since some stays may be from events in previous date, fix and always set current date:</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">ShortType</span><span class="p">()))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">ByteType</span><span class="p">()))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">ByteType</span><span class="p">()))</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">dps</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.calculate_min_distance_between_point_lists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_min_distance_between_point_lists</span><span class="p">(</span><span class="n">points_i</span><span class="p">,</span> <span class="n">points_j</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Calculate minimum distance between the points in one list and the points
in another list.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>points_i</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.Set" href="https://docs.python.org/3/library/typing.html#typing.Set">Set</a>[<a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>set of tuples. Each tuple contains
the x, y coordinates of a point.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>points_j</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.Set" href="https://docs.python.org/3/library/typing.html#typing.Set">Set</a>[<a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>set of tuples. Each tuple contains
the x, y coordinates of a point.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>minimum distance between points in both lists.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>multimno/components/execution/daily_permanence_score/daily_permanence_score.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">calculate_min_distance_between_point_lists</span><span class="p">(</span><span class="n">points_i</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="n">points_j</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate minimum distance between the points in one list and the points</span>
<span class="sd">    in another list.</span>

<span class="sd">    Args:</span>
<span class="sd">        points_i (Set[Tuple[float]]): set of tuples. Each tuple contains</span>
<span class="sd">            the x, y coordinates of a point.</span>
<span class="sd">        points_j (Set[Tuple[float]]): set of tuples. Each tuple contains</span>
<span class="sd">            the x, y coordinates of a point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: minimum distance between points in both lists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">points_i</span> <span class="o">&amp;</span> <span class="n">points_j</span><span class="p">:</span>  <span class="c1"># same point is included in both sets</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="n">min_distance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">pi</span> <span class="ow">in</span> <span class="n">points_i</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pj</span> <span class="ow">in</span> <span class="n">points_j</span><span class="p">:</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="p">(</span><span class="n">pi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pj</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">pi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pj</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">min_distance</span><span class="p">:</span>
                <span class="n">min_distance</span> <span class="o">=</span> <span class="n">distance</span>
    <span class="k">return</span> <span class="n">min_distance</span><span class="o">**</span><span class="mf">0.5</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.check_needed_dates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_needed_dates</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Method that checks if both the dates of study and the dates necessary to generate
the daily permanence scores are present in the input data (events + cell footprint).</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If there is no data for one or more of the needed dates.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>multimno/components/execution/daily_permanence_score/daily_permanence_score.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_needed_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method that checks if both the dates of study and the dates necessary to generate</span>
<span class="sd">    the daily permanence scores are present in the input data (events + cell footprint).</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If there is no data for one or more of the needed dates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># needed dates: for each date D, we also need D-1 and D+1</span>
    <span class="c1"># this is built this way so it would also support definition of study</span>
    <span class="c1"># dates that are not consecutive</span>
    <span class="n">needed_dates</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">{</span><span class="n">d</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_period_dates</span><span class="p">}</span>
        <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_period_dates</span><span class="p">)</span>
        <span class="o">|</span> <span class="p">{</span><span class="n">d</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_period_dates</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">needed_dates</span><span class="p">)</span>
    <span class="c1"># Assert needed dates in event data:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assert_needed_dates_data_object</span><span class="p">(</span><span class="n">SilverEventFlaggedDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">needed_dates</span><span class="p">)</span>

    <span class="c1"># Assert needed dates in cell footprint data:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assert_needed_dates_data_object</span><span class="p">(</span><span class="n">SilverCellFootprintDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">needed_dates</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.detect_move_events" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect_move_events</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">cell_footprint</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Detect which of the events are associated to moves according to the
distances/times from previous to posterior event and a speed threshold.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>events</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>events dataframe.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cell_footprint</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>cells footprint dataframe.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>events dataframe, with an additional 'is_move' boolean column.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>multimno/components/execution/daily_permanence_score/daily_permanence_score.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">detect_move_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">cell_footprint</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detect which of the events are associated to moves according to the</span>
<span class="sd">    distances/times from previous to posterior event and a speed threshold.</span>

<span class="sd">    Args:</span>
<span class="sd">        events (DataFrame): events dataframe.</span>
<span class="sd">        cell_footprint (DataFrame): cells footprint dataframe.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: events dataframe, with an additional &#39;is_move&#39; boolean column.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># left join -&gt; bring cell footprints to events data:</span>
    <span class="n">events</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">cell_footprint</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">),</span>
        <span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">]),</span>
        <span class="s2">&quot;left&quot;</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
        <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">],</span>
        <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">],</span>
        <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">],</span>
        <span class="n">cell_footprint</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Add lags of timestamp, cell_id and grid_ids:</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
    <span class="n">lag_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">lf</span> <span class="ow">in</span> <span class="n">lag_fields</span><span class="p">:</span>
        <span class="n">events</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lf</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lag</span><span class="p">(</span><span class="n">lf</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lf</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lag</span><span class="p">(</span><span class="n">lf</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Calculate distance between grid tiles associated to events -1, 0 and +1:</span>
    <span class="c1"># Calculate speeds and determine which rows are moves:</span>
    <span class="n">events</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">events</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;dist_0_+1&quot;</span><span class="p">,</span>
            <span class="n">STF</span><span class="o">.</span><span class="n">ST_Distance</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="c1"># .withColumn( </span>
        <span class="c1">#     &quot;dist_-1_0&quot;,</span>
        <span class="c1">#     STF.ST_Distance(F.col(f&quot;{ColNames.geometry}_-1&quot;), F.col(ColNames.geometry)),</span>
        <span class="c1"># )</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>    <span class="c1"># repeating the distance calculation is not necessary, a lagged column works:</span>
            <span class="s2">&quot;dist_-1_0&quot;</span><span class="p">,</span>
            <span class="n">F</span><span class="o">.</span><span class="n">lag</span><span class="p">(</span><span class="s2">&quot;dist_0_+1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;dist_-1_+1&quot;</span><span class="p">,</span>
            <span class="n">STF</span><span class="o">.</span><span class="n">ST_Distance</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;time_difference&quot;</span><span class="p">,</span>
            <span class="n">F</span><span class="o">.</span><span class="n">unix_timestamp</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">])</span>
            <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">unix_timestamp</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">]),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;max_dist&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">greatest</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;dist_-1_0&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;dist_0_+1&quot;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;dist_-1_+1&quot;</span><span class="p">)))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;speed&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;max_dist&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;time_difference&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;is_move&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;speed&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_speed_thresh</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span>
            <span class="s2">&quot;dist_0_+1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dist_-1_0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dist_-1_+1&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
            <span class="s2">&quot;time_difference&quot;</span><span class="p">,</span>
            <span class="s2">&quot;max_dist&quot;</span><span class="p">,</span>
            <span class="s2">&quot;speed&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">events</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.determine_stay_durations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">determine_stay_durations</span><span class="p">(</span><span class="n">events</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Determine the start time and end time for each stay event.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>events</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>events dataframe.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>stays dataframe (filtering out moves).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>multimno/components/execution/daily_permanence_score/daily_permanence_score.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">determine_stay_durations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine the start time and end time for each stay event.</span>

<span class="sd">    Args:</span>
<span class="sd">        events (DataFrame): events dataframe.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: stays dataframe (filtering out moves).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
    <span class="n">night_start_time</span> <span class="o">=</span> <span class="n">current_datetime</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">night_end_time</span> <span class="o">=</span> <span class="n">current_datetime</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

    <span class="n">stays</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">events</span>
        <span class="c1"># Set applicable time thresholds:</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;threshold_-1&quot;</span><span class="p">,</span>
            <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id_-1&quot;</span><span class="p">))</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;timestamp_-1&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">night_start_time</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">night_end_time</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh_night</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id_-1&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh_day</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh</span>
                <span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;threshold_+1&quot;</span><span class="p">,</span>
            <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id_+1&quot;</span><span class="p">))</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">night_start_time</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;timestamp_+1&quot;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">night_end_time</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh_night</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;cell_id_+1&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh_day</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh</span>
                <span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="c1"># Calculate init_time and end_time according to thresholds and time differences between events:</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;init_time&quot;</span><span class="p">,</span>
            <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;threshold_-1&quot;</span><span class="p">),</span>
                <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">&quot;end_time&quot;</span><span class="p">,</span>
            <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span>
                <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;threshold_+1&quot;</span><span class="p">),</span>
                <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">)</span>
                <span class="o">-</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_time_thresh</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="c1"># Filter out &#39;move&#39; events (keep only stays), and also drop unneeded columns:</span>
        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;is_move&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">cell_id</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_-1&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">_+1&quot;</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">mcc</span><span class="p">,</span>
            <span class="s2">&quot;is_move&quot;</span><span class="p">,</span>
            <span class="s2">&quot;threshold_-1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;threshold_+1&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">stays</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.filter_cell_footprint" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_cell_footprint</span><span class="p">(</span><span class="n">current_date</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load cell footprints for a specific date.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>current_date</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="datetime.date" href="https://docs.python.org/3/library/datetime.html#datetime.date">date</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current date.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>filtered cell footprint dataframe.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>multimno/components/execution/daily_permanence_score/daily_permanence_score.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_cell_footprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_date</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load cell footprints for a specific date.</span>

<span class="sd">    Args:</span>
<span class="sd">        current_date (date): current date.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: filtered cell footprint dataframe.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data_objects</span><span class="p">[</span><span class="n">SilverCellFootprintDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">make_date</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">))</span> <span class="o">==</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">current_date</span><span class="p">))</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.filter_events" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_events</span><span class="p">(</span><span class="n">current_date</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load events with no errors for a specific date.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>current_date</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="datetime.date" href="https://docs.python.org/3/library/datetime.html#datetime.date">date</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current date.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DataFrame</code></td>            <td>
                  <code><a class="autorefs autorefs-external" title="pyspark.sql.DataFrame" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame">DataFrame</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>filtered events dataframe.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>multimno/components/execution/daily_permanence_score/daily_permanence_score.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_date</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load events with no errors for a specific date.</span>

<span class="sd">    Args:</span>
<span class="sd">        current_date (date): current date.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: filtered events dataframe.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data_objects</span><span class="p">[</span><span class="n">SilverEventFlaggedDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">make_date</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">month</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day</span><span class="p">))</span> <span class="o">==</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">current_date</span><span class="p">))</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">error_flag</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_error_flags_to_include</span><span class="p">))</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.get_grid_id_size_meters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_grid_id_size_meters</span><span class="p">(</span><span class="n">grid_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Reach the size of a grid tile from its identifier.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>grid_id</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the corresponding grid tile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>grid tile size, in meters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>multimno/components/execution/daily_permanence_score/daily_permanence_score.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_grid_id_size_meters</span><span class="p">(</span><span class="n">grid_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reach the size of a grid tile from its identifier.</span>

<span class="sd">    Args:</span>
<span class="sd">        grid_id (str): ID of the corresponding grid tile.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: grid tile size, in meters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">size_txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^.*m&quot;</span><span class="p">,</span> <span class="n">grid_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">size_txt</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;km&quot;</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">size_txt</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">size_txt</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">size</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.get_grid_id_vertices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_grid_id_vertices</span><span class="p">(</span><span class="n">grid_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Obtain the coordinates of the vertices of a given grid tile.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>grid_id</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the corresponding grid tile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Tuple[float]]: list of tuples. Each tuple contains the x, y
coordinates of a vertex of the corresponding grid tile.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>multimno/components/execution/daily_permanence_score/daily_permanence_score.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_grid_id_vertices</span><span class="p">(</span><span class="n">grid_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Obtain the coordinates of the vertices of a given grid tile.</span>

<span class="sd">    Args:</span>
<span class="sd">        grid_id (str): ID of the corresponding grid tile.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Tuple[float]]: list of tuples. Each tuple contains the x, y</span>
<span class="sd">            coordinates of a vertex of the corresponding grid tile.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">DailyPermanenceScore</span><span class="o">.</span><span class="n">get_grid_id_size_meters</span><span class="p">(</span><span class="n">grid_id</span><span class="p">)</span>
    <span class="n">xleft</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;E\s*(\d+)&quot;</span><span class="p">,</span> <span class="n">grid_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">ybottom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;N\s*(\d+)&quot;</span><span class="p">,</span> <span class="n">grid_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">xright</span> <span class="o">=</span> <span class="n">xleft</span> <span class="o">+</span> <span class="n">size</span>
    <span class="n">ytop</span> <span class="o">=</span> <span class="n">ybottom</span> <span class="o">+</span> <span class="n">size</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="p">(</span><span class="n">xleft</span><span class="p">,</span> <span class="n">xright</span><span class="p">)</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="p">(</span><span class="n">ybottom</span><span class="p">,</span> <span class="n">ytop</span><span class="p">)</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">vertices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="components.execution.daily_permanence_score.daily_permanence_score.DailyPermanenceScore.grid_footprint_distance" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">grid_footprint_distance</span><span class="p">(</span><span class="n">grid_ids_i</span><span class="p">,</span> <span class="n">grid_ids_j</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Calculate minimum distance between the grid tiles in one list and the
grid tiles in another list, provided as grid tile IDs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>grid_ids_i</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>IDs of the corresponding grid tiles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>grid_ids_j</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>IDs of the corresponding grid tiles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>minimum distance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>multimno/components/execution/daily_permanence_score/daily_permanence_score.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="nd">@F</span><span class="o">.</span><span class="n">udf</span><span class="p">(</span><span class="n">returnType</span><span class="o">=</span><span class="n">FloatType</span><span class="p">())</span>
<span class="k">def</span> <span class="nf">grid_footprint_distance</span><span class="p">(</span><span class="n">grid_ids_i</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">grid_ids_j</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate minimum distance between the grid tiles in one list and the</span>
<span class="sd">    grid tiles in another list, provided as grid tile IDs.</span>

<span class="sd">    Args:</span>
<span class="sd">        grid_ids_i (List[str]): IDs of the corresponding grid tiles.</span>
<span class="sd">        grid_ids_j (List[str]): IDs of the corresponding grid tiles.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: minimum distance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: optimise</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">grid_ids_i</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">grid_ids_j</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">grid_ids_i</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">grid_ids_j</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">gi_vertices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">gi</span> <span class="ow">in</span> <span class="n">grid_ids_i</span><span class="p">:</span>
        <span class="n">gi_vertices</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DailyPermanenceScore</span><span class="o">.</span><span class="n">get_grid_id_vertices</span><span class="p">(</span><span class="n">gi</span><span class="p">))</span>
    <span class="n">gj_vertices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">gj</span> <span class="ow">in</span> <span class="n">grid_ids_j</span><span class="p">:</span>
        <span class="n">gj_vertices</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DailyPermanenceScore</span><span class="o">.</span><span class="n">get_grid_id_vertices</span><span class="p">(</span><span class="n">gj</span><span class="p">))</span>

    <span class="n">min_distance</span> <span class="o">=</span> <span class="n">DailyPermanenceScore</span><span class="o">.</span><span class="n">calculate_min_distance_between_point_lists</span><span class="p">(</span><span class="n">gi_vertices</span><span class="p">,</span> <span class="n">gj_vertices</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">min_distance</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["toc.integrate", "navigation.path", "navigation.tabs", "navigation.tabs.sticky"], "search": "../../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>