
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../" rel="prev"/>
<link href="../../../ingestion/" rel="next"/>
<link href="../../../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.11" name="generator"/>
<title>usual_environment_labeling - MultiMNO</title>
<link href="../../../../../assets/stylesheets/main.4af4bdda.min.css" rel="stylesheet"/>
<link href="../../../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../../../assets/_mkdocstrings.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../../../../assets/stylesheets/panzoom.css" rel="stylesheet"/><meta content='{"selectors": [".d2", ".mermaid"]}' name="panzoom-data"/><meta content="material" name="panzoom-theme"/></head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#components.execution.usual_environment_labeling.usual_environment_labeling">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="MultiMNO" class="md-header__button md-logo" data-md-component="logo" href="../../../../.." title="MultiMNO">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            MultiMNO
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              usual_environment_labeling
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/eurostat/multimno" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    MultiMNO
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../UserManual/">
        
  
  
    
  
  User Manual

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../DevGuide/">
        
  
  
    
  
  Dev Guide

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../pipeline/">
        
  
  
    
  
  Pipeline

      </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../../">
          
  
  
  Reference

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../system_requirements/">
        
  
  
    
  
  System Requirements

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../LICENSE/">
        
  
  
    
  
  License

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../../autodoc/test_report/">
        
  
  
    
  
  Test Report

      </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="MultiMNO" class="md-nav__button md-logo" data-md-component="logo" href="../../../../.." title="MultiMNO">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    MultiMNO
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/eurostat/multimno" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    MultiMNO
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    User Manual
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            User Manual
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
<span class="md-ellipsis">
    Configuration
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_1">
<span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
<span class="md-ellipsis">
    1 Pipeline
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_1_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_1_1">
<span class="md-nav__icon md-icon"></span>
            1 Pipeline
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/0_general_configuration/">
<span class="md-ellipsis">
    General Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/1_inspire_grid_generation/">
<span class="md-ellipsis">
    InspireGridGeneration Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/2_event_data_cleaning/">
<span class="md-ellipsis">
    EventCleaning Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/3_network_cleaning/">
<span class="md-ellipsis">
    NetworkCleaning Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/4_cell_footprint_estimation/">
<span class="md-ellipsis">
    CellFootprintEstimation Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/5_cell_connection_probability/">
<span class="md-ellipsis">
    CellConnectionProbabilityEstimation Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/6_event_semantic_cleaning/">
<span class="md-ellipsis">
    SemanticCleaning Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/7_device_activity_statistics/">
<span class="md-ellipsis">
    DeviceActivityStatistics
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/8_continuous_time_segmentation/">
<span class="md-ellipsis">
    ContinuousTimeSegmentation Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/9_present_population_estimation/">
<span class="md-ellipsis">
    PresentPopulationEstimation Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/10_daily_permanence_score/">
<span class="md-ellipsis">
    DailyPermanenceScore Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/11_midterm_permanence_score/">
<span class="md-ellipsis">
    MidtermPermanenceScore Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/12_longterm_permanence_score/">
<span class="md-ellipsis">
    LongtermPermanenceScore Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/13_usual_environment_labeling/">
<span class="md-ellipsis">
    UsualEnvironmentLabeling Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/14_usual_environment_aggregation/">
<span class="md-ellipsis">
    UsualEnvironmentAggregation Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/15_internal_migration/">
<span class="md-ellipsis">
    InternalMigration Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/16_tourism_stays_estimation/">
<span class="md-ellipsis">
    TourismStaysEstimation Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/17_output_indicators/">
<span class="md-ellipsis">
    OutputIndicators Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/20_multimno_aggregation/">
<span class="md-ellipsis">
    MultiMNOAggregation Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/21_tourism_statistics_calculation/">
<span class="md-ellipsis">
    TourismStatisticsCalculation Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/1_Pipeline/22_tourism_outbound_statistics_calculation/">
<span class="md-ellipsis">
    TourismOutboundStatisticsCalculation Configuration
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
<span class="md-ellipsis">
    2 Optional
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_1_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_1_2">
<span class="md-nav__icon md-icon"></span>
            2 Optional
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/2_Optional/1_grid_enrichment/">
<span class="md-ellipsis">
    GridEnrichment Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/2_Optional/2_geozones_to_grid_mapping/">
<span class="md-ellipsis">
    GeozonesGridMapping Configuration
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_1_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1_3" id="__nav_2_1_3_label" tabindex="0">
<span class="md-ellipsis">
    3 QualityWarnings
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_1_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_1_3">
<span class="md-nav__icon md-icon"></span>
            3 QualityWarnings
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/3_QualityWarnings/1_network_quality_warnings/">
<span class="md-ellipsis">
    NetworkQualityWarnings Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/3_QualityWarnings/2_event_quality_warnings/">
<span class="md-ellipsis">
    EventQualityWarnings Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/3_QualityWarnings/3_semantic_quality_warnings/">
<span class="md-ellipsis">
    SemanticQualityWarnings Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/3_QualityWarnings/4_cell_footprint_quality_metrics/">
<span class="md-ellipsis">
    CellFootprintQualityMetrics Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/3_QualityWarnings/5_daily_permanence_score_quality_metrics/">
<span class="md-ellipsis">
    DailyPermanenceScoreQualityMetrics Configuration
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_1_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1_4" id="__nav_2_1_4_label" tabindex="0">
<span class="md-ellipsis">
    4 SyntheticMnoData
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_1_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_1_4">
<span class="md-nav__icon md-icon"></span>
            4 SyntheticMnoData
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/4_SyntheticMnoData/1_synthetic_diaries/">
<span class="md-ellipsis">
    SyntheticDiaries Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/4_SyntheticMnoData/2_synthetic_network/">
<span class="md-ellipsis">
    SyntheticNetwork Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/configuration/4_SyntheticMnoData/3_synthetic_events/">
<span class="md-ellipsis">
    SyntheticEvents Configuration
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/setup_guide/">
<span class="md-ellipsis">
    Setup Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/execution/">
<span class="md-ellipsis">
    Execution
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../UserManual/cloud_usage/">
<span class="md-ellipsis">
    Cloud Deployment &amp; Execution
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Dev Guide
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Dev Guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../DevGuide/1_contribute/">
<span class="md-ellipsis">
    Contribute
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../DevGuide/2_dev_guidelines/">
<span class="md-ellipsis">
    Developer Guidelines
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../pipeline/">
<span class="md-ellipsis">
    Pipeline
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
<span class="md-ellipsis">
    Reference
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_5_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
<span class="md-ellipsis">
    components
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_5_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_1">
<span class="md-nav__icon md-icon"></span>
            components
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_5_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1" id="__nav_5_1_1_label" tabindex="0">
<span class="md-ellipsis">
    execution
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_5_1_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_1_1">
<span class="md-nav__icon md-icon"></span>
            execution
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_1" id="__nav_5_1_1_1_label" tabindex="0">
<span class="md-ellipsis">
    cell_connection_probability
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_1_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_1">
<span class="md-nav__icon md-icon"></span>
            cell_connection_probability
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cell_connection_probability/cell_connection_probability/">
<span class="md-ellipsis">
    cell_connection_probability
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_2" id="__nav_5_1_1_2_label" tabindex="0">
<span class="md-ellipsis">
    cell_footprint
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_2_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_2">
<span class="md-nav__icon md-icon"></span>
            cell_footprint
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cell_footprint/cell_footprint_estimation/">
<span class="md-ellipsis">
    cell_footprint_estimation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_3" id="__nav_5_1_1_3_label" tabindex="0">
<span class="md-ellipsis">
    cell_proximity_estimation
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_3_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_3">
<span class="md-nav__icon md-icon"></span>
            cell_proximity_estimation
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cell_proximity_estimation/cell_proximity_estimation/">
<span class="md-ellipsis">
    cell_proximity_estimation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_4" id="__nav_5_1_1_4_label" tabindex="0">
<span class="md-ellipsis">
    daily_permanence_score
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_4_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_4">
<span class="md-nav__icon md-icon"></span>
            daily_permanence_score
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../daily_permanence_score/daily_permanence_score/">
<span class="md-ellipsis">
    daily_permanence_score
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_5" id="__nav_5_1_1_5_label" tabindex="0">
<span class="md-ellipsis">
    device_activity_statistics
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_5_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_5">
<span class="md-nav__icon md-icon"></span>
            device_activity_statistics
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../device_activity_statistics/device_activity_statistics/">
<span class="md-ellipsis">
    device_activity_statistics
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_6" id="__nav_5_1_1_6_label" tabindex="0">
<span class="md-ellipsis">
    event_cleaning
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_6_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_6">
<span class="md-nav__icon md-icon"></span>
            event_cleaning
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../event_cleaning/event_cleaning/">
<span class="md-ellipsis">
    event_cleaning
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_7" id="__nav_5_1_1_7_label" tabindex="0">
<span class="md-ellipsis">
    event_semantic_cleaning
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_7_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_7">
<span class="md-nav__icon md-icon"></span>
            event_semantic_cleaning
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../event_semantic_cleaning/event_semantic_cleaning/">
<span class="md-ellipsis">
    event_semantic_cleaning
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_8" id="__nav_5_1_1_8_label" tabindex="0">
<span class="md-ellipsis">
    geozones_grid_mapping
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_8_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_8">
<span class="md-nav__icon md-icon"></span>
            geozones_grid_mapping
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../geozones_grid_mapping/geozones_grid_mapping/">
<span class="md-ellipsis">
    geozones_grid_mapping
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_9" id="__nav_5_1_1_9_label" tabindex="0">
<span class="md-ellipsis">
    grid_enrichment
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_9_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_9">
<span class="md-nav__icon md-icon"></span>
            grid_enrichment
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../grid_enrichment/grid_enrichment/">
<span class="md-ellipsis">
    grid_enrichment
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_10" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_10" id="__nav_5_1_1_10_label" tabindex="0">
<span class="md-ellipsis">
    internal_migration
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_10_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_10">
<span class="md-nav__icon md-icon"></span>
            internal_migration
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../internal_migration/internal_migration/">
<span class="md-ellipsis">
    internal_migration
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_11" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_11" id="__nav_5_1_1_11_label" tabindex="0">
<span class="md-ellipsis">
    longterm_permanence_score
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_11_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_11">
<span class="md-nav__icon md-icon"></span>
            longterm_permanence_score
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../longterm_permanence_score/longterm_permanence_score/">
<span class="md-ellipsis">
    longterm_permanence_score
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_12" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_12" id="__nav_5_1_1_12_label" tabindex="0">
<span class="md-ellipsis">
    midterm_permanence_score
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_12_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_12">
<span class="md-nav__icon md-icon"></span>
            midterm_permanence_score
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../midterm_permanence_score/midterm_permanence_score/">
<span class="md-ellipsis">
    midterm_permanence_score
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_13" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_13" id="__nav_5_1_1_13_label" tabindex="0">
<span class="md-ellipsis">
    multimno_aggregation
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_13_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_13">
<span class="md-nav__icon md-icon"></span>
            multimno_aggregation
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../multimno_aggregation/multimno_aggregation/">
<span class="md-ellipsis">
    multimno_aggregation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_14" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_14" id="__nav_5_1_1_14_label" tabindex="0">
<span class="md-ellipsis">
    network_cleaning
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_14_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_14">
<span class="md-nav__icon md-icon"></span>
            network_cleaning
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../network_cleaning/network_cleaning/">
<span class="md-ellipsis">
    network_cleaning
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_15" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_15" id="__nav_5_1_1_15_label" tabindex="0">
<span class="md-ellipsis">
    output_indicators
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_15_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_15">
<span class="md-nav__icon md-icon"></span>
            output_indicators
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../output_indicators/output_indicators/">
<span class="md-ellipsis">
    output_indicators
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_16" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_16" id="__nav_5_1_1_16_label" tabindex="0">
<span class="md-ellipsis">
    present_population
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_16_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_16">
<span class="md-nav__icon md-icon"></span>
            present_population
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../present_population/present_population_estimation/">
<span class="md-ellipsis">
    present_population_estimation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_17" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_17" id="__nav_5_1_1_17_label" tabindex="0">
<span class="md-ellipsis">
    time_segments
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_17_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_17">
<span class="md-nav__icon md-icon"></span>
            time_segments
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../time_segments/continuous_time_segmentation/">
<span class="md-ellipsis">
    continuous_time_segmentation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_18" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_18" id="__nav_5_1_1_18_label" tabindex="0">
<span class="md-ellipsis">
    tourism_outbound_statistics
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_18_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_18">
<span class="md-nav__icon md-icon"></span>
            tourism_outbound_statistics
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../tourism_outbound_statistics/tourism_outbound_statistics_calculation/">
<span class="md-ellipsis">
    tourism_outbound_statistics_calculation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_19" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_19" id="__nav_5_1_1_19_label" tabindex="0">
<span class="md-ellipsis">
    tourism_statistics
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_19_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_19">
<span class="md-nav__icon md-icon"></span>
            tourism_statistics
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../tourism_statistics/tourism_statistics_calculation/">
<span class="md-ellipsis">
    tourism_statistics_calculation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_20" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_20" id="__nav_5_1_1_20_label" tabindex="0">
<span class="md-ellipsis">
    tourism_stays_estimation
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_20_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_20">
<span class="md-nav__icon md-icon"></span>
            tourism_stays_estimation
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../tourism_stays_estimation/tourism_stays_estimation/">
<span class="md-ellipsis">
    tourism_stays_estimation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_1_21" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_21" id="__nav_5_1_1_21_label" tabindex="0">
<span class="md-ellipsis">
    usual_environment_aggregation
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_1_21_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_21">
<span class="md-nav__icon md-icon"></span>
            usual_environment_aggregation
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../usual_environment_aggregation/usual_environment_aggregation/">
<span class="md-ellipsis">
    usual_environment_aggregation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_5_1_1_22" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_1_22" id="__nav_5_1_1_22_label" tabindex="0">
<span class="md-ellipsis">
    usual_environment_labeling
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_5_1_1_22_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_1_22">
<span class="md-nav__icon md-icon"></span>
            usual_environment_labeling
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    usual_environment_labeling
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    usual_environment_labeling
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#components.execution.usual_environment_labeling.usual_environment_labeling">
<span class="md-ellipsis">
      usual_environment_labeling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling">
<span class="md-ellipsis">
      UsualEnvironmentLabeling
    </span>
</a>
<nav aria-label="UsualEnvironmentLabeling" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.add_abs_ps_threshold">
<span class="md-ellipsis">
      add_abs_ps_threshold
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.calculate_device_abs_threshold">
<span class="md-ellipsis">
      calculate_device_abs_threshold
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.check_needed_day_and_interval_types">
<span class="md-ellipsis">
      check_needed_day_and_interval_types
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.compute_generic_labeling">
<span class="md-ellipsis">
      compute_generic_labeling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.compute_quality_metrics">
<span class="md-ellipsis">
      compute_quality_metrics
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.cut_tiles_at_gap">
<span class="md-ellipsis">
      cut_tiles_at_gap
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.discard_devices">
<span class="md-ellipsis">
      discard_devices
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.filter_ltps_by_target_dates">
<span class="md-ellipsis">
      filter_ltps_by_target_dates
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.find_rarely_observed_devices">
<span class="md-ellipsis">
      find_rarely_observed_devices
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.get_labeling_config">
<span class="md-ellipsis">
      get_labeling_config
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.write_label">
<span class="md-ellipsis">
      write_label
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
<span class="md-ellipsis">
    ingestion
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_1_2">
<span class="md-nav__icon md-icon"></span>
            ingestion
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_2_1" id="__nav_5_1_2_1_label" tabindex="0">
<span class="md-ellipsis">
    data_filtering
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_2_1_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_2_1">
<span class="md-nav__icon md-icon"></span>
            data_filtering
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ingestion/data_filtering/data_filtering/">
<span class="md-ellipsis">
    data_filtering
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_2_2" id="__nav_5_1_2_2_label" tabindex="0">
<span class="md-ellipsis">
    grid_generation
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_2_2_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_2_2">
<span class="md-nav__icon md-icon"></span>
            grid_generation
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ingestion/grid_generation/inspire_grid_generation/">
<span class="md-ellipsis">
    inspire_grid_generation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_2_3" id="__nav_5_1_2_3_label" tabindex="0">
<span class="md-ellipsis">
    spatial_data_ingestion
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_2_3_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_2_3">
<span class="md-nav__icon md-icon"></span>
            spatial_data_ingestion
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ingestion/spatial_data_ingestion/gisco_data_ingestion/">
<span class="md-ellipsis">
    gisco_data_ingestion
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ingestion/spatial_data_ingestion/overture_data_ingestion/">
<span class="md-ellipsis">
    overture_data_ingestion
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ingestion/spatial_data_ingestion/overture_data_transformation/">
<span class="md-ellipsis">
    overture_data_transformation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_2_4" id="__nav_5_1_2_4_label" tabindex="0">
<span class="md-ellipsis">
    synthetic
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_2_4_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_2_4">
<span class="md-nav__icon md-icon"></span>
            synthetic
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ingestion/synthetic/synthetic_diaries/">
<span class="md-ellipsis">
    synthetic_diaries
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ingestion/synthetic/synthetic_events/">
<span class="md-ellipsis">
    synthetic_events
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ingestion/synthetic/synthetic_network/">
<span class="md-ellipsis">
    synthetic_network
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_3" id="__nav_5_1_3_label" tabindex="0">
<span class="md-ellipsis">
    quality
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_1_3">
<span class="md-nav__icon md-icon"></span>
            quality
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_3_1" id="__nav_5_1_3_1_label" tabindex="0">
<span class="md-ellipsis">
    cell_footprint_quality_metrics
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_3_1_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_3_1">
<span class="md-nav__icon md-icon"></span>
            cell_footprint_quality_metrics
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../quality/cell_footprint_quality_metrics/cell_footprint_quality_metrics/">
<span class="md-ellipsis">
    cell_footprint_quality_metrics
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_3_2" id="__nav_5_1_3_2_label" tabindex="0">
<span class="md-ellipsis">
    daily_permanence_score_quality_metrics
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_3_2_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_3_2">
<span class="md-nav__icon md-icon"></span>
            daily_permanence_score_quality_metrics
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../quality/daily_permanence_score_quality_metrics/daily_permanence_score_quality_metrics/">
<span class="md-ellipsis">
    daily_permanence_score_quality_metrics
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_3_3" id="__nav_5_1_3_3_label" tabindex="0">
<span class="md-ellipsis">
    event_quality_warnings
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_3_3_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_3_3">
<span class="md-nav__icon md-icon"></span>
            event_quality_warnings
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../quality/event_quality_warnings/event_quality_warnings/">
<span class="md-ellipsis">
    event_quality_warnings
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_3_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_3_4" id="__nav_5_1_3_4_label" tabindex="0">
<span class="md-ellipsis">
    network_quality_warnings
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_3_4_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_3_4">
<span class="md-nav__icon md-icon"></span>
            network_quality_warnings
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../quality/network_quality_warnings/network_quality_warnings/">
<span class="md-ellipsis">
    network_quality_warnings
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_3_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_3_5" id="__nav_5_1_3_5_label" tabindex="0">
<span class="md-ellipsis">
    semantic_quality_warnings
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_3_5_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_1_3_5">
<span class="md-nav__icon md-icon"></span>
            semantic_quality_warnings
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../quality/semantic_quality_warnings/semantic_quality_warnings/">
<span class="md-ellipsis">
    semantic_quality_warnings
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
<span class="md-ellipsis">
    core
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
            core
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2_1" id="__nav_5_2_1_label" tabindex="0">
<span class="md-ellipsis">
    constants
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_2_1">
<span class="md-nav__icon md-icon"></span>
            constants
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/constants/columns/">
<span class="md-ellipsis">
    columns
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/constants/conditions/">
<span class="md-ellipsis">
    conditions
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/constants/domain_names/">
<span class="md-ellipsis">
    domain_names
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/constants/error_types/">
<span class="md-ellipsis">
    error_types
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/constants/measure_definitions/">
<span class="md-ellipsis">
    measure_definitions
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/constants/network_default_thresholds/">
<span class="md-ellipsis">
    network_default_thresholds
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/constants/period_names/">
<span class="md-ellipsis">
    period_names
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/constants/reserved_dataset_ids/">
<span class="md-ellipsis">
    reserved_dataset_ids
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/constants/semantic_qw_default_thresholds/">
<span class="md-ellipsis">
    semantic_qw_default_thresholds
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/constants/spatial/">
<span class="md-ellipsis">
    spatial
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/constants/transformations/">
<span class="md-ellipsis">
    transformations
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/constants/warnings/">
<span class="md-ellipsis">
    warnings
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2_2" id="__nav_5_2_2_label" tabindex="0">
<span class="md-ellipsis">
    data_objects
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_2_2">
<span class="md-nav__icon md-icon"></span>
            data_objects
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2_2_1" id="__nav_5_2_2_1_label" tabindex="0">
<span class="md-ellipsis">
    bronze
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_2_1_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_2_2_1">
<span class="md-nav__icon md-icon"></span>
            bronze
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/bronze/bronze_admin_units_data_object/">
<span class="md-ellipsis">
    bronze_admin_units_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/bronze/bronze_buildings_data_object/">
<span class="md-ellipsis">
    bronze_buildings_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/bronze/bronze_countries_data_object/">
<span class="md-ellipsis">
    bronze_countries_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/bronze/bronze_event_data_object/">
<span class="md-ellipsis">
    bronze_event_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/bronze/bronze_geographic_zones_data_object/">
<span class="md-ellipsis">
    bronze_geographic_zones_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/bronze/bronze_holiday_calendar_data_object/">
<span class="md-ellipsis">
    bronze_holiday_calendar_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/bronze/bronze_inbound_estimation_factors_data_object/">
<span class="md-ellipsis">
    bronze_inbound_estimation_factors_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/bronze/bronze_landuse_data_object/">
<span class="md-ellipsis">
    bronze_landuse_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/bronze/bronze_mcc_iso_tz_map/">
<span class="md-ellipsis">
    bronze_mcc_iso_tz_map
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/bronze/bronze_network_physical_data_object/">
<span class="md-ellipsis">
    bronze_network_physical_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/bronze/bronze_synthetic_diaries_data_object/">
<span class="md-ellipsis">
    bronze_synthetic_diaries_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/bronze/bronze_transportation_data_object/">
<span class="md-ellipsis">
    bronze_transportation_data_object
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2_2_2" id="__nav_5_2_2_2_label" tabindex="0">
<span class="md-ellipsis">
    landing
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_2_2_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_2_2_2">
<span class="md-nav__icon md-icon"></span>
            landing
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/landing/landing_geoparquet_data_object/">
<span class="md-ellipsis">
    landing_geoparquet_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/landing/landing_http_geojson_data_object/">
<span class="md-ellipsis">
    landing_http_geojson_data_object
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2_2_3" id="__nav_5_2_2_3_label" tabindex="0">
<span class="md-ellipsis">
    silver
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_2_3_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_2_2_3">
<span class="md-nav__icon md-icon"></span>
            silver
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/event_cache_data_object/">
<span class="md-ellipsis">
    event_cache_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_aggregated_usual_environments_data_object/">
<span class="md-ellipsis">
    silver_aggregated_usual_environments_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_aggregated_usual_environments_zones_data_object/">
<span class="md-ellipsis">
    silver_aggregated_usual_environments_zones_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_cell_connection_probabilities_data_object/">
<span class="md-ellipsis">
    silver_cell_connection_probabilities_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_cell_distance_data_object/">
<span class="md-ellipsis">
    silver_cell_distance_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_cell_footprint_data_object/">
<span class="md-ellipsis">
    silver_cell_footprint_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_cell_footprint_quality_metrics_data_object/">
<span class="md-ellipsis">
    silver_cell_footprint_quality_metrics_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_cell_intersection_groups_data_object/">
<span class="md-ellipsis">
    silver_cell_intersection_groups_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_daily_permanence_score_data_object/">
<span class="md-ellipsis">
    silver_daily_permanence_score_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_daily_permanence_score_quality_metrics_data_object/">
<span class="md-ellipsis">
    silver_daily_permanence_score_quality_metrics_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_device_activity_statistics/">
<span class="md-ellipsis">
    silver_device_activity_statistics
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_enriched_grid_data_object/">
<span class="md-ellipsis">
    silver_enriched_grid_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_event_data_object/">
<span class="md-ellipsis">
    silver_event_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_event_data_syntactic_quality_metrics_by_column/">
<span class="md-ellipsis">
    silver_event_data_syntactic_quality_metrics_by_column
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_event_data_syntactic_quality_metrics_frequency_distribution/">
<span class="md-ellipsis">
    silver_event_data_syntactic_quality_metrics_frequency_distribution
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_event_data_syntactic_quality_warnings_for_plots/">
<span class="md-ellipsis">
    silver_event_data_syntactic_quality_warnings_for_plots
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_event_data_syntactic_quality_warnings_log_table/">
<span class="md-ellipsis">
    silver_event_data_syntactic_quality_warnings_log_table
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_event_flagged_data_object/">
<span class="md-ellipsis">
    silver_event_flagged_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_geozones_grid_map_data_object/">
<span class="md-ellipsis">
    silver_geozones_grid_map_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_grid_data_object/">
<span class="md-ellipsis">
    silver_grid_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_internal_migration_data_object/">
<span class="md-ellipsis">
    silver_internal_migration_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_internal_migration_quality_metrics_data_object/">
<span class="md-ellipsis">
    silver_internal_migration_quality_metrics_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_longterm_permanence_score_data_object/">
<span class="md-ellipsis">
    silver_longterm_permanence_score_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_midterm_permanence_score_data_object/">
<span class="md-ellipsis">
    silver_midterm_permanence_score_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_network_data_object/">
<span class="md-ellipsis">
    silver_network_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_network_data_syntactic_quality_metrics_by_column/">
<span class="md-ellipsis">
    silver_network_data_syntactic_quality_metrics_by_column
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_network_data_top_frequent_errors_data_object/">
<span class="md-ellipsis">
    silver_network_data_top_frequent_errors_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_network_row_error_metrics/">
<span class="md-ellipsis">
    silver_network_row_error_metrics
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_network_syntactic_quality_warnings_log_table/">
<span class="md-ellipsis">
    silver_network_syntactic_quality_warnings_log_table
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_network_syntactic_quality_warnings_plot_data/">
<span class="md-ellipsis">
    silver_network_syntactic_quality_warnings_plot_data
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_present_population_data_object/">
<span class="md-ellipsis">
    silver_present_population_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_present_population_zone_data_object/">
<span class="md-ellipsis">
    silver_present_population_zone_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_semantic_quality_metrics/">
<span class="md-ellipsis">
    silver_semantic_quality_metrics
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_semantic_quality_warnings_log_table/">
<span class="md-ellipsis">
    silver_semantic_quality_warnings_log_table
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_semantic_quality_warnings_plot_data/">
<span class="md-ellipsis">
    silver_semantic_quality_warnings_plot_data
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_time_segments_data_object/">
<span class="md-ellipsis">
    silver_time_segments_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_tourism_outbound_nights_spent_data_object/">
<span class="md-ellipsis">
    silver_tourism_outbound_nights_spent_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_tourism_stays_data_object/">
<span class="md-ellipsis">
    silver_tourism_stays_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_tourism_trip_avg_destinations_nights_spent_data_object/">
<span class="md-ellipsis">
    silver_tourism_trip_avg_destinations_nights_spent_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_tourism_trip_data_object/">
<span class="md-ellipsis">
    silver_tourism_trip_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_tourism_zone_departures_nights_spent_data_object/">
<span class="md-ellipsis">
    silver_tourism_zone_departures_nights_spent_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_usual_environment_labeling_quality_metrics_data_object/">
<span class="md-ellipsis">
    silver_usual_environment_labeling_quality_metrics_data_object
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/silver/silver_usual_environment_labels_data_object/">
<span class="md-ellipsis">
    silver_usual_environment_labels_data_object
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/data_objects/data_object/">
<span class="md-ellipsis">
    data_object
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/component/">
<span class="md-ellipsis">
    component
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/configuration/">
<span class="md-ellipsis">
    configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/exceptions/">
<span class="md-ellipsis">
    exceptions
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/grid/">
<span class="md-ellipsis">
    grid
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/io_interface/">
<span class="md-ellipsis">
    io_interface
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/log/">
<span class="md-ellipsis">
    log
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/quadkey_utils/">
<span class="md-ellipsis">
    quadkey_utils
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/settings/">
<span class="md-ellipsis">
    settings
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/spark_session/">
<span class="md-ellipsis">
    spark_session
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../core/utils/">
<span class="md-ellipsis">
    utils
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../main_multimno/">
<span class="md-ellipsis">
    main_multimno
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../orchestrator_multimno/">
<span class="md-ellipsis">
    orchestrator_multimno
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../system_requirements/">
<span class="md-ellipsis">
    System Requirements
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../LICENSE/">
<span class="md-ellipsis">
    License
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../autodoc/test_report/">
<span class="md-ellipsis">
    Test Report
    
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>usual_environment_labeling</h1>
<div class="doc doc-object doc-module">
<a id="components.execution.usual_environment_labeling.usual_environment_labeling"></a>
<div class="doc doc-contents first">
<p>Module that implements the Usual Environment Labeling functionality</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling">
<code>UsualEnvironmentLabeling</code>
</h2>
<div class="doc doc-contents">
<p class="doc doc-class-bases">
              Bases: <code><span title="multimno.core.component.Component">Component</span></code></p>
<p>A class to calculate the grid tiles that conform the usual environment, home and work locations of each user.</p>
<details class="quote">
<summary>Source code in <code>multimno/components/execution/usual_environment_labeling/usual_environment_labeling.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UsualEnvironmentLabeling</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    A class to calculate the grid tiles that conform the usual environment, home and work locations of each user.</span>
<span class="sd">    """</span>

    <span class="n">COMPONENT_ID</span> <span class="o">=</span> <span class="s2">"UsualEnvironmentLabeling"</span>
    <span class="n">LABEL_TO_LABELNAMES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"ue"</span><span class="p">:</span> <span class="s2">"no_label"</span><span class="p">,</span> <span class="s2">"home"</span><span class="p">:</span> <span class="s2">"home"</span><span class="p">,</span> <span class="s2">"work"</span><span class="p">:</span> <span class="s2">"work"</span><span class="p">}</span>
    <span class="n">LABEL_TO_SHORT_LABELNAMES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"ue"</span><span class="p">:</span> <span class="s2">"ue"</span><span class="p">,</span> <span class="s2">"home"</span><span class="p">:</span> <span class="s2">"h"</span><span class="p">,</span> <span class="s2">"work"</span><span class="p">:</span> <span class="s2">"w"</span><span class="p">}</span>

    <span class="n">TOTAL_PERMANENCE_THRESHOLD</span> <span class="o">=</span> <span class="s2">"total_ps_threshold"</span>
    <span class="n">TOTAL_FREQUENCY_THRESHOLD</span> <span class="o">=</span> <span class="s2">"total_freq_threshold"</span>

    <span class="n">CHECK_TO_COLUMN</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">TOTAL_PERMANENCE_THRESHOLD</span><span class="p">:</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">lps</span><span class="p">,</span>
        <span class="n">TOTAL_FREQUENCY_THRESHOLD</span><span class="p">:</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">total_frequency</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">UNLABELED_TILES</span> <span class="o">=</span> <span class="s2">"unlabeled_tiles"</span>
    <span class="n">UNLABELED_DEVICES</span> <span class="o">=</span> <span class="s2">"unlabeled_devices"</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">general_config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">component_config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">general_config_path</span><span class="p">,</span> <span class="n">component_config_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gap_ps_thresholds</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"ue"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"ue_gap_ps_threshold"</span><span class="p">),</span>
            <span class="s2">"home"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"home_gap_ps_threshold"</span><span class="p">),</span>
            <span class="s2">"work"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"work_gap_ps_threshold"</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gap_ps_threshold_is_absolute</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"ue"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">"home"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">"work"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>  <span class="c1"># TODO:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ps_thresholds</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"ue"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"ue_ps_threshold"</span><span class="p">),</span>
            <span class="s2">"home"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"home_ps_threshold"</span><span class="p">),</span>
            <span class="s2">"work"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"work_ps_threshold"</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">freq_thresholds</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"ue"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"ue_ndays_threshold"</span><span class="p">),</span>
            <span class="s2">"home"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"home_ndays_threshold"</span><span class="p">),</span>
            <span class="s2">"work"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"work_ndays_threshold"</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ps_threshold_for_rare_devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"total_ps_threshold"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_threshold_for_discontinuous_devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"total_ndays_threshold"</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">day_and_interval_type_combinations</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"ue"</span><span class="p">:</span> <span class="p">[(</span><span class="s2">"all"</span><span class="p">,</span> <span class="s2">"all"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"all"</span><span class="p">,</span> <span class="s2">"night_time"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"workdays"</span><span class="p">,</span> <span class="s2">"working_hours"</span><span class="p">)],</span>
            <span class="s2">"home"</span><span class="p">:</span> <span class="p">[(</span><span class="s2">"all"</span><span class="p">,</span> <span class="s2">"all"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"all"</span><span class="p">,</span> <span class="s2">"night_time"</span><span class="p">)],</span>
            <span class="s2">"work"</span><span class="p">:</span> <span class="p">[(</span><span class="s2">"workdays"</span><span class="p">,</span> <span class="s2">"working_hours"</span><span class="p">)],</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">season</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"season"</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Seasons</span><span class="o">.</span><span class="n">is_valid_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">):</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"season: expected one of: </span><span class="si">{</span><span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Seasons</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s2"> - found: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="si">}</span><span class="s2">"</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="c1"># Months that compose the long-term period, at least one</span>
        <span class="n">start_month</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"start_month"</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start_month</span><span class="p">,</span> <span class="s2">"%Y-%m"</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Could not parse start_month = `</span><span class="si">{</span><span class="n">start_month</span><span class="si">}</span><span class="s2">`. Expected format: YYYY-MM"</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>

        <span class="n">end_month</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"end_month"</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end_month</span><span class="p">,</span> <span class="s2">"%Y-%m"</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Could not parse end_month = `</span><span class="si">{</span><span class="n">end_month</span><span class="si">}</span><span class="s2">`. Expected format: YYYY-MM"</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">day</span><span class="o">=</span><span class="n">cal</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"End month `</span><span class="si">{</span><span class="n">end_month</span><span class="si">}</span><span class="s2">` should not be earlier than start month `</span><span class="si">{</span><span class="n">start_month</span><span class="si">}</span><span class="s2">`"</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ltps_df</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rare_devices_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discontinuous_devices_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disaggregate_to_100m_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"disaggregate_to_100m_grid"</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_gen</span> <span class="o">=</span> <span class="n">InspireGridGenerator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_home</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"label_home"</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_work</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"label_work"</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">initalize_data_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Load paths from configuration file:</span>
        <span class="n">input_ltps_silver_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONFIG_SILVER_PATHS_KEY</span><span class="p">,</span> <span class="s2">"longterm_permanence_score_data_silver"</span><span class="p">)</span>
        <span class="n">output_uelabels_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONFIG_SILVER_PATHS_KEY</span><span class="p">,</span> <span class="s2">"usual_environment_labels_data_silver"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ue_labels_cache_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">output_uelabels_path</span><span class="si">}</span><span class="s2">_cache"</span>
        <span class="n">output_quality_metrics_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">CONFIG_SILVER_PATHS_KEY</span><span class="p">,</span> <span class="s2">"usual_environment_labeling_quality_metrics_data_silver"</span>
        <span class="p">)</span>

        <span class="c1"># Clear destination directory if needed</span>
        <span class="n">clear_destination_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"clear_destination_directory"</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">clear_destination_directory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Deleting: </span><span class="si">{</span><span class="n">output_uelabels_path</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="n">delete_file_or_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="n">output_uelabels_path</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Deleting: </span><span class="si">{</span><span class="n">output_quality_metrics_path</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="n">delete_file_or_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="n">output_quality_metrics_path</span><span class="p">)</span>

        <span class="c1"># Initialise input and output data objects:</span>
        <span class="n">silver_ltps</span> <span class="o">=</span> <span class="n">SilverLongtermPermanenceScoreDataObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="n">input_ltps_silver_path</span><span class="p">)</span>
        <span class="n">ue_labels</span> <span class="o">=</span> <span class="n">SilverUsualEnvironmentLabelsDataObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="n">output_uelabels_path</span><span class="p">)</span>
        <span class="n">ue_quality_metrics</span> <span class="o">=</span> <span class="n">SilverUsualEnvironmentLabelingQualityMetricsDataObject</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="p">,</span> <span class="n">output_quality_metrics_path</span>
        <span class="p">)</span>

        <span class="c1"># Store data objects in the corresponding attributes:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_data_objects</span> <span class="o">=</span> <span class="p">{</span><span class="n">silver_ltps</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span> <span class="n">silver_ltps</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span> <span class="o">=</span> <span class="p">{</span><span class="n">ue_labels</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span> <span class="n">ue_labels</span><span class="p">,</span> <span class="n">ue_quality_metrics</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span> <span class="n">ue_quality_metrics</span><span class="p">}</span>

    <span class="nd">@get_execution_stats</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Starting </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
        <span class="c1"># read input data object:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">full_ltps_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data_objects</span><span class="p">[</span><span class="n">SilverLongtermPermanenceScoreDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">df</span>
        <span class="c1"># filtering to obtain the main dataset which this method will work with:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ltps_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_ltps_by_target_dates</span><span class="p">(</span><span class="n">full_ltps_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>

        <span class="c1"># get label configuration:</span>
        <span class="n">ue_labeling_config</span><span class="p">,</span> <span class="n">meaningful_location_labeling_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_labeling_config</span><span class="p">()</span>

        <span class="c1"># check if meaningful location labeling is enabled and remove the corresponding label configurations:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_home</span><span class="p">:</span>
            <span class="n">meaningful_location_labeling_config</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">label</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">meaningful_location_labeling_config</span> <span class="k">if</span> <span class="n">label</span><span class="p">[</span><span class="s2">"label_code"</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">"home"</span>
            <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_work</span><span class="p">:</span>
            <span class="n">meaningful_location_labeling_config</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">label</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">meaningful_location_labeling_config</span> <span class="k">if</span> <span class="n">label</span><span class="p">[</span><span class="s2">"label_code"</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">"work"</span>
            <span class="p">]</span>

        <span class="c1"># extract relevant intervals:</span>
        <span class="n">relevant_periods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_relevant_periods</span><span class="p">(</span><span class="n">ue_labeling_config</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">meaningful_location_labeling_config</span><span class="p">:</span>
            <span class="n">relevant_periods</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_relevant_periods</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
        <span class="c1"># assert that all the needed day type and interval times are available in the main dataset:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_needed_day_and_interval_types</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ltps_df</span><span class="p">,</span> <span class="n">relevant_periods</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ue_labeling_config</span> <span class="o">=</span> <span class="n">ue_labeling_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meaningful_location_labeling_config</span> <span class="o">=</span> <span class="n">meaningful_location_labeling_config</span>

        <span class="n">partition_chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_partition_chunks</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">partition_chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">partition_chunks</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Processing partition chunk: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Partition chunk: </span><span class="si">{</span><span class="n">partition_chunk</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">partition_chunk</span> <span class="o">=</span> <span class="n">partition_chunk</span>
            <span class="c1"># main transformations of this method:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">clearCache</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Generating quality metrics..."</span><span class="p">)</span>
        <span class="n">quality_metrics_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_quality_metrics</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverUsualEnvironmentLabelingQualityMetricsDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">quality_metrics_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverUsualEnvironmentLabelingQualityMetricsDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Finished </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_labeling_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get the configuration of the labeling process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): configuration of the labeling process.</span>
<span class="sd">        """</span>
        <span class="n">ue_labels</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"label_code"</span><span class="p">:</span> <span class="s2">"ue"</span><span class="p">,</span>
            <span class="s2">"ps_difference_gap_filter"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">],</span>
                <span class="s2">"gap_permanence_threshold"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_ps_thresholds</span><span class="p">[</span><span class="s2">"ue"</span><span class="p">],</span>
                <span class="s2">"is_absolute"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_ps_threshold_is_absolute</span><span class="p">[</span><span class="s2">"ue"</span><span class="p">],</span>
            <span class="p">},</span>
            <span class="s2">"labeling_rules"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"ue_1"</span><span class="p">,</span>
                    <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_PERMANENCE_THRESHOLD</span><span class="p">,</span>
                    <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_thresholds</span><span class="p">[</span><span class="s2">"ue"</span><span class="p">],</span>
                    <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">],</span>
                    <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_TILES</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"ue_2"</span><span class="p">,</span>
                    <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_PERMANENCE_THRESHOLD</span><span class="p">,</span>
                    <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_thresholds</span><span class="p">[</span><span class="s2">"ue"</span><span class="p">],</span>
                    <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span>
                        <span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">NIGHT_TIME_ALL</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_TILES</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"ue_2"</span><span class="p">,</span>
                    <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_PERMANENCE_THRESHOLD</span><span class="p">,</span>
                    <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_thresholds</span><span class="p">[</span><span class="s2">"ue"</span><span class="p">],</span>
                    <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span>
                        <span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">WORKING_HOURS_WORKDAYS</span><span class="p">,</span>
                    <span class="p">],</span>
                    <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_TILES</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"ue_3"</span><span class="p">,</span>
                    <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_FREQUENCY_THRESHOLD</span><span class="p">,</span>
                    <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_thresholds</span><span class="p">[</span><span class="s2">"ue"</span><span class="p">],</span>
                    <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">],</span>
                    <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_TILES</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">],</span>
        <span class="p">}</span>

        <span class="n">meaningful_location_labels</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">"label_code"</span><span class="p">:</span> <span class="s2">"home"</span><span class="p">,</span>
                <span class="s2">"ps_difference_gap_filter"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">],</span>
                    <span class="s2">"gap_permanence_threshold"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_ps_thresholds</span><span class="p">[</span><span class="s2">"home"</span><span class="p">],</span>
                    <span class="s2">"is_absolute"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_ps_threshold_is_absolute</span><span class="p">[</span><span class="s2">"home"</span><span class="p">],</span>
                <span class="p">},</span>
                <span class="s2">"exclude_label_codes"</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">"labeling_rules"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"h_1"</span><span class="p">,</span>
                        <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_PERMANENCE_THRESHOLD</span><span class="p">,</span>
                        <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_thresholds</span><span class="p">[</span><span class="s2">"home"</span><span class="p">],</span>
                        <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">],</span>
                        <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_DEVICES</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"h_2"</span><span class="p">,</span>
                        <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_PERMANENCE_THRESHOLD</span><span class="p">,</span>
                        <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_thresholds</span><span class="p">[</span><span class="s2">"home"</span><span class="p">],</span>
                        <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">NIGHT_TIME_ALL</span><span class="p">],</span>
                        <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_DEVICES</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"h_3"</span><span class="p">,</span>
                        <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_FREQUENCY_THRESHOLD</span><span class="p">,</span>
                        <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_thresholds</span><span class="p">[</span><span class="s2">"home"</span><span class="p">],</span>
                        <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">NIGHT_TIME_ALL</span><span class="p">],</span>
                        <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_DEVICES</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">],</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">"label_code"</span><span class="p">:</span> <span class="s2">"work"</span><span class="p">,</span>
                <span class="s2">"ps_difference_gap_filter"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">WORKING_HOURS_WORKDAYS</span><span class="p">],</span>
                    <span class="s2">"gap_permanence_threshold"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_ps_thresholds</span><span class="p">[</span><span class="s2">"work"</span><span class="p">],</span>
                    <span class="s2">"is_absolute"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_ps_threshold_is_absolute</span><span class="p">[</span><span class="s2">"work"</span><span class="p">],</span>
                <span class="p">},</span>
                <span class="s2">"exclude_label_codes"</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">"labeling_rules"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"w_1"</span><span class="p">,</span>
                        <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_PERMANENCE_THRESHOLD</span><span class="p">,</span>
                        <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_thresholds</span><span class="p">[</span><span class="s2">"work"</span><span class="p">],</span>
                        <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">WORKING_HOURS_WORKDAYS</span><span class="p">],</span>
                        <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_DEVICES</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"w_2"</span><span class="p">,</span>
                        <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_FREQUENCY_THRESHOLD</span><span class="p">,</span>
                        <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_thresholds</span><span class="p">[</span><span class="s2">"work"</span><span class="p">],</span>
                        <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">WORKING_HOURS_WORKDAYS</span><span class="p">],</span>
                        <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_DEVICES</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">],</span>
            <span class="p">},</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">ue_labels</span><span class="p">,</span> <span class="n">meaningful_location_labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_relevant_periods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labeling_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="n">all_intervals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">labeling_config</span><span class="p">[</span><span class="s2">"labeling_rules"</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">interval</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s2">"relevant_periods"</span><span class="p">]:</span>
                <span class="n">all_intervals</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">interval</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">interval</span> <span class="ow">in</span> <span class="n">labeling_config</span><span class="p">[</span><span class="s2">"ps_difference_gap_filter"</span><span class="p">][</span><span class="s2">"relevant_periods"</span><span class="p">]:</span>
            <span class="n">all_intervals</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">interval</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">all_intervals</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">filter_ltps_by_target_dates</span><span class="p">(</span>
        <span class="n">full_ltps_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">season</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Keep only the rows of the input SilverLongtermPermanenceScoreDataObject in which the start</span>
<span class="sd">        date, end date and season match the ones specified for the processing of this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            full_ltps_df (DataFrame): full dataset.</span>
<span class="sd">            start_date (dt.date): specified target start date for the execution of the method.</span>
<span class="sd">            end_date (dt.date): specified target end date for the execution of the method.</span>
<span class="sd">            season (str): specified target season for the execution of the method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: filtered dataset.</span>
<span class="sd">        """</span>
        <span class="n">filtered_ltps_df</span> <span class="o">=</span> <span class="n">full_ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span> <span class="o">==</span> <span class="n">start_date</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span> <span class="o">==</span> <span class="n">end_date</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="n">season</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">lps</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">total_frequency</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">day_type</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">time_interval</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">filtered_ltps_df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_needed_day_and_interval_types</span><span class="p">(</span>
        <span class="n">ltps_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">day_and_interval_type_combinations</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Method that checks if the needed combinations of day type and interval type are available</span>
<span class="sd">        in the provided dataset.</span>

<span class="sd">        Args:</span>
<span class="sd">            ltps_df (DataFrame): provided Long-Term Permanence Score dataset</span>
<span class="sd">            day_and_interval_type_combinations (Dict[str,List[Tuple[str,str]]]): day type and interval type</span>
<span class="sd">                combinations that are needed for the execution of the method.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If there is no data for one or more of the needed combinations of day type</span>
<span class="sd">                and interval type.</span>
<span class="sd">        """</span>
        <span class="c1"># Assert that these combinations appear at least once in the input Long-Term Permanence</span>
        <span class="c1"># Score data object:</span>
        <span class="k">for</span> <span class="n">season</span><span class="p">,</span> <span class="n">day_type</span><span class="p">,</span> <span class="n">time_interval</span> <span class="ow">in</span> <span class="n">day_and_interval_type_combinations</span><span class="p">:</span>
            <span class="n">filtered_ltps_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="n">season</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">day_type</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">time_interval</span><span class="p">)</span> <span class="o">==</span> <span class="n">time_interval</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">data_exists</span> <span class="o">=</span> <span class="n">filtered_ltps_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data_exists</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                    <span class="s2">"No Long-term Permanence Score data has been found for "</span>
                    <span class="sa">f</span><span class="s2">"day_type `</span><span class="si">{</span><span class="n">day_type</span><span class="si">}</span><span class="s2">` and time_interval `</span><span class="si">{</span><span class="n">time_interval</span><span class="si">}</span><span class="s2">`"</span>
                <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Transform method </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partition_chunk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ltps_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partition_chunk</span><span class="p">))</span>
        <span class="c1"># discard devices that will not be analysed ('rarely observed' or 'discontinuously observed'):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Discarding devices..."</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ltps_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discard_devices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ltps_df</span><span class="p">)</span>

        <span class="c1"># calculate tiles that belong to the ue (usual environment) of each device:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Calculating usual environment..."</span><span class="p">)</span>
        <span class="n">ue_tiles_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_generic_labeling</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ue_labeling_config</span><span class="p">,</span> <span class="n">is_location_labeling</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_label</span><span class="p">(</span><span class="n">ue_tiles_df</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">label_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meaningful_location_labeling_config</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Calculating </span><span class="si">{</span><span class="n">label_config</span><span class="p">[</span><span class="s1">'label_code'</span><span class="p">]</span><span class="si">}</span><span class="s2"> for ue tiles..."</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverUsualEnvironmentLabelsDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">ue_tiles_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverUsualEnvironmentLabelsDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">df</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ue_tiles_df</span> <span class="o">=</span> <span class="n">ue_tiles_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"ue"</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">)</span>

            <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_generic_labeling</span><span class="p">(</span><span class="n">label_config</span><span class="p">,</span> <span class="n">is_location_labeling</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_label</span><span class="p">(</span><span class="n">labeled_tiles_df</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labeled_tiles_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Write the labeled tiles to the output data object.</span>

<span class="sd">        Args:</span>
<span class="sd">            labeled_tiles_df (DataFrame): labeled tiles dataset.</span>
<span class="sd">        """</span>
        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">))</span>
        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">))</span>
        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">))</span>

        <span class="c1"># Repartition</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disaggregate_to_100m_grid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Dissagregating 200m to 100m grid"</span><span class="p">)</span>
            <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_gen</span><span class="o">.</span><span class="n">grid_id_from_coarser_resolution</span><span class="p">(</span>
                <span class="n">sdf</span><span class="o">=</span><span class="n">labeled_tiles_df</span><span class="p">,</span>
                <span class="n">coarse_resolution</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                <span class="n">coarse_grid_id_col</span><span class="o">=</span><span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">,</span>
                <span class="n">new_grid_id_col</span><span class="o">=</span><span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span><span class="o">*</span><span class="n">SilverUsualEnvironmentLabelsDataObject</span><span class="o">.</span><span class="n">PARTITION_COLUMNS</span><span class="p">)</span>

        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">apply_schema_casting</span><span class="p">(</span><span class="n">labeled_tiles_df</span><span class="p">,</span> <span class="n">SilverUsualEnvironmentLabelsDataObject</span><span class="o">.</span><span class="n">SCHEMA</span><span class="p">)</span>

        <span class="c1"># save the output data object:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverUsualEnvironmentLabelsDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverUsualEnvironmentLabelsDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>

        <span class="c1"># clear cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">clearCache</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_rarely_observed_devices</span><span class="p">(</span>
        <span class="n">total_observations_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">total_device_threshold</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">threshold_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Find devices (user ids) which match the condition for being considered "rarely observed".</span>
<span class="sd">        This condition consists in having a total device observation of: lps &gt; total_ps_threshold.</span>

<span class="sd">        Args:</span>
<span class="sd">            total_observations_df (DataFrame): Long-Term Permanence Score dataset, filtered by the</span>
<span class="sd">                corresponding start and end dates, and filtered by id_type == 'device_observation'.</span>
<span class="sd">            total_device_threshold (int): ps threshold.</span>
<span class="sd">            threshold_col (str): column to use for the threshold.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: two-column dataframe with the ids of the devices to discard and the corresponding user modulos.</span>
<span class="sd">        """</span>
        <span class="n">rarely_observed_user_ids</span> <span class="o">=</span> <span class="n">total_observations_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">threshold_col</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">total_device_threshold</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">rarely_observed_user_ids</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">discard_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ltps_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Given a Long-Term Permanence Score dataset (filtered for the corresponding start and end dates),</span>
<span class="sd">        discard the rows corresponding to some devices.</span>

<span class="sd">        There are 2 type of devices to discard:</span>
<span class="sd">            - rarely observed devices, based on LPS (long-term permanence score).</span>
<span class="sd">            - discontinuously observed devices, based on frequency.</span>

<span class="sd">        The user ids that are classified in any of these 2 groups are discarded from the Long-Term</span>
<span class="sd">        Permanence Score dataset, and the number of discarded users of each kind is saved to the</span>
<span class="sd">        corresponding attributes.</span>

<span class="sd">        Args:</span>
<span class="sd">            ltps_df (DataFrame): Long-Term Permanence Score dataset (filtered for the corresponding</span>
<span class="sd">                start and end dates).</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: Long-Term Permanence Score dataset (filtered for the corresponding start and</span>
<span class="sd">                end dates), without the rows associated to rarely or discontinuously observed</span>
<span class="sd">                devices.</span>
<span class="sd">        """</span>
        <span class="c1"># Initial filter of ltps dataset to keep total device observation values:</span>
        <span class="n">total_observations_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">UeGridIdType</span><span class="o">.</span><span class="n">DEVICE_OBSERVATION_STR</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">time_interval</span><span class="p">)</span> <span class="o">==</span> <span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="c1"># Rarely observed:</span>
        <span class="n">rarely_observed_user_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_rarely_observed_devices</span><span class="p">(</span>
            <span class="n">total_observations_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_threshold_for_rare_devices</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">lps</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rare_devices_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rare_devices_count</span> <span class="o">+</span> <span class="n">rarely_observed_user_ids</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="c1"># Discontinuously observed:</span>
        <span class="n">discontinuously_observed_user_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_rarely_observed_devices</span><span class="p">(</span>
            <span class="n">total_observations_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_threshold_for_discontinuous_devices</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">total_frequency</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discontinuous_devices_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discontinuous_devices_count</span> <span class="o">+</span> <span class="n">discontinuously_observed_user_ids</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="c1"># All user ids to discard:</span>
        <span class="n">discardable_user_ids</span> <span class="o">=</span> <span class="n">rarely_observed_user_ids</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">discontinuously_observed_user_ids</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>

        <span class="c1"># Filter dataset:</span>
        <span class="n">filtered_ltps_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">discardable_user_ids</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">"left_anti"</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">filtered_ltps_df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_generic_labeling</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labeling_config</span><span class="p">,</span>
        <span class="n">is_location_labeling</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Generate the labeled tiles dataset for the specified label type. This function is generic and works for all</span>
<span class="sd">        label types.</span>

<span class="sd">        Args:</span>
<span class="sd">            label_type (str): label type to compute: 'ue', 'home' or 'work'.</span>
<span class="sd">            apply_ndays_filter (bool): Indicates if the final ndays frequency filter shall be applied in the computation</span>
<span class="sd">                of the specified label type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: labeled tiles dataset for the specified label type.</span>
<span class="sd">        """</span>
        <span class="n">label_code</span> <span class="o">=</span> <span class="n">labeling_config</span><span class="p">[</span><span class="s2">"label_code"</span><span class="p">]</span>
        <span class="n">gap_ps_threshold</span> <span class="o">=</span> <span class="n">labeling_config</span><span class="p">[</span><span class="s2">"ps_difference_gap_filter"</span><span class="p">][</span><span class="s2">"gap_permanence_threshold"</span><span class="p">]</span>
        <span class="n">gap_ps_threshold_is_absolute</span> <span class="o">=</span> <span class="n">labeling_config</span><span class="p">[</span><span class="s2">"ps_difference_gap_filter"</span><span class="p">][</span><span class="s2">"is_absolute"</span><span class="p">]</span>
        <span class="n">gap_period_combinations</span> <span class="o">=</span> <span class="n">labeling_config</span><span class="p">[</span><span class="s2">"ps_difference_gap_filter"</span><span class="p">][</span><span class="s2">"relevant_periods"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># filter ltps df for the current day type and time interval combination:</span>
        <span class="n">ltps_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="n">gap_period_combinations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">gap_period_combinations</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">time_interval</span><span class="p">)</span> <span class="o">==</span> <span class="n">gap_period_combinations</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="c1"># if this is meaningful location labeling, use only tiles labeled as usual environment</span>
        <span class="k">if</span> <span class="n">is_location_labeling</span><span class="p">:</span>
            <span class="n">ltps_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ue_tiles_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">])</span>

        <span class="c1"># cut tiles at gap to generate preselected tiles</span>
        <span class="n">preselected_tiles_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cut_tiles_at_gap</span><span class="p">(</span><span class="n">ltps_df</span><span class="p">,</span> <span class="n">gap_ps_threshold</span><span class="p">,</span> <span class="n">gap_ps_threshold_is_absolute</span><span class="p">)</span>

        <span class="n">labeled_tiles_dfs_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">is_first_rule</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">labeling_config</span><span class="p">[</span><span class="s2">"labeling_rules"</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Applying rule: </span><span class="si">{</span><span class="n">rule</span><span class="p">[</span><span class="s1">'rule_code'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="n">rule_code</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s2">"rule_code"</span><span class="p">]</span>
            <span class="n">rule_threshold</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s2">"threshold_value"</span><span class="p">]</span>
            <span class="n">rule_check_type</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s2">"check_type"</span><span class="p">]</span>
            <span class="n">rule_check_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CHECK_TO_COLUMN</span><span class="p">[</span><span class="n">rule_check_type</span><span class="p">]</span>
            <span class="n">rule_apply_condition</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s2">"apply_condition"</span><span class="p">]</span>
            <span class="n">rule_period_combinations</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s2">"relevant_periods"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># use only tiles which are still unlabeled after the previous rule</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_first_rule</span><span class="p">:</span>
                <span class="n">preselected_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"is_labeled"</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                    <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span>
                <span class="p">)</span>

            <span class="c1"># filter ltps df for the current day type and time interval combination:</span>
            <span class="n">ltps_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="n">rule_period_combinations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">rule_period_combinations</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">time_interval</span><span class="p">)</span> <span class="o">==</span> <span class="n">rule_period_combinations</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="p">)</span>

            <span class="n">device_observation_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">UeGridIdType</span><span class="o">.</span><span class="n">DEVICE_OBSERVATION_STR</span>
            <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">rule_check_column</span><span class="p">)</span>

            <span class="c1"># keep only the tiles that left after gap filtering and previous rules</span>
            <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">preselected_tiles_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">),</span>
                <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">],</span>
                <span class="n">how</span><span class="o">=</span><span class="s2">"right"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># might be the case that there are no inputs for current day type and time interval combination</span>
            <span class="c1"># for tiles that were left from previous rules. To keep them for the next rule, need to coallesce</span>
            <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">({</span><span class="n">rule_check_column</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

            <span class="c1"># apply rule to preselected tiles</span>
            <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_device_abs_threshold</span><span class="p">(</span>
                <span class="n">device_observation_df</span><span class="p">,</span> <span class="n">labeled_tiles_df</span><span class="p">,</span> <span class="n">rule_threshold</span><span class="p">,</span> <span class="n">rule_check_column</span>
            <span class="p">)</span>

            <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
                <span class="s2">"is_labeled"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">rule_check_column</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"abs_threshold"</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">rule_code</span><span class="p">))</span>

            <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">,</span>
                <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"is_labeled"</span><span class="p">),</span>
                <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>
            <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
            <span class="n">labeled_tiles_dfs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"is_labeled"</span><span class="p">)))</span>
            <span class="n">is_first_rule</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># if apply condition is unlabeled device and at least some tiles are labeled stop the process</span>
            <span class="k">if</span> <span class="n">rule_apply_condition</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_DEVICES</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"is_labeled"</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">unionAll</span><span class="p">,</span> <span class="n">labeled_tiles_dfs_list</span><span class="p">)</span>
        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">label_code</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">labeled_tiles_df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cut_tiles_at_gap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ltps_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">gap_ps_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">threshold_is_absolute</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Preprocessing function. Given a Long-Term Permanence Metrics dataset, for each user:</span>
<span class="sd">        - sort the grid tiles of the user by LPS</span>
<span class="sd">        - find a high difference (gap) in the LPS values between one grid tile and the next one,</span>
<span class="sd">          where what is a high difference is defined through the gap_ps_threshold argument.</span>
<span class="sd">        - for each agent, filter out all tiles after this high difference: the remaining tiles are</span>
<span class="sd">          the "pre-selected tiles", which are the output of this function.</span>

<span class="sd">        Args:</span>
<span class="sd">            ltps_df (DataFrame): Long-Term Permanence Metrics dataset, for a specific day type and</span>
<span class="sd">                time interval combination.</span>
<span class="sd">            gap_ps_threshold (int/float): absolute/relative lps threshold.</span>
<span class="sd">            threshold_is_absolute (bool): indicates if gap_ps_threshold is a relative/absolute value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: dataset with the pre-selected tiles.</span>
<span class="sd">        """</span>
        <span class="n">ltps_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">UeGridIdType</span><span class="o">.</span><span class="n">GRID_STR</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">UeGridIdType</span><span class="o">.</span><span class="n">ABROAD_STR</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">desc</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">lps</span><span class="p">))</span>
        <span class="n">cumulative_window</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">rowsBetween</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">unboundedPreceding</span><span class="p">,</span> <span class="n">Window</span><span class="o">.</span><span class="n">currentRow</span><span class="p">)</span>

        <span class="n">ltps_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_abs_ps_threshold</span><span class="p">(</span><span class="n">ltps_df</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">gap_ps_threshold</span><span class="p">,</span> <span class="n">threshold_is_absolute</span><span class="p">)</span>
        <span class="n">pre_selected_tiles_df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ltps_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"previous_lps"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lag</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">lps</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"lps_difference"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"previous_lps"</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">lps</span><span class="p">))</span>
            <span class="o">.</span><span class="n">fillna</span><span class="p">({</span><span class="s2">"lps_difference"</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"high_difference"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"lps_difference"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"abs_ps_threshold"</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"cumulative_condition"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"high_difference"</span><span class="p">))</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">cumulative_window</span><span class="p">))</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"cumulative_condition"</span><span class="p">)</span> <span class="o">==</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"lps_difference"</span><span class="p">,</span> <span class="s2">"previous_lps"</span><span class="p">,</span> <span class="s2">"high_difference"</span><span class="p">,</span> <span class="s2">"cumulative_condition"</span><span class="p">,</span> <span class="s2">"abs_ps_threshold"</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">pre_selected_tiles_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_abs_ps_threshold</span><span class="p">(</span>
        <span class="n">ltps_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">Window</span><span class="p">,</span> <span class="n">gap_ps_threshold</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">threshold_is_absolute</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Add "abs_ps_threshold" field to the ltps dataset.</span>

<span class="sd">        If "threshold_is_absolute" is True, then just assign "abs_ps_threshold" = "gap_ps_threshold"</span>
<span class="sd">        value to all registers.</span>

<span class="sd">        If threshold_is_absolute is False, then reach the maximum value of lps for a grid tile for</span>
<span class="sd">        each device (ps_max) and calculate "abs_ps_threshold" = "gap_ps_threshold" * "ps_max".</span>

<span class="sd">        Args:</span>
<span class="sd">            ltps_df (DataFrame): Long-Term Permanence Score dataset.</span>
<span class="sd">            window (Window): window, partitioned by user id and ordered by lps.</span>
<span class="sd">            gap_ps_threshold (int|float): absolute/relative lps threshold.</span>
<span class="sd">            threshold_is_absolute (bool): indicates if gap_ps_threshold is a relative/absolute value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: Long-Term Permanence Score dataset with the additional "abs_ps_threshold"</span>
<span class="sd">                column.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">threshold_is_absolute</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ltps_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"abs_ps_threshold"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">gap_ps_threshold</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ltps_df</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ltps_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"ps_max"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">lps</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
                <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"abs_ps_threshold"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"ps_max"</span><span class="p">)</span> <span class="o">*</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">gap_ps_threshold</span> <span class="o">/</span> <span class="mi">100</span><span class="p">))</span>
                <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"ps_max"</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">ltps_df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_device_abs_threshold</span><span class="p">(</span>
        <span class="n">device_observation</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_rows_ltps_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">perc_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">threshold_col</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Calculate the total assigned long-term metric score for each device (total_device_ps) for a given day type</span>
<span class="sd">        and time interval and add this information to an additional column of the provided dataset. Then, based on</span>
<span class="sd">        this column, generate the absolute metric threshold to consider for each device by applying the corresponding</span>
<span class="sd">        configured percentage (perc_ps_threshold).</span>

<span class="sd">        Args:</span>
<span class="sd">            device_observation (DataFrame): Long-Term Permanence Metrics dataset, for a specific day type and time interval</span>
<span class="sd">                combination.</span>
<span class="sd">            target_rows_ltps_df (DataFrame): Long-Term Permanence Metrics dataset, for a specific day type and time</span>
<span class="sd">                interval combination, with one 'id_type' == 'grid'.</span>
<span class="sd">            perc_threshold (float): specified ps threshold (in percentage).</span>
<span class="sd">            threshold_col (str): column name of the total device value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: Long-Term Permanence Metrics dataset, for a specific day type and time interval combination,</span>
<span class="sd">                with one 'id_type' == 'grid', with an additional column named "abs_ps_threshold".</span>
<span class="sd">        """</span>
        <span class="n">device_observation</span> <span class="o">=</span> <span class="n">device_observation</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">threshold_col</span><span class="p">,</span> <span class="s2">"total_device_value"</span><span class="p">)</span>
        <span class="n">target_rows_ltps_df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">target_rows_ltps_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">device_observation</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">])</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"abs_threshold"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"total_device_value"</span><span class="p">)</span> <span class="o">*</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">perc_threshold</span> <span class="o">/</span> <span class="mi">100</span><span class="p">))</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"total_device_value"</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">target_rows_ltps_df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_quality_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Build usual environment labeling quality metrics dataframe.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: quality metrics dataframe.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverUsualEnvironmentLabelsDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverUsualEnvironmentLabelsDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">df</span>
        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span><span class="p">)</span>

        <span class="c1"># To get number of tiles not labeled as ue and meanigful locations, we need to get count of all tiles per user</span>
        <span class="n">all_tiles_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">time_interval</span><span class="p">)</span> <span class="o">==</span> <span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">)</span> <span class="o">!=</span> <span class="n">UeGridIdType</span><span class="o">.</span><span class="n">DEVICE_OBSERVATION_STR</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">)</span>

        <span class="n">all_tiles_count_df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">all_tiles_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
            <span class="o">.</span><span class="n">count</span><span class="p">()</span>
            <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">"count"</span><span class="p">,</span> <span class="s2">"all_tiles"</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Mark all ue and meaningful locations rules as loc_na and ue_na</span>
        <span class="n">grouped_df_location</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">"ue"</span><span class="p">,</span> <span class="s2">"loc_na"</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">"ue_na"</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Count number of tiles per user per ue and meaningful locations</span>
        <span class="n">grouped_df_location</span> <span class="o">=</span> <span class="n">grouped_df_location</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="s2">"label_rule"</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
            <span class="n">F</span><span class="o">.</span><span class="n">count_distinct</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"location_count"</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Join all tiles count with location count to get count of tiles not labeled as ue and meaningful locations</span>
        <span class="n">grouped_df_location</span> <span class="o">=</span> <span class="n">grouped_df_location</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">all_tiles_count_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">"outer"</span>
        <span class="p">)</span>
        <span class="n">grouped_df_location</span> <span class="o">=</span> <span class="n">grouped_df_location</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">"count"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"all_tiles"</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"location_count"</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"all_tiles"</span><span class="p">,</span> <span class="s2">"location_count"</span><span class="p">)</span>

        <span class="c1"># Count labeled tiles for separate rules</span>
        <span class="n">grouped_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span>
        <span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="n">device_quality_metrics_df</span> <span class="o">=</span> <span class="n">grouped_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"label"</span><span class="p">)</span><span class="o">.</span><span class="n">unionByName</span><span class="p">(</span><span class="n">grouped_df_location</span><span class="p">)</span>

        <span class="n">device_quality_metrics_df</span> <span class="o">=</span> <span class="n">device_quality_metrics_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
            <span class="n">F</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">"count"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_count</span><span class="p">),</span>
            <span class="n">F</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="s2">"count"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_min</span><span class="p">),</span>
            <span class="n">F</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s2">"count"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_max</span><span class="p">),</span>
            <span class="n">F</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="s2">"count"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_avg</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Add device observation and ue abroad metrics</span>
        <span class="n">abroad_ue_count</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">UeGridIdType</span><span class="o">.</span><span class="n">ABROAD_STR</span><span class="p">)</span>
            <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
            <span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
            <span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">other_rule_metrics_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="s2">"device_filter_1"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rare_devices_count</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">"device_filter_2"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">discontinuous_devices_count</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">"ue_abroad"</span><span class="p">,</span> <span class="n">abroad_ue_count</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_count</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_min</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_max</span><span class="p">,</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_avg</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>

        <span class="n">device_quality_metrics_df</span> <span class="o">=</span> <span class="n">device_quality_metrics_df</span><span class="o">.</span><span class="n">unionByName</span><span class="p">(</span><span class="n">other_rule_metrics_df</span><span class="p">)</span>

        <span class="n">device_quality_metrics_df</span> <span class="o">=</span> <span class="n">device_quality_metrics_df</span><span class="o">.</span><span class="n">withColumns</span><span class="p">(</span>
            <span class="p">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">start_date</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">),</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">end_date</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_metric</span><span class="p">)</span>

        <span class="n">device_quality_metrics_df</span> <span class="o">=</span> <span class="n">apply_schema_casting</span><span class="p">(</span>
            <span class="n">device_quality_metrics_df</span><span class="p">,</span> <span class="n">SilverUsualEnvironmentLabelingQualityMetricsDataObject</span><span class="o">.</span><span class="n">SCHEMA</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">device_quality_metrics_df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_partition_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Method that returns the partition chunks for the current date.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[List[int, int]]: list of partition chunks. If the partition_chunk_size is not defined in the config or</span>
<span class="sd">                the number of partitions is less than the desired chunk size, it will return a list with a single None element.</span>
<span class="sd">        """</span>
        <span class="c1"># Get partitions desired</span>
        <span class="n">partition_chunk_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"partition_chunk_size"</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">number_of_partitions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">COMPONENT_ID</span><span class="p">,</span> <span class="s2">"number_of_partitions"</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">partition_chunk_size</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">number_of_partitions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">partition_chunk_size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">number_of_partitions</span> <span class="o">&lt;=</span> <span class="n">partition_chunk_size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Available Partition number (</span><span class="si">{</span><span class="n">number_of_partitions</span><span class="si">}</span><span class="s2">) is "</span>
                <span class="sa">f</span><span class="s2">"less than the desired chunk size (</span><span class="si">{</span><span class="n">partition_chunk_size</span><span class="si">}</span><span class="s2">). "</span>
                <span class="sa">f</span><span class="s2">"Using all partitions."</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">partition_chunks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">partition_chunk_size</span><span class="p">,</span> <span class="n">number_of_partitions</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_partitions</span><span class="p">,</span> <span class="n">partition_chunk_size</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="c1"># NOTE: Generate chunks if partition_values were read for each day</span>
        <span class="c1"># getting exactly the amount of partitions for that day</span>

        <span class="c1"># partition_chunks = [</span>
        <span class="c1">#     partition_values[i : i + partition_chunk_size]</span>
        <span class="c1">#     for i in range(0, partition_values_size, partition_chunk_size)</span>
        <span class="c1"># ]</span>

        <span class="k">return</span> <span class="n">partition_chunks</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.add_abs_ps_threshold">
<code class="highlight language-python"><span class="n">add_abs_ps_threshold</span><span class="p">(</span><span class="n">ltps_df</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">gap_ps_threshold</span><span class="p">,</span> <span class="n">threshold_is_absolute</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
</span>
</h3>
<div class="doc doc-contents">
<p>Add "abs_ps_threshold" field to the ltps dataset.</p>
<p>If "threshold_is_absolute" is True, then just assign "abs_ps_threshold" = "gap_ps_threshold"
value to all registers.</p>
<p>If threshold_is_absolute is False, then reach the maximum value of lps for a grid tile for
each device (ps_max) and calculate "abs_ps_threshold" = "gap_ps_threshold" * "ps_max".</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>ltps_df</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>Long-Term Permanence Score dataset.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>window</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.Window.html#pyspark.sql.Window" title="pyspark.sql.Window">Window</a></code>
</td>
<td>
<div class="doc-md-description">
<p>window, partitioned by user id and ordered by lps.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>gap_ps_threshold</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
</td>
<td>
<div class="doc-md-description">
<p>absolute/relative lps threshold.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>threshold_is_absolute</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
</td>
<td>
<div class="doc-md-description">
<p>indicates if gap_ps_threshold is a relative/absolute value.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>DataFrame</code></td> <td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>Long-Term Permanence Score dataset with the additional "abs_ps_threshold"
column.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>multimno/components/execution/usual_environment_labeling/usual_environment_labeling.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_abs_ps_threshold</span><span class="p">(</span>
    <span class="n">ltps_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">Window</span><span class="p">,</span> <span class="n">gap_ps_threshold</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">threshold_is_absolute</span><span class="p">:</span> <span class="nb">bool</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Add "abs_ps_threshold" field to the ltps dataset.</span>

<span class="sd">    If "threshold_is_absolute" is True, then just assign "abs_ps_threshold" = "gap_ps_threshold"</span>
<span class="sd">    value to all registers.</span>

<span class="sd">    If threshold_is_absolute is False, then reach the maximum value of lps for a grid tile for</span>
<span class="sd">    each device (ps_max) and calculate "abs_ps_threshold" = "gap_ps_threshold" * "ps_max".</span>

<span class="sd">    Args:</span>
<span class="sd">        ltps_df (DataFrame): Long-Term Permanence Score dataset.</span>
<span class="sd">        window (Window): window, partitioned by user id and ordered by lps.</span>
<span class="sd">        gap_ps_threshold (int|float): absolute/relative lps threshold.</span>
<span class="sd">        threshold_is_absolute (bool): indicates if gap_ps_threshold is a relative/absolute value.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: Long-Term Permanence Score dataset with the additional "abs_ps_threshold"</span>
<span class="sd">            column.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">threshold_is_absolute</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ltps_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"abs_ps_threshold"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">gap_ps_threshold</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ltps_df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ltps_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"ps_max"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">lps</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"abs_ps_threshold"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"ps_max"</span><span class="p">)</span> <span class="o">*</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">gap_ps_threshold</span> <span class="o">/</span> <span class="mi">100</span><span class="p">))</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"ps_max"</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">ltps_df</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.calculate_device_abs_threshold">
<code class="highlight language-python"><span class="n">calculate_device_abs_threshold</span><span class="p">(</span><span class="n">device_observation</span><span class="p">,</span> <span class="n">target_rows_ltps_df</span><span class="p">,</span> <span class="n">perc_threshold</span><span class="p">,</span> <span class="n">threshold_col</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
</span>
</h3>
<div class="doc doc-contents">
<p>Calculate the total assigned long-term metric score for each device (total_device_ps) for a given day type
and time interval and add this information to an additional column of the provided dataset. Then, based on
this column, generate the absolute metric threshold to consider for each device by applying the corresponding
configured percentage (perc_ps_threshold).</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>device_observation</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>Long-Term Permanence Metrics dataset, for a specific day type and time interval
combination.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>target_rows_ltps_df</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>Long-Term Permanence Metrics dataset, for a specific day type and time
interval combination, with one 'id_type' == 'grid'.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>perc_threshold</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
</td>
<td>
<div class="doc-md-description">
<p>specified ps threshold (in percentage).</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>threshold_col</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
</td>
<td>
<div class="doc-md-description">
<p>column name of the total device value.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>DataFrame</code></td> <td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>Long-Term Permanence Metrics dataset, for a specific day type and time interval combination,
with one 'id_type' == 'grid', with an additional column named "abs_ps_threshold".</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>multimno/components/execution/usual_environment_labeling/usual_environment_labeling.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate_device_abs_threshold</span><span class="p">(</span>
    <span class="n">device_observation</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">target_rows_ltps_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">perc_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">threshold_col</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Calculate the total assigned long-term metric score for each device (total_device_ps) for a given day type</span>
<span class="sd">    and time interval and add this information to an additional column of the provided dataset. Then, based on</span>
<span class="sd">    this column, generate the absolute metric threshold to consider for each device by applying the corresponding</span>
<span class="sd">    configured percentage (perc_ps_threshold).</span>

<span class="sd">    Args:</span>
<span class="sd">        device_observation (DataFrame): Long-Term Permanence Metrics dataset, for a specific day type and time interval</span>
<span class="sd">            combination.</span>
<span class="sd">        target_rows_ltps_df (DataFrame): Long-Term Permanence Metrics dataset, for a specific day type and time</span>
<span class="sd">            interval combination, with one 'id_type' == 'grid'.</span>
<span class="sd">        perc_threshold (float): specified ps threshold (in percentage).</span>
<span class="sd">        threshold_col (str): column name of the total device value.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: Long-Term Permanence Metrics dataset, for a specific day type and time interval combination,</span>
<span class="sd">            with one 'id_type' == 'grid', with an additional column named "abs_ps_threshold".</span>
<span class="sd">    """</span>
    <span class="n">device_observation</span> <span class="o">=</span> <span class="n">device_observation</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">threshold_col</span><span class="p">,</span> <span class="s2">"total_device_value"</span><span class="p">)</span>
    <span class="n">target_rows_ltps_df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">target_rows_ltps_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">device_observation</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">])</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"abs_threshold"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"total_device_value"</span><span class="p">)</span> <span class="o">*</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">perc_threshold</span> <span class="o">/</span> <span class="mi">100</span><span class="p">))</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"total_device_value"</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">target_rows_ltps_df</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.check_needed_day_and_interval_types">
<code class="highlight language-python"><span class="n">check_needed_day_and_interval_types</span><span class="p">(</span><span class="n">ltps_df</span><span class="p">,</span> <span class="n">day_and_interval_type_combinations</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
</span>
</h3>
<div class="doc doc-contents">
<p>Method that checks if the needed combinations of day type and interval type are available
in the provided dataset.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>ltps_df</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>provided Long-Term Permanence Score dataset</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>day_and_interval_type_combinations</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="typing.Dict">Dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/typing.html#typing.List" title="typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]]]</code>
</td>
<td>
<div class="doc-md-description">
<p>day type and interval type
combinations that are needed for the execution of the method.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#FileNotFoundError">FileNotFoundError</a></code>
</td>
<td>
<div class="doc-md-description">
<p>If there is no data for one or more of the needed combinations of day type
and interval type.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>multimno/components/execution/usual_environment_labeling/usual_environment_labeling.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">check_needed_day_and_interval_types</span><span class="p">(</span>
    <span class="n">ltps_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">day_and_interval_type_combinations</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Method that checks if the needed combinations of day type and interval type are available</span>
<span class="sd">    in the provided dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        ltps_df (DataFrame): provided Long-Term Permanence Score dataset</span>
<span class="sd">        day_and_interval_type_combinations (Dict[str,List[Tuple[str,str]]]): day type and interval type</span>
<span class="sd">            combinations that are needed for the execution of the method.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If there is no data for one or more of the needed combinations of day type</span>
<span class="sd">            and interval type.</span>
<span class="sd">    """</span>
    <span class="c1"># Assert that these combinations appear at least once in the input Long-Term Permanence</span>
    <span class="c1"># Score data object:</span>
    <span class="k">for</span> <span class="n">season</span><span class="p">,</span> <span class="n">day_type</span><span class="p">,</span> <span class="n">time_interval</span> <span class="ow">in</span> <span class="n">day_and_interval_type_combinations</span><span class="p">:</span>
        <span class="n">filtered_ltps_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="n">season</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">day_type</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">time_interval</span><span class="p">)</span> <span class="o">==</span> <span class="n">time_interval</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">data_exists</span> <span class="o">=</span> <span class="n">filtered_ltps_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data_exists</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="s2">"No Long-term Permanence Score data has been found for "</span>
                <span class="sa">f</span><span class="s2">"day_type `</span><span class="si">{</span><span class="n">day_type</span><span class="si">}</span><span class="s2">` and time_interval `</span><span class="si">{</span><span class="n">time_interval</span><span class="si">}</span><span class="s2">`"</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.compute_generic_labeling">
<code class="highlight language-python"><span class="n">compute_generic_labeling</span><span class="p">(</span><span class="n">labeling_config</span><span class="p">,</span> <span class="n">is_location_labeling</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Generate the labeled tiles dataset for the specified label type. This function is generic and works for all
label types.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>label_type</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
</td>
<td>
<div class="doc-md-description">
<p>label type to compute: 'ue', 'home' or 'work'.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>apply_ndays_filter</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
</td>
<td>
<div class="doc-md-description">
<p>Indicates if the final ndays frequency filter shall be applied in the computation
of the specified label type.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>DataFrame</code></td> <td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>labeled tiles dataset for the specified label type.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>multimno/components/execution/usual_environment_labeling/usual_environment_labeling.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_generic_labeling</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">labeling_config</span><span class="p">,</span>
    <span class="n">is_location_labeling</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Generate the labeled tiles dataset for the specified label type. This function is generic and works for all</span>
<span class="sd">    label types.</span>

<span class="sd">    Args:</span>
<span class="sd">        label_type (str): label type to compute: 'ue', 'home' or 'work'.</span>
<span class="sd">        apply_ndays_filter (bool): Indicates if the final ndays frequency filter shall be applied in the computation</span>
<span class="sd">            of the specified label type.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: labeled tiles dataset for the specified label type.</span>
<span class="sd">    """</span>
    <span class="n">label_code</span> <span class="o">=</span> <span class="n">labeling_config</span><span class="p">[</span><span class="s2">"label_code"</span><span class="p">]</span>
    <span class="n">gap_ps_threshold</span> <span class="o">=</span> <span class="n">labeling_config</span><span class="p">[</span><span class="s2">"ps_difference_gap_filter"</span><span class="p">][</span><span class="s2">"gap_permanence_threshold"</span><span class="p">]</span>
    <span class="n">gap_ps_threshold_is_absolute</span> <span class="o">=</span> <span class="n">labeling_config</span><span class="p">[</span><span class="s2">"ps_difference_gap_filter"</span><span class="p">][</span><span class="s2">"is_absolute"</span><span class="p">]</span>
    <span class="n">gap_period_combinations</span> <span class="o">=</span> <span class="n">labeling_config</span><span class="p">[</span><span class="s2">"ps_difference_gap_filter"</span><span class="p">][</span><span class="s2">"relevant_periods"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># filter ltps df for the current day type and time interval combination:</span>
    <span class="n">ltps_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="n">gap_period_combinations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">gap_period_combinations</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">time_interval</span><span class="p">)</span> <span class="o">==</span> <span class="n">gap_period_combinations</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="p">)</span>

    <span class="c1"># if this is meaningful location labeling, use only tiles labeled as usual environment</span>
    <span class="k">if</span> <span class="n">is_location_labeling</span><span class="p">:</span>
        <span class="n">ltps_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ue_tiles_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">])</span>

    <span class="c1"># cut tiles at gap to generate preselected tiles</span>
    <span class="n">preselected_tiles_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cut_tiles_at_gap</span><span class="p">(</span><span class="n">ltps_df</span><span class="p">,</span> <span class="n">gap_ps_threshold</span><span class="p">,</span> <span class="n">gap_ps_threshold_is_absolute</span><span class="p">)</span>

    <span class="n">labeled_tiles_dfs_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">is_first_rule</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">labeling_config</span><span class="p">[</span><span class="s2">"labeling_rules"</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Applying rule: </span><span class="si">{</span><span class="n">rule</span><span class="p">[</span><span class="s1">'rule_code'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">rule_code</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s2">"rule_code"</span><span class="p">]</span>
        <span class="n">rule_threshold</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s2">"threshold_value"</span><span class="p">]</span>
        <span class="n">rule_check_type</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s2">"check_type"</span><span class="p">]</span>
        <span class="n">rule_check_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CHECK_TO_COLUMN</span><span class="p">[</span><span class="n">rule_check_type</span><span class="p">]</span>
        <span class="n">rule_apply_condition</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s2">"apply_condition"</span><span class="p">]</span>
        <span class="n">rule_period_combinations</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s2">"relevant_periods"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># use only tiles which are still unlabeled after the previous rule</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_first_rule</span><span class="p">:</span>
            <span class="n">preselected_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"is_labeled"</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span>
            <span class="p">)</span>

        <span class="c1"># filter ltps df for the current day type and time interval combination:</span>
        <span class="n">ltps_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="n">rule_period_combinations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">rule_period_combinations</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">time_interval</span><span class="p">)</span> <span class="o">==</span> <span class="n">rule_period_combinations</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="n">device_observation_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">UeGridIdType</span><span class="o">.</span><span class="n">DEVICE_OBSERVATION_STR</span>
        <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">rule_check_column</span><span class="p">)</span>

        <span class="c1"># keep only the tiles that left after gap filtering and previous rules</span>
        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">preselected_tiles_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">),</span>
            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">],</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">"right"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># might be the case that there are no inputs for current day type and time interval combination</span>
        <span class="c1"># for tiles that were left from previous rules. To keep them for the next rule, need to coallesce</span>
        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">({</span><span class="n">rule_check_column</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

        <span class="c1"># apply rule to preselected tiles</span>
        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_device_abs_threshold</span><span class="p">(</span>
            <span class="n">device_observation_df</span><span class="p">,</span> <span class="n">labeled_tiles_df</span><span class="p">,</span> <span class="n">rule_threshold</span><span class="p">,</span> <span class="n">rule_check_column</span>
        <span class="p">)</span>

        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
            <span class="s2">"is_labeled"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">rule_check_column</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"abs_threshold"</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">rule_code</span><span class="p">))</span>

        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">,</span>
            <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"is_labeled"</span><span class="p">),</span>
            <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>
        <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">labeled_tiles_dfs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"is_labeled"</span><span class="p">)))</span>
        <span class="n">is_first_rule</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># if apply condition is unlabeled device and at least some tiles are labeled stop the process</span>
        <span class="k">if</span> <span class="n">rule_apply_condition</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_DEVICES</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"is_labeled"</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">unionAll</span><span class="p">,</span> <span class="n">labeled_tiles_dfs_list</span><span class="p">)</span>
    <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">label_code</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">labeled_tiles_df</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.compute_quality_metrics">
<code class="highlight language-python"><span class="n">compute_quality_metrics</span><span class="p">()</span></code>
</h3>
<div class="doc doc-contents">
<p>Build usual environment labeling quality metrics dataframe.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>DataFrame</code></td> <td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>quality metrics dataframe.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>multimno/components/execution/usual_environment_labeling/usual_environment_labeling.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_quality_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Build usual environment labeling quality metrics dataframe.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: quality metrics dataframe.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverUsualEnvironmentLabelsDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverUsualEnvironmentLabelsDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">df</span>
    <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span><span class="p">)</span>

    <span class="c1"># To get number of tiles not labeled as ue and meanigful locations, we need to get count of all tiles per user</span>
    <span class="n">all_tiles_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">time_interval</span><span class="p">)</span> <span class="o">==</span> <span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">)</span> <span class="o">!=</span> <span class="n">UeGridIdType</span><span class="o">.</span><span class="n">DEVICE_OBSERVATION_STR</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">)</span>

    <span class="n">all_tiles_count_df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">all_tiles_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
        <span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">"count"</span><span class="p">,</span> <span class="s2">"all_tiles"</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Mark all ue and meaningful locations rules as loc_na and ue_na</span>
    <span class="n">grouped_df_location</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
        <span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">"ue"</span><span class="p">,</span> <span class="s2">"loc_na"</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">"ue_na"</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Count number of tiles per user per ue and meaningful locations</span>
    <span class="n">grouped_df_location</span> <span class="o">=</span> <span class="n">grouped_df_location</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="s2">"label_rule"</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
        <span class="n">F</span><span class="o">.</span><span class="n">count_distinct</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">"location_count"</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Join all tiles count with location count to get count of tiles not labeled as ue and meaningful locations</span>
    <span class="n">grouped_df_location</span> <span class="o">=</span> <span class="n">grouped_df_location</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">all_tiles_count_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">"outer"</span>
    <span class="p">)</span>
    <span class="n">grouped_df_location</span> <span class="o">=</span> <span class="n">grouped_df_location</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
        <span class="s2">"count"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"all_tiles"</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"location_count"</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"all_tiles"</span><span class="p">,</span> <span class="s2">"location_count"</span><span class="p">)</span>

    <span class="c1"># Count labeled tiles for separate rules</span>
    <span class="n">grouped_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
        <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span>
    <span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="n">device_quality_metrics_df</span> <span class="o">=</span> <span class="n">grouped_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"label"</span><span class="p">)</span><span class="o">.</span><span class="n">unionByName</span><span class="p">(</span><span class="n">grouped_df_location</span><span class="p">)</span>

    <span class="n">device_quality_metrics_df</span> <span class="o">=</span> <span class="n">device_quality_metrics_df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
        <span class="n">F</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">"count"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_count</span><span class="p">),</span>
        <span class="n">F</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="s2">"count"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_min</span><span class="p">),</span>
        <span class="n">F</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s2">"count"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_max</span><span class="p">),</span>
        <span class="n">F</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="s2">"count"</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_avg</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Add device observation and ue abroad metrics</span>
    <span class="n">abroad_ue_count</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">UeGridIdType</span><span class="o">.</span><span class="n">ABROAD_STR</span><span class="p">)</span>
        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
        <span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
        <span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">other_rule_metrics_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="s2">"device_filter_1"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rare_devices_count</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">"device_filter_2"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">discontinuous_devices_count</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">"ue_abroad"</span><span class="p">,</span> <span class="n">abroad_ue_count</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_count</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_min</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_max</span><span class="p">,</span>
            <span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_avg</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">)</span>

    <span class="n">device_quality_metrics_df</span> <span class="o">=</span> <span class="n">device_quality_metrics_df</span><span class="o">.</span><span class="n">unionByName</span><span class="p">(</span><span class="n">other_rule_metrics_df</span><span class="p">)</span>

    <span class="n">device_quality_metrics_df</span> <span class="o">=</span> <span class="n">device_quality_metrics_df</span><span class="o">.</span><span class="n">withColumns</span><span class="p">(</span>
        <span class="p">{</span><span class="n">ColNames</span><span class="o">.</span><span class="n">start_date</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">),</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">end_date</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">label_rule</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">labeling_quality_metric</span><span class="p">)</span>

    <span class="n">device_quality_metrics_df</span> <span class="o">=</span> <span class="n">apply_schema_casting</span><span class="p">(</span>
        <span class="n">device_quality_metrics_df</span><span class="p">,</span> <span class="n">SilverUsualEnvironmentLabelingQualityMetricsDataObject</span><span class="o">.</span><span class="n">SCHEMA</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">device_quality_metrics_df</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.cut_tiles_at_gap">
<code class="highlight language-python"><span class="n">cut_tiles_at_gap</span><span class="p">(</span><span class="n">ltps_df</span><span class="p">,</span> <span class="n">gap_ps_threshold</span><span class="p">,</span> <span class="n">threshold_is_absolute</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Preprocessing function. Given a Long-Term Permanence Metrics dataset, for each user:
- sort the grid tiles of the user by LPS
- find a high difference (gap) in the LPS values between one grid tile and the next one,
  where what is a high difference is defined through the gap_ps_threshold argument.
- for each agent, filter out all tiles after this high difference: the remaining tiles are
  the "pre-selected tiles", which are the output of this function.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>ltps_df</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>Long-Term Permanence Metrics dataset, for a specific day type and
time interval combination.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>gap_ps_threshold</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> / <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
</td>
<td>
<div class="doc-md-description">
<p>absolute/relative lps threshold.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>threshold_is_absolute</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
</td>
<td>
<div class="doc-md-description">
<p>indicates if gap_ps_threshold is a relative/absolute value.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>DataFrame</code></td> <td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>dataset with the pre-selected tiles.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>multimno/components/execution/usual_environment_labeling/usual_environment_labeling.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cut_tiles_at_gap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ltps_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">gap_ps_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">threshold_is_absolute</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Preprocessing function. Given a Long-Term Permanence Metrics dataset, for each user:</span>
<span class="sd">    - sort the grid tiles of the user by LPS</span>
<span class="sd">    - find a high difference (gap) in the LPS values between one grid tile and the next one,</span>
<span class="sd">      where what is a high difference is defined through the gap_ps_threshold argument.</span>
<span class="sd">    - for each agent, filter out all tiles after this high difference: the remaining tiles are</span>
<span class="sd">      the "pre-selected tiles", which are the output of this function.</span>

<span class="sd">    Args:</span>
<span class="sd">        ltps_df (DataFrame): Long-Term Permanence Metrics dataset, for a specific day type and</span>
<span class="sd">            time interval combination.</span>
<span class="sd">        gap_ps_threshold (int/float): absolute/relative lps threshold.</span>
<span class="sd">        threshold_is_absolute (bool): indicates if gap_ps_threshold is a relative/absolute value.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: dataset with the pre-selected tiles.</span>
<span class="sd">    """</span>
    <span class="n">ltps_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">UeGridIdType</span><span class="o">.</span><span class="n">GRID_STR</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">UeGridIdType</span><span class="o">.</span><span class="n">ABROAD_STR</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">desc</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">lps</span><span class="p">))</span>
    <span class="n">cumulative_window</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">rowsBetween</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">unboundedPreceding</span><span class="p">,</span> <span class="n">Window</span><span class="o">.</span><span class="n">currentRow</span><span class="p">)</span>

    <span class="n">ltps_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_abs_ps_threshold</span><span class="p">(</span><span class="n">ltps_df</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">gap_ps_threshold</span><span class="p">,</span> <span class="n">threshold_is_absolute</span><span class="p">)</span>
    <span class="n">pre_selected_tiles_df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ltps_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"previous_lps"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lag</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">lps</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"lps_difference"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"previous_lps"</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">lps</span><span class="p">))</span>
        <span class="o">.</span><span class="n">fillna</span><span class="p">({</span><span class="s2">"lps_difference"</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"high_difference"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">when</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"lps_difference"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"abs_ps_threshold"</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"cumulative_condition"</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"high_difference"</span><span class="p">))</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">cumulative_window</span><span class="p">))</span>
        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"cumulative_condition"</span><span class="p">)</span> <span class="o">==</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"lps_difference"</span><span class="p">,</span> <span class="s2">"previous_lps"</span><span class="p">,</span> <span class="s2">"high_difference"</span><span class="p">,</span> <span class="s2">"cumulative_condition"</span><span class="p">,</span> <span class="s2">"abs_ps_threshold"</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">pre_selected_tiles_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.discard_devices">
<code class="highlight language-python"><span class="n">discard_devices</span><span class="p">(</span><span class="n">ltps_df</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Given a Long-Term Permanence Score dataset (filtered for the corresponding start and end dates),
discard the rows corresponding to some devices.</p>
<details class="there-are-2-type-of-devices-to-discard" open="">
<summary>There are 2 type of devices to discard</summary>
<ul>
<li>rarely observed devices, based on LPS (long-term permanence score).</li>
<li>discontinuously observed devices, based on frequency.</li>
</ul>
</details> <p>The user ids that are classified in any of these 2 groups are discarded from the Long-Term
Permanence Score dataset, and the number of discarded users of each kind is saved to the
corresponding attributes.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>ltps_df</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>Long-Term Permanence Score dataset (filtered for the corresponding
start and end dates).</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>DataFrame</code></td> <td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>Long-Term Permanence Score dataset (filtered for the corresponding start and
end dates), without the rows associated to rarely or discontinuously observed
devices.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>multimno/components/execution/usual_environment_labeling/usual_environment_labeling.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">discard_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ltps_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Given a Long-Term Permanence Score dataset (filtered for the corresponding start and end dates),</span>
<span class="sd">    discard the rows corresponding to some devices.</span>

<span class="sd">    There are 2 type of devices to discard:</span>
<span class="sd">        - rarely observed devices, based on LPS (long-term permanence score).</span>
<span class="sd">        - discontinuously observed devices, based on frequency.</span>

<span class="sd">    The user ids that are classified in any of these 2 groups are discarded from the Long-Term</span>
<span class="sd">    Permanence Score dataset, and the number of discarded users of each kind is saved to the</span>
<span class="sd">    corresponding attributes.</span>

<span class="sd">    Args:</span>
<span class="sd">        ltps_df (DataFrame): Long-Term Permanence Score dataset (filtered for the corresponding</span>
<span class="sd">            start and end dates).</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: Long-Term Permanence Score dataset (filtered for the corresponding start and</span>
<span class="sd">            end dates), without the rows associated to rarely or discontinuously observed</span>
<span class="sd">            devices.</span>
<span class="sd">    """</span>
    <span class="c1"># Initial filter of ltps dataset to keep total device observation values:</span>
    <span class="n">total_observations_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">UeGridIdType</span><span class="o">.</span><span class="n">DEVICE_OBSERVATION_STR</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">day_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">time_interval</span><span class="p">)</span> <span class="o">==</span> <span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="p">)</span>

    <span class="c1"># Rarely observed:</span>
    <span class="n">rarely_observed_user_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_rarely_observed_devices</span><span class="p">(</span>
        <span class="n">total_observations_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_threshold_for_rare_devices</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">lps</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rare_devices_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rare_devices_count</span> <span class="o">+</span> <span class="n">rarely_observed_user_ids</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="c1"># Discontinuously observed:</span>
    <span class="n">discontinuously_observed_user_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_rarely_observed_devices</span><span class="p">(</span>
        <span class="n">total_observations_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_threshold_for_discontinuous_devices</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">total_frequency</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">discontinuous_devices_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discontinuous_devices_count</span> <span class="o">+</span> <span class="n">discontinuously_observed_user_ids</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="c1"># All user ids to discard:</span>
    <span class="n">discardable_user_ids</span> <span class="o">=</span> <span class="n">rarely_observed_user_ids</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">discontinuously_observed_user_ids</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>

    <span class="c1"># Filter dataset:</span>
    <span class="n">filtered_ltps_df</span> <span class="o">=</span> <span class="n">ltps_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">discardable_user_ids</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">"left_anti"</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">filtered_ltps_df</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.filter_ltps_by_target_dates">
<code class="highlight language-python"><span class="n">filter_ltps_by_target_dates</span><span class="p">(</span><span class="n">full_ltps_df</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">season</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
</span>
</h3>
<div class="doc doc-contents">
<p>Keep only the rows of the input SilverLongtermPermanenceScoreDataObject in which the start
date, end date and season match the ones specified for the processing of this method.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>full_ltps_df</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>full dataset.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>start_date</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="datetime.date">date</a></code>
</td>
<td>
<div class="doc-md-description">
<p>specified target start date for the execution of the method.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>end_date</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="datetime.date">date</a></code>
</td>
<td>
<div class="doc-md-description">
<p>specified target end date for the execution of the method.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>season</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
</td>
<td>
<div class="doc-md-description">
<p>specified target season for the execution of the method.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>DataFrame</code></td> <td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>filtered dataset.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>multimno/components/execution/usual_environment_labeling/usual_environment_labeling.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">filter_ltps_by_target_dates</span><span class="p">(</span>
    <span class="n">full_ltps_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">season</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Keep only the rows of the input SilverLongtermPermanenceScoreDataObject in which the start</span>
<span class="sd">    date, end date and season match the ones specified for the processing of this method.</span>

<span class="sd">    Args:</span>
<span class="sd">        full_ltps_df (DataFrame): full dataset.</span>
<span class="sd">        start_date (dt.date): specified target start date for the execution of the method.</span>
<span class="sd">        end_date (dt.date): specified target end date for the execution of the method.</span>
<span class="sd">        season (str): specified target season for the execution of the method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: filtered dataset.</span>
<span class="sd">    """</span>
    <span class="n">filtered_ltps_df</span> <span class="o">=</span> <span class="n">full_ltps_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span> <span class="o">==</span> <span class="n">start_date</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span> <span class="o">==</span> <span class="n">end_date</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">)</span> <span class="o">==</span> <span class="n">season</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
        <span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">,</span>
        <span class="n">ColNames</span><span class="o">.</span><span class="n">lps</span><span class="p">,</span>
        <span class="n">ColNames</span><span class="o">.</span><span class="n">total_frequency</span><span class="p">,</span>
        <span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">,</span>
        <span class="n">ColNames</span><span class="o">.</span><span class="n">day_type</span><span class="p">,</span>
        <span class="n">ColNames</span><span class="o">.</span><span class="n">time_interval</span><span class="p">,</span>
        <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span>
        <span class="n">ColNames</span><span class="o">.</span><span class="n">id_type</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">filtered_ltps_df</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.find_rarely_observed_devices">
<code class="highlight language-python"><span class="n">find_rarely_observed_devices</span><span class="p">(</span><span class="n">total_observations_df</span><span class="p">,</span> <span class="n">total_device_threshold</span><span class="p">,</span> <span class="n">threshold_col</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
</span>
</h3>
<div class="doc doc-contents">
<p>Find devices (user ids) which match the condition for being considered "rarely observed".
This condition consists in having a total device observation of: lps &gt; total_ps_threshold.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>total_observations_df</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>Long-Term Permanence Score dataset, filtered by the
corresponding start and end dates, and filtered by id_type == 'device_observation'.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>total_device_threshold</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
</td>
<td>
<div class="doc-md-description">
<p>ps threshold.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>threshold_col</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
</td>
<td>
<div class="doc-md-description">
<p>column to use for the threshold.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>DataFrame</code></td> <td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>two-column dataframe with the ids of the devices to discard and the corresponding user modulos.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>multimno/components/execution/usual_environment_labeling/usual_environment_labeling.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">find_rarely_observed_devices</span><span class="p">(</span>
    <span class="n">total_observations_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">total_device_threshold</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">threshold_col</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Find devices (user ids) which match the condition for being considered "rarely observed".</span>
<span class="sd">    This condition consists in having a total device observation of: lps &gt; total_ps_threshold.</span>

<span class="sd">    Args:</span>
<span class="sd">        total_observations_df (DataFrame): Long-Term Permanence Score dataset, filtered by the</span>
<span class="sd">            corresponding start and end dates, and filtered by id_type == 'device_observation'.</span>
<span class="sd">        total_device_threshold (int): ps threshold.</span>
<span class="sd">        threshold_col (str): column to use for the threshold.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame: two-column dataframe with the ids of the devices to discard and the corresponding user modulos.</span>
<span class="sd">    """</span>
    <span class="n">rarely_observed_user_ids</span> <span class="o">=</span> <span class="n">total_observations_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">threshold_col</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">total_device_threshold</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
        <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id_modulo</span><span class="p">,</span> <span class="n">ColNames</span><span class="o">.</span><span class="n">user_id</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">rarely_observed_user_ids</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.get_labeling_config">
<code class="highlight language-python"><span class="n">get_labeling_config</span><span class="p">()</span></code>
</h3>
<div class="doc doc-contents">
<p>Get the configuration of the labeling process.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></code>
</td>
<td>
<div class="doc-md-description">
<p>configuration of the labeling process.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>multimno/components/execution/usual_environment_labeling/usual_environment_labeling.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_labeling_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the configuration of the labeling process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): configuration of the labeling process.</span>
<span class="sd">    """</span>
    <span class="n">ue_labels</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"label_code"</span><span class="p">:</span> <span class="s2">"ue"</span><span class="p">,</span>
        <span class="s2">"ps_difference_gap_filter"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">],</span>
            <span class="s2">"gap_permanence_threshold"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_ps_thresholds</span><span class="p">[</span><span class="s2">"ue"</span><span class="p">],</span>
            <span class="s2">"is_absolute"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_ps_threshold_is_absolute</span><span class="p">[</span><span class="s2">"ue"</span><span class="p">],</span>
        <span class="p">},</span>
        <span class="s2">"labeling_rules"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"ue_1"</span><span class="p">,</span>
                <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_PERMANENCE_THRESHOLD</span><span class="p">,</span>
                <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_thresholds</span><span class="p">[</span><span class="s2">"ue"</span><span class="p">],</span>
                <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">],</span>
                <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_TILES</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"ue_2"</span><span class="p">,</span>
                <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_PERMANENCE_THRESHOLD</span><span class="p">,</span>
                <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_thresholds</span><span class="p">[</span><span class="s2">"ue"</span><span class="p">],</span>
                <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">NIGHT_TIME_ALL</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_TILES</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"ue_2"</span><span class="p">,</span>
                <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_PERMANENCE_THRESHOLD</span><span class="p">,</span>
                <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_thresholds</span><span class="p">[</span><span class="s2">"ue"</span><span class="p">],</span>
                <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">WORKING_HOURS_WORKDAYS</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_TILES</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"ue_3"</span><span class="p">,</span>
                <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_FREQUENCY_THRESHOLD</span><span class="p">,</span>
                <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_thresholds</span><span class="p">[</span><span class="s2">"ue"</span><span class="p">],</span>
                <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">],</span>
                <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_TILES</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">],</span>
    <span class="p">}</span>

    <span class="n">meaningful_location_labels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"label_code"</span><span class="p">:</span> <span class="s2">"home"</span><span class="p">,</span>
            <span class="s2">"ps_difference_gap_filter"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">],</span>
                <span class="s2">"gap_permanence_threshold"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_ps_thresholds</span><span class="p">[</span><span class="s2">"home"</span><span class="p">],</span>
                <span class="s2">"is_absolute"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_ps_threshold_is_absolute</span><span class="p">[</span><span class="s2">"home"</span><span class="p">],</span>
            <span class="p">},</span>
            <span class="s2">"exclude_label_codes"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">"labeling_rules"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"h_1"</span><span class="p">,</span>
                    <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_PERMANENCE_THRESHOLD</span><span class="p">,</span>
                    <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_thresholds</span><span class="p">[</span><span class="s2">"home"</span><span class="p">],</span>
                    <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">ALL_PERIODS</span><span class="p">],</span>
                    <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_DEVICES</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"h_2"</span><span class="p">,</span>
                    <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_PERMANENCE_THRESHOLD</span><span class="p">,</span>
                    <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_thresholds</span><span class="p">[</span><span class="s2">"home"</span><span class="p">],</span>
                    <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">NIGHT_TIME_ALL</span><span class="p">],</span>
                    <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_DEVICES</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"h_3"</span><span class="p">,</span>
                    <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_FREQUENCY_THRESHOLD</span><span class="p">,</span>
                    <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_thresholds</span><span class="p">[</span><span class="s2">"home"</span><span class="p">],</span>
                    <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">NIGHT_TIME_ALL</span><span class="p">],</span>
                    <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_DEVICES</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">],</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">"label_code"</span><span class="p">:</span> <span class="s2">"work"</span><span class="p">,</span>
            <span class="s2">"ps_difference_gap_filter"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">WORKING_HOURS_WORKDAYS</span><span class="p">],</span>
                <span class="s2">"gap_permanence_threshold"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_ps_thresholds</span><span class="p">[</span><span class="s2">"work"</span><span class="p">],</span>
                <span class="s2">"is_absolute"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_ps_threshold_is_absolute</span><span class="p">[</span><span class="s2">"work"</span><span class="p">],</span>
            <span class="p">},</span>
            <span class="s2">"exclude_label_codes"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">"labeling_rules"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"w_1"</span><span class="p">,</span>
                    <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_PERMANENCE_THRESHOLD</span><span class="p">,</span>
                    <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_thresholds</span><span class="p">[</span><span class="s2">"work"</span><span class="p">],</span>
                    <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">WORKING_HOURS_WORKDAYS</span><span class="p">],</span>
                    <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_DEVICES</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">"rule_code"</span><span class="p">:</span> <span class="s2">"w_2"</span><span class="p">,</span>
                    <span class="s2">"check_type"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TOTAL_FREQUENCY_THRESHOLD</span><span class="p">,</span>
                    <span class="s2">"threshold_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_thresholds</span><span class="p">[</span><span class="s2">"work"</span><span class="p">],</span>
                    <span class="s2">"relevant_periods"</span><span class="p">:</span> <span class="p">[</span><span class="n">PeriodCombinations</span><span class="o">.</span><span class="n">WORKING_HOURS_WORKDAYS</span><span class="p">],</span>
                    <span class="s2">"apply_condition"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">UNLABELED_DEVICES</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">ue_labels</span><span class="p">,</span> <span class="n">meaningful_location_labels</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="components.execution.usual_environment_labeling.usual_environment_labeling.UsualEnvironmentLabeling.write_label">
<code class="highlight language-python"><span class="n">write_label</span><span class="p">(</span><span class="n">labeled_tiles_df</span><span class="p">)</span></code>
</h3>
<div class="doc doc-contents">
<p>Write the labeled tiles to the output data object.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>labeled_tiles_df</code>
</td>
<td>
<code><a class="autorefs autorefs-external" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.html#pyspark.sql.DataFrame" title="pyspark.sql.DataFrame">DataFrame</a></code>
</td>
<td>
<div class="doc-md-description">
<p>labeled tiles dataset.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>multimno/components/execution/usual_environment_labeling/usual_environment_labeling.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labeled_tiles_df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Write the labeled tiles to the output data object.</span>

<span class="sd">    Args:</span>
<span class="sd">        labeled_tiles_df (DataFrame): labeled tiles dataset.</span>
<span class="sd">    """</span>
    <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">season</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">season</span><span class="p">))</span>
    <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">))</span>
    <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">ColNames</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">))</span>

    <span class="c1"># Repartition</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disaggregate_to_100m_grid</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Dissagregating 200m to 100m grid"</span><span class="p">)</span>
        <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_gen</span><span class="o">.</span><span class="n">grid_id_from_coarser_resolution</span><span class="p">(</span>
            <span class="n">sdf</span><span class="o">=</span><span class="n">labeled_tiles_df</span><span class="p">,</span>
            <span class="n">coarse_resolution</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
            <span class="n">coarse_grid_id_col</span><span class="o">=</span><span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">,</span>
            <span class="n">new_grid_id_col</span><span class="o">=</span><span class="n">ColNames</span><span class="o">.</span><span class="n">grid_id</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span><span class="o">*</span><span class="n">SilverUsualEnvironmentLabelsDataObject</span><span class="o">.</span><span class="n">PARTITION_COLUMNS</span><span class="p">)</span>

    <span class="n">labeled_tiles_df</span> <span class="o">=</span> <span class="n">apply_schema_casting</span><span class="p">(</span><span class="n">labeled_tiles_df</span><span class="p">,</span> <span class="n">SilverUsualEnvironmentLabelsDataObject</span><span class="o">.</span><span class="n">SCHEMA</span><span class="p">)</span>

    <span class="c1"># save the output data object:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverUsualEnvironmentLabelsDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">labeled_tiles_df</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_data_objects</span><span class="p">[</span><span class="n">SilverUsualEnvironmentLabelsDataObject</span><span class="o">.</span><span class="n">ID</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>

    <span class="c1"># clear cache</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">clearCache</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../../../..", "features": ["toc.integrate", "navigation.path", "navigation.tabs", "navigation.tabs.sticky"], "search": "../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
<script src="../../../../../assets/javascripts/bundle.c8b220af.min.js"></script>
<script src="../../../../../assets/javascripts/panzoom.min.js"></script><script src="../../../../../assets/javascripts/zoompan.js"></script></body>
</html>